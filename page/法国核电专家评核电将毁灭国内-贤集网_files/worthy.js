function wor(){this.body=$(document.body);this.reload=true;this.isTips=true;this.colorClass="text-danger";this.userAgent=navigator.userAgent.toLowerCase();this.vendor=(navigator.vendor||"").toLowerCase();this.showImage="showimage";this.listFile="#fileInfo"}wor.prototype.alert=function(content,isReload,isTips){if(false===isReload){this.reload=isReload}if(false===isTips){this.isTips=isTips}this.body.append('<div class="tips '+wor.colorClass+'"><i class="close"></i><strong>'+content+"</strong></div>");this.tips()};wor.prototype.tips=function(){$(".tips i").click(function(){$(".tips").remove();if(wor.reload){window.location.reload()}});if(this.isTips){setTimeout(function(){$(".tips").remove();if(wor.reload){window.location.reload()}},7000)}};wor.prototype.mozilla=function(){return/firefox/.test(this.userAgent)};wor.prototype.opera=function(){return/opera/.test(this.userAgent)};wor.prototype.webkit=function(){return/webkit/.test(this.userAgent)};wor.prototype.ie=function(){return/msie|trident/.test(this.userAgent)};wor.prototype.safari=function(){if(this.webkit()){return/apple/.test(this.vendor)}};wor.prototype.chrome=function(){if(this.webkit()){return/google/.test(this.vendor)}};wor.prototype.iever=function(){if(this.ie()){return this.userAgent.match(/msie [0-9.]+|rv:[0-9.]+/g)[0].replace(/msie |rv:/g,"").replace(".0","")}};wor.prototype.ie6=function(){return 6==this.iever()};wor.prototype.ie7=function(){return 7==this.iever()};wor.prototype.ie8=function(){return 8==this.iever()};wor.prototype.fileViewPreload=function(){var preload=document.createElement("div");preload.style.width="1px";preload.style.height="1px";preload.style.visibility="hidden";preload.style.position="absolute";preload.style.left="-9999px";preload.style.top="-9999px";preload.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='image')";var body=document.body;body.insertBefore(preload,body.childNodes[0]);return preload};wor.prototype.fileView=function(evt){if(wor.ie6()){$("#"+wor.showImage).attr("src",this.value);return}if(wor.ie8()||wor.ie7()){evt.target.select();var imgSrc=document.selection.createRange().text;var preload=wor.fileViewPreload();imgSrc=imgSrc.replace(/[)'"%]/g,function(s){return escape(escape(s))});try{preload.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=imgSrc}catch(e){this._error("filter error");return}var objImage=document.getElementById(wor.showImage);objImage.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src=\""+imgSrc+'")';objImage.src=wor.ie7()?"mhtml:"+document.scripts[document.scripts.length-1].getAttribute("src",4)+"!blankImage":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";return}var file=evt.target.files[0];var filetype=file.type,mime={"png":"image/png","jpg":"image/jpeg","jpeg":"image/jpeg","bmp":"image/bmp"};if(!filetype){filetype=mime[file.name.match(/\.([^\.]+)$/i)[1]]}if(!/image.(png|jpg|jpeg|bmp)/.test(filetype)){alert("选择的文件类型不是图片");return}var reader=new FileReader();reader.onload=function(){var re=/^data:base64,/;var ret=this.result+"";if(re.test(ret)){ret=ret.replace(re,"data:"+mime[filetype]+";base64,")}$("#"+wor.showImage).attr("src",ret)};reader.readAsDataURL(file);return};wor.prototype.fileSelect=function(evt){var output=[];if(wor.ie6()){var imgName=this.value.match(/\w+\.(jpeg|jpg|png|gif)/g)[0];output.push("<p><span>",imgName,"</span></p>")}else{if(wor.ie8()||wor.ie7()){evt.target.select();var imgSrc=document.selection.createRange().text;imgSrc=imgSrc.replace(/[)'"%]/g,function(s){return escape(escape(s))});var imgName=imgSrc.match(/\w+\.(jpeg|jpg|png|gif)/g)[0];output.push("<p><span>",imgName,"</span></p>")}else{var files=evt.target.files;var i=0;for(var i=0;i<files.length;i++){var file=files[i];output.push("<p><span>",file.name,"</span> (",Math.round(file.size/1024),"KB)</p>")}}}$(wor.listFile).html(output.join(""))};var wor=new wor();