!function(e){var t;_.Module.use("ueglibs/widget/Ban",[],function(e){t=e}),$(".j_richPosterAppealLink").live("click",function(){$.stats.track("posterAppealLink","uegCount","bawuAppeal","click")});var r={POST_AUTHORIZED:"authorized",POST_LOGIN_NEEDED:"\u672C\u5427\u53D1\u8D34\uFF0C\u8BF7\u5148 <a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', 'editor']);return false;\">\u767B\u5F55</a> | <a href=\"#\" onclick=\"TbCom.process('User','buildRegisterFrame',null,null,null,'editor');return false;\">\u6CE8\u518C</a>&nbsp;",POST_USERNAME_NEEDED:"\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148<a href=\"#\" onclick=\"TbCom.process('User','buildUnameFrame','\u586B\u5199\u7528\u6237\u540D',' ');return false;\">\u586B\u5199\u7528\u6237\u540D</a>",POST_BLOCKED:t.render("richPoster"),POST_LEVEL_LIMITED:'\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8<a href="//tieba.baidu.com/f/like/level?kw=#{forum_name}&ie=utf-8" target="_blank">4\u7EA7\u5934\u8854</a><br />\u4EE5\u4E0A\u4F1A\u5458\u53D1\u8D34',POST_BAWU_LIMITED:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53D1\u8D34",POST_LAW_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34",POST_QUALIFICATIONS_LIMITED:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53CA\u6CE8\u518C\u6EE1\u4E00\u5B9A\u65F6\u95F4\u7684\u8001\u7528\u6237\u53D1\u8D34",POST_THREAD_ONLY:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u4E3B\u9898\u8D34",POST_REPLY_ONLY:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u53D1\u56DE\u590D\u8D34",POST_THREAD_LEVEL_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u4E3B\u9898\u8D34",POST_REPLY_LEVEL_LIMITED:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u56DE\u590D\u8D34",POST_PAD_LIMITED:"\u5207\u6362\u6210pad\u7248\u8D34\u5427\uFF0C\u7545\u4EAB\u66F4\u987A\u7545\u7684\u53D1\u8D34\u4F53\u9A8C\uFF01",POST_ONLY_LOUZHU_CAN_REPLY:"\u4E0D\u597D\u610F\u601D\u54E6\uFF0C\u672C\u697C\u76EE\u524D\u53EA\u5141\u8BB8\u697C\u4E3B\u56DE\u590D\u54E6~<br/>\u5982\u679C\u4F60\u6709\u76F8\u540C\u6216\u5176\u4ED6\u7684\u95EE\u9898\uFF0C\u8BF7\u5728\u672C\u5427\u53D1\u8D34\u53CD\u9988\u54E6~",POST_REPLY_PRIVATE_FLAG:"\u7531\u4E8E\u697C\u4E3B\u8BBE\u7F6E\u4E86\u8BC4\u8BBA\u6743\u9650\uFF0C\u4F60\u65E0\u6CD5\u8BC4\u8BBA\u6B64\u8D34\u54E6",POST_HAS_ZONE_RIGHT:'\u4F60\u8FD8\u6CA1\u6709\u672C\u5427\u6838\u5FC3\u533A\u7684\u56DE\u8D34\u6743\u9650\uFF0C\u53EF\u4EE5\u901A\u8FC7<a href="//tieba.baidu.com/encourage/authenticationTest?kw=#{forum_name}&pid=#{pid}" target="_blank">\u7B54\u9898\u8003\u8BD5</a>\u83B7\u5F97\u56DE\u8D34\u8D44\u683C~',context:null,authorities:null,loadContext:function(e){this.context=e},loadContextFromPageData:function(e){var t="frs"==e.product,r="pb"==e.product;this.context={forum:{id:e.forum.forum_id,name:e.forum.forum_name,nameEncoded:e.forum.name_url},user:{id:e.user.user_id,name:e.user.user_name,level:e.user.level_id?e.user.level_id:e.user.balv.level_id,isFavorForum:t?e.user.balv.is_like:PageData.user.is_like,isLogin:!!e.user.is_login,isBlocked:t?!!e.user.is_block:!!PageData.user.forbidden.isForbid,isBlack:t?!!e.user.balv.is_black:!!e.user.is_black,noUsername:!!e.user.no_un,canPost:t?e.user.power.post:PageData.power.can_post,canVote:t?e.user.power.vote_creater:!1,forbidFlag:e.forum.forbid_flag,signNumber:e.user.is_login&&e.forum.sign_in_info&&e.forum.sign_in_info.user_info?e.forum.sign_in_info.user_info.c_sign_num:0,superboy:e.user.superboy,props:e.user.Parr_props,gameSignature:e.user.game_attr},product:e.product,floor:0,tbs:e.tbs,isPad:e.is_ipad,page:e.page},r&&(this.context.thread={id:e.thread.thread_id,thread_type:PageData.thread.thread_type},this.context.floor=e.thread.reply_num)},loadAuthorities:function(e,t){$.browser.msie&&$.browser.version<8&&(e.long_editor=!1,e.float_editor=!1),this.authorities=e,this.authorities.prozone_thread_info=t},getContext:function(){return this.context},getAuthorities:function(){return this.authorities},isPostAllowed:function(){return this._validatePostAuthority()==this.POST_AUTHORIZED},getPostRejectedMessage:function(){var e=this._validatePostAuthority();return e!=this.POST_AUTHORIZED?$.tb.format(e,$.extend({forum_name:this.context.forum.name},this.context)):null},_validatePostAuthority:function(){var e=this.context.user;return e.isLogin?e.isBlocked?this.POST_BLOCKED:e.canPost?"pb"==PageData.product&&PageData.feedback&&0!=PageData.feedback&&PageData.user.user_name!=PageData.thread.author?this.FORBID_FLAG_MAP[11]:"pb"==PageData.product&&3==PageData.power.reply_private_flag?this.FORBID_FLAG_MAP[12]:this.context.isPad?this.POST_PAD_LIMITED:"1"==this.authorities.prozone_thread_info.is_pro_thread&&"1"!=this.authorities.prozone_thread_info.is_user_has_right?this.POST_HAS_ZONE_RIGHT.replace("#{forum_name}",encodeURIComponent(PageData.forum.forum_name)).replace("#{pid}",PageData.thread.thread_id):this.POST_AUTHORIZED:this.FORBID_FLAG_MAP[e.forbidFlag]:this.POST_LOGIN_NEEDED}};r.FORBID_FLAG_MAP={1:r.POST_LOGIN_NEEDED,2:r.POST_QUALIFICATIONS_LIMITED,3:r.POST_LEVEL_LIMITED,4:r.POST_BAWU_LIMITED,5:r.POST_LAW_LIMITED,7:r.POST_REPLY_ONLY,8:r.POST_THREAD_ONLY,9:r.POST_REPLY_LEVEL_LIMITED,10:r.POST_THREAD_LEVEL_LIMITED,11:r.POST_ONLY_LOUZHU_CAN_REPLY,12:r.POST_REPLY_PRIVATE_FLAG},e.PosterContext=r}(window);_.Module.define({require:["common/widget/paypost_data"],path:"common/widget/RichPoster",requires:["common/widget/PostService","common/widget/WordLimit","common/widget/PostPrefix","common/widget/PostSignature","common/widget/MousePwd","encourage/widget/PostGuessingNew","common/component/BubbleFactory","bawu/widget/complaintBarOwner","encourage/widget/paypost_agree_dialog","common/component/quick_reply_edit","encourage/widget/post_marry","common/widget/payMember","common/widget/LoginDialog"],sub:{_options:{},_widnowScrollTimer:"",_windowHeight:0,tbsUrl:"//tieba.baidu.com/dc/common/imgtbs",uploadUrl:"https:"===$.tb.location.getProtocol()?"https://uploadphotos.baidu.com/upload/pic":"http://upload.tieba.baidu.com/upload/pic",PIC_URL_PATH:"/forum/pic/item/",_payMemberTpl:'<a href="javascript:;" class="j-placeholder-pay-member" style="color:#999; text-decoration:none;margin-left: 80px;margin-top:12px;display:block;">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C</a>',initial:function(t){this.initUploadUrl(),this._options=t,this._windowHeight=screen.height,this.bindWannaPost(),this.bindTousuEvent(),this.bindScrollEvent()},bindTousuEvent:function(){var t=this;$("#frs_footer_tieba_report").on("click",function(e){if(PageData.user.is_login){var i=t.getInstance("bawu/widget/complaintBarOwner");i.showDialog()}else e.preventDefault(),_.Module.use("common/widget/LoginDialog")})},bindScrollEvent:function(){var t=this;$("body").height()<=$(window).scrollTop()+2*t._windowHeight||"hottopic"===PosterContext.getContext().product?t.init():$(window).bind("scroll",[t],t.scrollHandler)},unbindScrollEvent:function(){var t=this;$(window).unbind("scroll",t.scrollHandler)},bindFullScreenEvent:function(){var t=this;$editorContainer=this.$root.find(".ueditor_container"),$editorContainer.on("onSetFullScreen",function(){t.fullscreenBubble&&t.fullscreenBubble.closeBubble()})},scrollHandler:function(t){var e=t.data[0];e._widnowScrollTimer&&clearTimeout(e._widnowScrollTimer),e._widnowScrollTimer=setTimeout(function(){$(window).scrollTop()+2*e._windowHeight>=$("body").height()&&(e.init(),e.unbindScrollEvent())},200)},bindWannaPost:function(){var t=this;this.observe("wanna_post",function(){PosterContext.getAuthorities().float_editor?t.enableFloatingPoster():$(window).scrollTop($("body").height()),setTimeout(function(){t.focus()},600)})},init:function(){var t=$("#tb_rich_poster_container"),e=this._options;this.$container=t,this.$root=t.find("#rich_ueditor_tpl"),this.$window=$(window),this.$editorContainer=this.$root.find(".ueditor_container"),this.prefix=e.prefix,this.isFrs="frs"===PosterContext.getContext().product,this.isHotTopic="hottopic"===PosterContext.getContext().product,this.isPb="pb"===PosterContext.getContext().product,this.isQinglang=e.isQinglang,this.redirectAfterPost=e.redirectAfterPost||!1,this.QinglangData=e.QinglangData,this.hideHolder=0,this.initPostService(),(this.isFrs||this.isHotTopic)&&(this.$title=this.$root.find(".j_title"),this.initTitle());var i=PosterContext.getContext().page;if(this.isPb&&"pb_bright"!==i&&this.$root.addClass("compat_rich_poster"),this.initDraft(),this.initEditor(),this.initAntiSpamming(),this.initEvent(),this.initPlaceholder(),e.isNotTopStick+""=="1"&&PosterContext.isPostAllowed()&&this.initTopTip(),this.initSaveToQuickReply(),PosterContext.getAuthorities().long_editor&&this.initFloatingToolbar(),this.initMousePwd(),this.initBskUserBehavior(),this.initSignature(),PosterContext.context.user.isLogin&&!PosterContext.isPostAllowed())$.browser.msie&&6==$.browser.version||this.editor.ready(function(){this.disable()}),this.showWarning(PosterContext.getPostRejectedMessage()),this.toggleSubmitButton(!0),this.$title&&this.$title.tbprop("disabled",!0);else{if(this.isFrs||this.isHotTopic){var o="",s=window.PageData.user;if(this.QinglangData&&this.QinglangData.title)o=this.QinglangData.title;else{var r=s.mParr_props&&s.mParr_props.level&&this.isBeMember()?"\u4EB2\u7231\u7684\u4F1A\u5458\uFF0C\u8BF7\u8F93\u5165\u60A8\u7684\u6807\u9898":"\u8BF7\u586B\u5199\u6807\u9898";o=r}_.Module.use("common/widget/Placeholder",[this.$title,o,{color:"#bfbfbf"}])}this.editor.ready(function(){this.restoreDraft()})}PageUnit.load("rich_poster_show_music_recommend"),this.isFrs&&PosterContext.getContext().user.isLogin&&this.showOfflineCard()},initSaveToQuickReply:function(){var t=this;this.$container.on("click",".save-to-quick-reply-btn",function(){if(!PageData.user.is_login)return void t.requireInstanceAsync("common/widget/LoginDialog");var e=t.editor.getContentTxt();t.requireInstance("common/component/quick_reply_edit",[{additionalContent:e}])})},showOfflineCard:function(){var t=this,e=1*new Date;e>1408032e6||$.tb.Storage.get("balv_tdou_update")>e||(this.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="//tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":0,left:34,top:122},arrow_pos:{left:25},wrap:$("#tb_rich_poster"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("poster_doupiao_offline",e+864e5),t.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("poster_doupiao_offline",e+864e5),t.offline_card._j_card.remove()}),this.offline_card.showCard())},initPostService:function(){var t=this,e="",i=!(!window.history||!window.history.pushState);this.postService=this.use("common/widget/PostService"),this.postService.success(function(){$.stats.track("pb\u53D1\u8868\u6309\u94AE\u70B9\u51FB\u91CF","\u53D1\u8D34\u4F18\u5316\u7EDF\u8BA1","pb","click"),t.editor.setContent(""),t.editor.clearDraft(),t.showPostSuccess(),PosterContext.getContext().isBlessForum&&t.setBlessCookie();var o=t.require("common/widget/paypost_data").getInstance();o.get("isPaypost")&&(t.feeEditor.setContent(""),t.feeEditor.clearDraft());var s=Math.ceil(10*Math.random());s>8&&($.stats.track("pb-list\u6700\u4E0B_F90","PC\u7AEF\u5F69\u7968pb\u53D1\u5E16\u8BD5\u9A8C","pb","view",{obj_url:"//tb1.bdstatic.com/tb/cms/com/icon/F90_icon.gif"}),$.tb.Storage.set("pb_show_ad_f90","Y",(new Date).getTime()+8e3)),"pb"===PageData.product?PageData.pager.total_page===PageData.pager.cur_page&&setTimeout(function(){e=$.tb.location.getHref().replace($.tb.location.getProtocol()+"//"+$.tb.location.getHost(),""),-1!==e.indexOf("#")&&(e=e.slice(0,e.indexOf("#"))),-1===e.search(/pn=(\d+)/)&&(e+=-1===e.search(/\?/)?"?pn=1":"&pn=1"),i?window.refreshPage(e):window.refreshPage("",+e.match(/pn=(\d+)/)[1])},500):setTimeout(function(){t.redirectAfterPost?$.tb.location.setHref(t.redirectAfterPost):t.refresh(),$.browser.msie&&t.isHotTopic&&$.tb.location.reload()},1e3),setTimeout(function(){var e=$("#d_post_manage"),i=$("#j_quick_thread");i.children().length>0&&(e.show(),e.hover(function(){i.show()},function(){i.hide()})),$(".tb_poster_info").remove(),t.togglePostState(!1);var o=$(window).scrollTop();o>0&&(window.scrollTo(0,1),setTimeout(function(){window.scrollTo(0,0)},0))},2e3),setTimeout(function(){t.editor.execCommand("clearfullscreen");var e=$(".j_submit").data("fullscreen")||"\u9ED8\u8BA4";$.stats.track("\u56DE\u590D\u6210\u529F-"+e,"\u65B0\u53D1\u8D34\u4F18\u5316\u7EDF\u8BA1","pb","view")},1e3),window._BSK.userBehavior.resetBSKUserBehaviorData(),window._BSK.userBehavior.bindBSKEvent(),t.initBskUserBehavior()}).complete(function(){t.togglePostState(!1)})},initEvent:function(){var t=this,e=this.$root.find(".ueditor_container .j_error"),i=$(".poster_submit");this.$submit=this.$root.find(".j_submit").click(function(o){e.text("").show(),o.preventDefault(),i.hasClass("ui_btn_disable")||(window._BSK.userBehavior.sendByClick=!0,t.MousePwd.MOUSEPWD_CLICK=1,t.post())}),this.$submit=this.$root.find(".j_get_editor_content").click(function(e){e.preventDefault();var i='<textarea style="width:700px;height:460px">'+t.getContentUbb()+"</textarea>",o={modal:!0,fixed:!0,width:726,height:464,holderClassName:"",draggable:!0,html:i};t._content_dialog=new $.dialog(o),t._content_dialog.show()}),this.$root.on("keyup",function(e){e.ctrlKey&&13==e.keyCode&&(window._BSK.userBehavior.sendByKeyBoard=!0,t.post())}),this.$root.find(".add_vote_btn").click(function(){if(!PosterContext.getContext().user.canVote){var t=PosterContext.getContext().forum.nameEncoded;return $.tb.alert({title:"\u53D1\u8D77\u6295\u7968",message:'\u83B7\u5F97<a target="_blank" href="/f/like/level?kw='+t+'">3\u7EA7\u5934\u8854</a>\u624D\u53EF\u53D1\u8D77\u6295\u7968\u54E6~~<br />\u7533\u8BF7\u52A0\u5165\u4F1A\u5458\uFF0C\u9A6C\u4E0A\u53D1\u8D77\u6295\u7968\uFF01\uFF08\u66F4\u591A\u4F1A\u5458\u7279\u6743<a target="_blank" href="/f/like/level?kw= '+t+'">\u70B9\u6B64\u67E5\u770B</a>',buttons:{text:"\u786E\u5B9A"}}),!1}}),this.$root.find(".j_disable_float").click(function(){t.disableFloatingPoster()}),this.observe("insertimage",function(e,i){t.editor.execCommand("insertimage",[i])}),this.observe("file_added.attachment",function(){t.togglePostState(!0)}),this.observe("upload_complete.attachment",function(){t.togglePostState(!1)});this.$root.find(".add_guessing_btn").on("click",function(){t.guessingDialog?t.guessingDialog._dialog.show():(t.guessingDialog=t.use("encourage/widget/PostGuessingNew",{container:$("#tb_rich_poster .poster_body")}),$(".guessing_holder").css("width","720"),$("#guessing_wrapper").css({paddingLeft:60})),t.$root.find(".post_head_btn").removeClass("cur"),$(this).addClass("cur"),t.marryDialog&&t.marryDialog.hide(),$("#tb_rich_poster_container").height(512)}),this.$root.find(".add_thread_btn").on("click",function(){t.guessingDialog&&t.guessingDialog._dialog.hide(),t.marryDialog&&t.marryDialog.hide(),t.$root.find(".post_head_btn").removeClass("cur"),$(this).addClass("cur"),$("#tb_rich_poster_container").height("auto")}),this.$root.find(".add_marry_btn").on("click",function(){t.marryDialog?t.marryDialog.show():(t.marryDialog={},t.marryDialog.hide=t.marryDialog.show=function(){},t.requireInstanceAsync("encourage/widget/post_marry",{type:"poster"},function(e){t.marryDialog=e})),t.$root.find(".post_head_btn").removeClass("cur"),$(this).addClass("cur"),t.guessingDialog&&t.guessingDialog._dialog.hide(),$("#tb_rich_poster_container").height(623)})},initTitle:function(){this.initTitleWordLimit(),this.initTitlePrefix()},initFloatingToolbar:function(){function t(){s.removeClass("poster_floating_toolbar").removeClass("poster_locked_toolbar"),i=!1}var e=this,i=!1,o=this.$root.find(".editor_bottom_panel"),s=this.$root.find(".j_floating");if(this.$window.scroll(function(){if(e.editor.$container.height()>e.$window.height()){var r=e._viewPortOn(e.$root);if(r.isOnScreen){var n=e._viewPortOn(o);n.bottomToBottom>=0?i&&t():r.topToBottom>400?(s.addClass("poster_floating_toolbar").removeClass("poster_locked_toolbar"),i=!0):(s.addClass("poster_locked_toolbar").removeClass("poster_floating_toolbar"),i=!0)}else i&&t()}else i&&t()}),this.bind("draft_clean",t),this.bind("poster_float",t),"1"!=$.tb.Storage.get("close_long_editor_bubble")){var r={content:"\u5DF2\u4E3A\u4F60\u5F00\u542F\u8D85\u957F\u53D1\u8D34\u6846\u529F\u80FD\uFF0C\u4E86\u89E3\u66F4\u591A\u6216\u5173\u95ED\u6B64\u529F\u80FD<a href='//tieba.baidu.com/mo/q/topic_page/219_1' target='_blank'>\u70B9\u51FB\u8FD9\u91CC</a>",arrow_dir:"down",bubble_css:{top:80,left:100,width:179},wrap:this.$root.find(".j_bubble_container"),closeBtn:!0},n=new UiBubbleTipBase(r);n.bind("onclose",function(){$.tb.Storage.set("close_long_editor_bubble","1",(new Date).getTime()+2592e6),n.closeBubble()}),n.showBubble()}},initTitleWordLimit:function(){var t=this,e=$("#tb_rich_poster"),i={inputObj:this.$title,checkDelay:200,showLimit:10,maxNum:60,isLimitInput:!0},o=this.use("common/widget/WordLimit",i);o.init(),o.bind("wlshowing",function(){e.find(".j_surveillance").hide(),t.$root.hasClass("tb_floating_poster")&&o.holder.css("zIndex",1e4)}),o.bind("wlhiding",function(){e.find(".j_surveillance").show(),o.holder.css("zIndex","auto")})},initTitlePrefix:function(){var t={$target:this.$title,prefix:this.prefix};this.use("common/widget/PostPrefix",t)},initEditor:function(){var t=this.requireInstance("user/widget/userApi",[]),e=t.checkSuperMemberShipOf(window.PageData.user);if(e&&(this.hideHolder=1),PosterContext.isPostAllowed()){var i={};i.excludePlugins=["medal"],i.contentWidth=708,i.initialFrameWidth=720,PosterContext.getAuthorities().long_editor&&(i.autoFloatEnabled=!0,i.topOffset=this.isFrs?40:0,i.heightLimit=!1),PosterContext.getAuthorities().emotion_transform||i.excludePlugins.push("emotion_transform"),this.isHotTopic&&(i.toolbar=["image","emotion","topic","fullscreen"]),this.editor=UE.getEditor("ueditor_replace",i),this.initBubble()}else this.editor=UE.getEditor("ueditor_replace",{toolbar:""});window.test_editor=this.editor,window.test_poster=this,this.initBubbleTips()},initBubble:function(){var t=this,e=this.use("common/component/BubbleFactory");return e.getPropId()&&e.getCurrent()?void t.editor.ready(function(){t.editor.execCommand("background","bubble",e.getCurrent().background),t.editor.execCommand("setmsg",e.getCurrent())}):void(this.isBeMember()&&!$.cookie("bubguide")&&this.editor.execCommand("setmsg","MSG_USE_GUIDE"))},initDraft:function(){var t=this,e=this.$root.find(".j_draft"),i=e.children(".j_content"),o=e.children(".j_clear");this.$root.on("saved.draft",function(){i.text("\u4F60\u6B63\u5728\u8F93\u5165\u7684\u5185\u5BB9\u5DF2\u81EA\u52A8\u4FDD\u5B58, "+$.dateFormat(new Date,"HH:mm:ss")),e.show()}),this.$root.on("restored.draft",function(){i.text("\u4F60\u4E0A\u6B21\u672A\u53D1\u8868\u7684\u5185\u5BB9\u5DF2\u81EA\u52A8\u6062\u590D"),e.show()}),o.on("click",function(){t.editor.clearDraft(),t.editor.setContent("");var i=t.require("common/widget/paypost_data").getInstance();i.get("isPaypost")&&(t.feeEditor=t.feeEditor||UE.getEditor("ueditor_fee_replace"),t.feeEditor.setContent(""),t.feeEditor.clearDraft()),e.hide(),t.trigger("draft_clean")})},initPlaceholder:function(){var t=this,e=0;if(this.$placeholder=$('<div class="tb_poster_placeholder"></div>'),this.$placeholder.click(function(e){$(e.target).is("a")||(t.$placeholder.hide(),t.editor.focus())}),this.editor.ready(function(){t.$placeholder.prependTo(t.$root.find(".edui-container")),t.editor.addListener("focus",function(){t.$placeholder.hide()}),t.editor.addListener("blur",function(){e||t._showPlaceHolder()}),t._showPlaceHolder()}),this.$root.on("restored.draft",function(){t.$placeholder.hide()}),this.QinglangData&&this.QinglangData.content&&PageData.user.is_login){this.$placeholder.css({left:15,top:55});var i='<p style="width:565px;line-height:25px;">'+this.QinglangData.content+"</p>";this.$placeholder.html(i)}else this.$placeholder.html(this._payMemberTpl),this.bindSuperMemberExpUpTrack();this.$editorContainer.on("setbackground",function(i,o){return"default"!==o&&o?(t.hideHolder=1,void t.$placeholder.hide()):void(e||t._showPlaceHolder())}),this.$placeholder.find("a").on("click",function(){var t="";"frs"==PageData.product?t="frs":"pb"==PageData.product&&(t="pb"),$.stats.track("\u53D1\u8868\u56DE\u590D\u6846PlaceHolder","\u8D34\u5427PC\u9875\u9762\u4F18\u5316",t,"click")}),PosterContext.getContext().user.isLogin&&"\u8D34\u5427\u610F\u89C1\u53CD\u9988"==PosterContext.getContext().forum.name&&this.$placeholder.addClass("tb_poster_plain_placeholder").html(PageUnit.load("rich_poster_feedback"))},_showPlaceHolder:function(){var t=this.editor.getContent();0!=t.length||this.hideHolder||this.$placeholder.show()},initTopTip:function(){var t=this;this.$topTip=$('<div class="tb_poster_toptip">\u56E0\u697C\u4E3B\u53D1\u5E03\u4E86\u5E7F\u544A\u7B49\u8FDD\u89C4\u5185\u5BB9\uFF0C\u56DE\u590D\u6B64\u697C\u4E0D\u9876\u5E16\u54E6~</div>'),this.$topTip.click(function(){t.$topTip.hide(),t.editor.focus()}),this.editor.ready(function(){if(t.$topTip.prependTo(t.$root.find(".edui-container")),t.editor.addListener("focus",function(){t.$topTip.hide()}),t.editor.addListener("blur",function(){t._showToptip()}),t.$placeholder.position()){var e=t.$placeholder.position().top;110>e&&t.$placeholder.css({top:110})}t.editor.$body.is(":focus")||t._showToptip()}),this.$root.on("restored.draft",function(){t.$topTip.hide()})},_showToptip:function(){var t=this.editor.getContent();0==t.length&&this.$topTip.show()},initMousePwd:function(){this.MousePwd=this.use("common/widget/MousePwd"),this.MousePwd.start(["editor_content_wrapper"])},recordKeyup:function(t){var e=this;window._BSK.userBehavior.keyUpArr.length<window._BSK.userBehavior.keyUpArrMax?window._BSK.userBehavior.keyUpArr.push(t.keyCode):$(".editor_content_wrapper").unbind("keyup",e.recordKeyup)},initBskUserBehavior:function(){var t=this;$(".editor_content_wrapper").unbind("keyup",t.recordKeyup).on("keyup",t.recordKeyup)},initSignature:function(){var t=this,e=this.$root.find(".j_poster_signature");e.hide(),PosterContext.getContext().user.isLogin&&this.$root.find("#ueditor_replace").one("click",function(){var i=t.use("common/widget/PostSignature",{$container:e,gameSignature:PosterContext.getContext().user.gameSignature});i.init(),e.show()})},initAntiSpamming:function(){},initBubbleTips:function(){try{!localStorage.getItem("postFullscreenForPB")&&this.initFullScreen()}catch(t){}},initFullScreen:function(){var t={arrow_dir:"up",bubble_css:{top:30,right:-10,width:150,height:50,zIndex:6e4},arrow_pos:{right:10},wrap:$(".edui-btn-toolbar"),closeBtn:!0,content:"\u5168\u5C4F\u53D1\u8D34\u4F53\u9A8C\u4F1A\u66F4\u597D\u54E6~"};this.fullscreenBubble=new UiBubbleTipBase(t),this.fullscreenBubble.showBubble(),localStorage.setItem("postFullscreenForPB",1),this.bindFullScreenEvent()},isBeMember:function(){var t=window.PageData.user;return t.mParr_props&&t.mParr_props.level&&parseInt(t.mParr_props.level.props_id,10)>0&&1e3*t.mParr_props.level.end_time>Env.server_time?!0:!1},showPostSuccess:function(){var t="",e=window.PageData.user;e.mParr_props&&e.mParr_props.level&&this.isBeMember()&&(t="\u5C0A\u656C\u7684\u4F1A\u5458\uFF0C");var i=this.getPosterSuccessContent(t);$(i).appendTo(this.$editorContainer),this.showAddExp($(".poster_submit"))},bindSuperMemberExpUpTrack:function(){if(-1!=$(".j-placeholder-pay-member").html().indexOf("\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C")){var t=this;t.$placeholder.on("click","a",function(){if(!PageData.user.is_login)return t.requireInstance("common/widget/LoginDialog"),!1;var e=t.requireInstance("common/widget/payMember"),i={fr:"\u53D1\u5E16\u6846\u5F00\u901A\u4F1A\u5458\u70B9\u51FB\u91CF",scene_id:1007001003};e.showCashier(i),$.stats.track("\u53D1\u5E16\u6846\u5F00\u901A\u4F1A\u5458\u70B9\u51FB\u91CF","\u4F1A\u5458\u52A0\u901F2.0")})}},getPosterSuccessContent:function(t){var e=['<div class="tb_poster_info poster_success">','<div class="poster_success_content clearfix #{className}">','<div class="post_success_tip">#{headCrown}\u53D1\u8868\u6210\u529F\uFF01</div>','<div class="post_success_exp">','<span class="post_success_exp_name">\u7ECF\u9A8C</span>','<b class="post_success_exp_plus">+#{experience}</b>',"</div>","</div>","#{footTip}","</div>"].join(""),i=this.requireInstance("user/widget/userApi",[]),o=i.checkSuperMemberShipOf(PageData.user),s={className:t?"poster_success_content_mem":""},r={experience:6,footTip:"",headCrown:'<i class="middle_size_crown"></i>'},n={experience:1,footTip:'<div class="success-foot-tip"><i class="middle_size_crown"></i>\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458\u53D1\u8D346\u500D\u7ECF\u9A8C</div>',headCrown:""};if(o)var a=$.extend(s,r);else var a=$.extend(s,n);var l=$.tb.format(e,a);return l},showAddExp:function(){$(".post_success_exp").fadeIn(function(){})},showWarning:function(t){void 0==this.$warning&&(this.$warning=$('<div class="tb_poster_info poster_warning"></div>').appendTo(this.$editorContainer)),this.$warning.html(t)},showAlert:function(t,e){var i="https://gsp0.baidu.com/5aAHeD3nKhI2p27j8IqW0jdnxx1xbK/tb/img/errorFace.gif",o=$.tb.alert(e?{iconSrc:i,showShadow:!1,showTitle:!1,message:t,width:"240px",buttons:[]}:{showShadow:!1,showTitle:!1,message:t,width:"240px",buttons:[]});if($(".tb_alert_message").css("text-align","center"),$(".dialogJ .tb_alert_wrapper .tb_alert_title img").css("margin-left","75px"),e)var s=setTimeout(function(){clearTimeout(s),o.close()},800);return o},getTitle:function(){return this.$title?this.$title.val():""},getContent:function(){return this.editor.getContent()},getContentUbb:function(){return this.editor.getContentUbb()},getGameUser:function(){var t=PosterContext.getContext().user.gameSignature;return t&&!$.isEmptyObject(t.signature_info)},getPostType:function(){var t=this.isFrs||this.isHotTopic?"thread":"reply";return this.editor.getExtendContent().hasLocalVideo&&(t="thread"==t?"vpostThread":"vpostReply"),t},initUploadUrl:function(){var t=this,e=$.ajax({url:t.tbsUrl,dataType:"json"});e.done(function(e){0===Number(e.no)&&(t.uploadUrl+="?tbs="+e.data.tbs+"&fid="+(PosterContext.getContext().forum.id||"")+"&save_yun_album=1")})},escapeHTML:function(t){return"string"!=typeof t?t:t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},picAllUpload:function(t){var e=this,i=this.$root.find("#ueditor_replace"),o=e.getContent(),s=$("<div>"+o+"</div>"),r=this.$root.find(".ueditor_container .j_error"),n=[],a=s.find("img.BDE_Image");a.remove("pic_upload_error");var l=!1;if(a&&a.length>0){if(a.length>this._options.imgNum)return l=!0,r.text("\u56FE\u7247\u6570\u91CF\u8D85\u51FA\u9650\u5236").show(),!1;for(var c=0;c<a.length;c++)"1"!==a[c].dataset.isupload&&$(a[c]).attr("width")&&n.push(a[c].src);if(n.length>0){var d=null;$.ajax({url:e.uploadUrl,data:{filetype:"url",file:"",urls:n},xhrFields:{withCredentials:!0},crossDomain:!0,type:"POST",async:!1,success:function(o){if(0===o.err_no)for(var s=0;s<o.urls.length;s++){var n=o.urls[s].origin_url,a="https://"+o.urls[s].host+e.PIC_URL_PATH+o.urls[s].pic_id_encode+".jpg",c=i.find("img[src='"+n+"']");0==c.length&&(c=i.find("img[src='"+n.slice(n.indexOf("://")+1)+"']"),d=!0),0==o.urls[s].err_no?(c[0].src=a,c.attr("data-isupload",1),t=t.replace(e.escapeHTML(n),a),t=d?t.replace(e.escapeHTML(n.slice(n.indexOf("://")+1)),a):t.replace(e.escapeHTML(n),a)):(c.addClass("pic_upload_error"),l=!0,r.text("\u8D34\u5B50\u4E2D\u6807\u7EA2\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5").show())}else l=!0,r.text(o.err_msg).show()},error:function(){l=!0,r.text("\u4E0A\u4F20\u56FE\u7247\u5931\u8D25\uFF0C\u8BF7\u7A0D\u5019\u91CD\u8BD5!").show()},dataType:"json"})}}return l?!1:t},getPostData:function(){var t=this.editor.getExtendContent(),e=this.picAllUpload(this.getContentUbb());if(e===!1)return!1;var i={content:e};if(this.isFrs||this.isHotTopic){var o=this.getTitle(),s=this.$title.data("prefix");-1==o.indexOf(s)&&(s=""),o=o.replace(/\u2006/g,""),o=o.replace(s,""),i.title=o,i.prefix=s}t.videoNumber>0&&(i.video_url=t.videoUrl,t.hasLocalVideo&&(i.file_id=t.fileId)),t.ptype&&(i.ptype=t.ptype),t.attachments&&(i.files=t.attachments);var r=this.$root.find(".j_sign_id"),n=this.$root.find(".j_use_signature");n.tbattr("checked")&&r.size()>0&&r.val()&&(i.sign_id=r.val()),i.game_user=this.getGameUser(),i.mouse_pwd=this.MousePwd.report().c,i.mouse_pwd_t=this.MousePwd.time,i.mouse_pwd_isclick=this.MousePwd.MOUSEPWD_CLICK,PageData&&PageData.thread&&PageData.thread.is_novel&&(i.is_novel=1);var a=this.require("common/widget/paypost_data").getInstance();if(a.get("isPaypost")){var l=this.feeEditor||UE.getEditor("ueditor_fee_replace");i.is_paypost=1,i.secret=l.getContentUbb(),i.score=$(l.container).find(".j_paypost_tdou_ipt").val();var c=l.getExtendContent();if(c.attachments){var d=JSON.parse(c.attachments);i.files=JSON.stringify(JSON.parse(i.files).concat(d)),i.secret_files=JSON.stringify(_.pluck(d,"fs_id"))}}return 1===this._options.isPaypost&&(i.is_paypost=1),this.isHotTopic&&PageData.selectedForum&&(i.fid=PageData.selectedForum.forum_id,i.kw=PageData.selectedForum.forum_name),this._options.liveTag&&(i.ui_for_ueg={live_tag:1}),i},togglePostState:function(t){var e=this.$root.find(".j_posting_status");e.toggleClass("poster_posting_status_loading",t),this.toggleSubmitButton(t)},toggleSubmitButton:function(t){this.$submit.toggleClass("ui_btn ui_btn_m",!t),this.$submit.toggleClass("ui_btn_disable ui_btn_m_disable",t),$(".poster_submit").toggleClass("ui_btn_disable ui_btn_m_disable",t)},validateContent:function(){var t=this.isFrs?3e4:1e4,e=this.editor.getContentByteLength(),i=this.editor.getExtendContent(),o=this.$root.find(".ueditor_container .j_error"),s="";if(this.isFrs||this.isHotTopic){var r=$.trim(this.getTitle()),n=this.$title.data("prefix");if(0===r.length)return this.$root.find(".title_container .j_error").text("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1;if(0===r.replace(n,"").length)return this.$root.find(".title_container .j_error").text("\u53EA\u6709\u524D\u7F00\u662F\u4E0D\u884C\u7684\u54DF~\u8BF7\u5728\u524D\u7F00\u540E\u586B\u5199\u6B63\u5F0F\u6807\u9898\uFF01").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1;if(""==$.trim(r.replace(/#([^#]+)#/g,"")))return this.$root.find(".title_container .j_error").text("\u53EA\u6709#\u8BDD\u9898#\u662F\u4E0D\u884C\u7684\u54DF~\u8BF7\u5728\u8BDD\u9898\u540E\u586B\u5199\u6B63\u5F0F\u6807\u9898\uFF01").show(),this.$title.focus(),this.$window.scrollTop(this.$title.offset().top-60),!1;var a=this.require("common/widget/paypost_data").getInstance();if(a.get("isPaypost")){this.feeEditor=UE.getEditor("ueditor_fee_replace");var l=$(this.feeEditor.container),c=l.find(".j_paypost_tdou_ipt").val();if(100>c)return o.text("\u9690\u85CF\u5185\u5BB9\u552E\u4EF7\u987B\u81F3\u5C11100T\u8C46").show(),!1;if(c>1e7)return o.text("\u9690\u85CF\u5185\u5BB9\u552E\u4EF7\u4E0D\u5F97\u9AD8\u4E8E10000000T\u8C46").show(),!1;var d=this.feeEditor.getExtendContent();if(0==$.trim(this.feeEditor.getContent()).length&&"[]"==d.attachments)return o.text("\u4ED8\u8D39\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A").show(),!1;if(this._options.needPaypostAgree&&!a.get("hasAgree")){var h=this.requireInstance("encourage/widget/paypost_agree_dialog");return h.registNextFn(this.post,this),h.show(),!1}}}if(0===e&&!this.isFrs)return this.isHotTopic?o.text("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A").show():o.text("\u56DE\u590D\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A").show(),!1;if(!this.isFrs){var u=this;if(2==PageData.power.reply_private_flag)return $.tb.alert({title:"\u6D88\u606F\u63D0\u793A",showShadow:!1,showTitle:!1,width:"300px",message:"\u7531\u4E8E\u697C\u4E3B\u7684\u8BBE\u7F6E\uFF0C\u4F60\u9700\u8981\u5173\u6CE8TA\u624D\u80FD\u53D1\u8868\u8BC4\u8BBA",buttons:[{text:"\u5173\u6CE8\u5E76\u53D1\u8868",callback:function(){var t=PageData.thread.author,e=PageData.tbs;$.tb.post("/home/post/follow",{un:t,tbs:e},function(t){if(t)if(0==t.no)var e=u.showAlert("\u5173\u6CE8\u6210\u529F",!1),i=setTimeout(function(){clearTimeout(i),e.close(),PageData.power.reply_private_flag=1,u.post()},500);else 1130036==t.no?u.showAlert("\u8BE5\u7528\u6237\u4E0D\u5E0C\u671B\u88AB\u4ED6\u4EBA\u5173\u6CE8",!0):2260001==t.no?u.showAlert("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",!0):u.showAlert("\u5173\u6CE8\u5931\u8D25",!0);else u.showAlert("\u5173\u6CE8\u5931\u8D25",!0)})},"class":"guanzhu"},{text:"\u53D6\u6D88","class":"cancle"}]}),$(".tb_alert_message").css("text-align","center"),!1;if(3==PageData.power.reply_private_flag)return o.text("\u7531\u4E8E\u697C\u4E3B\u7684\u8BBE\u7F6E\uFF0C\u4F60\u65E0\u6CD5\u8BC4\u8BBA\u6B64\u5E16\u54E6").show(),!1}return e>t?(s="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8D85\u8FC7"+t/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u518D\u63D0\u4EA4",o.text(s).show(),!1):i.videoNumber>1?(s="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u89C6\u9891\u4E2A\u6570\u4E0D\u80FD\u8D85\u8FC71\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",o.text(s).show(),!1):i.musicNumber>10?(s="\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u97F3\u4E50\u4E2A\u6570\u4E0D\u80FD\u8D85\u8FC710\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",o.text(s).show(),!1):i.ptype&&!i.ptypePower?(s="\u6CA1\u6709\u9053\u5177\u4F7F\u7528\u6743\u9650\u5C06\u65E0\u6CD5\u53D1\u8868\u6210\u529F",o.text(s).show(),!1):(this.$root.find(".j_error").hide(),!0)},post:function(t){var e=this.validateContent();if(e){var i=this.getPostData();if(!i)return!1;i.nick_name=PageData.user.user_nickname,"1"==PosterContext.getAuthorities().prozone_thread_info.is_pro_thread&&"1"==PosterContext.getAuthorities().prozone_thread_info.is_user_has_right&&(i.pro_zone=1),"object"==typeof postObj&&"object"==typeof t&&$.extend(i,t),!this.postService.isPosting()&&e&&(PosterContext.context.user.isLogin?($.cookie("GET_TOPIC","-",{expires:-1,path:"/"}),this.postService.post(this.getPostType(),i,PosterContext.getContext()),this.togglePostState(!0),_.Module.use("frs/widget/snowflow",[i.content,PosterContext.getContext().product,"rich_poster"])):_.Module.use("common/widget/LoginDialog",["","editor",function(){$.stats.track("\u53D1\u8868\u6309\u94AE_\u767B\u5F55\u6210\u529F","\u975E\u767B\u5F55\u7528\u6237\u53D1\u5E16")}]))}},refresh:function(){var t=$.tb.location.getHref();t=t.replace(/#\w*$/,""),$.tb.location.setHref(t)},focus:function(){this.isFrs||this.isHotTopic?this.$title.focus():$.browser.msie&&$.browser.version<=7||this.editor.focus()},enableFloatingPoster:function(){var t=this;if(!this.$root.hasClass("tb_floating_poster")&&(this.editor.enableHeightLimit(this.$window.height()-450),this.trigger("poster_float"),this.$root.hide().addClass("tb_floating_poster"),this.position&&this.$root.css(this.position),this.$root.fadeIn(function(){t.$root.draggable({handle:t.$root.find(".poster_head"),start:function(){t.$root.css({right:"auto",bottom:"auto"})}})}),"1"!=$.tb.Storage.get("close_float_draggable_bubble"))){var e={content:"\u6D6E\u52A8\u53D1\u8D34\u6846\u53EF\u4EE5<span class='ui_text_emphasize'>\u62D6\u62FD</span>\u4E86\uFF0C\u8D76\u5FEB\u62D6\u52A8\u6807\u9898\u8BD5\u8BD5\uFF01\u66F4\u591A\u8BE6\u60C5<a href='//tieba.baidu.com/mo/q/topic_page/219_1' target='_blank'>\u70B9\u51FB\u8FD9\u91CC</a>",arrow_dir:"down",bubble_css:{top:0,left:10,width:179},wrap:this.$root.find(".j_bubble_container"),closeBtn:!0},i=new UiBubbleTipBase(e);i.bind("onclose",function(){$.tb.Storage.set("close_float_draggable_bubble","1",(new Date).getTime()+2592e6),i.closeBubble()}),i.showBubble()}},disableFloatingPoster:function(){var t=this;t.$root.fadeOut(function(){t.position={left:t.$root.css("left"),top:t.$root.css("top")},t.$root.draggable("destroy").css({left:"auto",top:"auto"}),t.$root.removeClass("tb_floating_poster").show(),PosterContext.getAuthorities().long_editor?t.editor.disableHeightLimit():t.editor.enableHeightLimit()})},_viewPortOn:function(t){var e=this.$window.scrollTop(),i=e+this.$window.height(),o=t.offset().top,s=o+t.height();return{isOnScreen:i>o&&s>e,topToBottom:i-o,bottomToTop:s-e,topToTop:o-e,bottomToBottom:i-s}},setBlessCookie:function(){var t=PosterContext.getContext().forum.id,e=$.cookie("bless_post_"+t);null==e&&$.cookie("bless_post_"+t,1,1)}}});var baidusearch=function(){function e(e){function t(){var e="getSelection"in window,t=document.getElementById("selectsearch-icon");t&&t.parentNode.removeChild(t),setTimeout(function(){selection=e?window.getSelection():document.selection.createRange();var t=(e?selection+"":selection.text).replace(/\n+/g,"");t&&t.length&&(t.length>76&&(t=t.substring(0,76)),n(e,selection,t))},25)}function n(t,n,o){var c=document.body.scrollTop+document.documentElement.scrollTop,i=document.body.scrollLeft+document.documentElement.scrollLeft;if(t){var a=n.getRangeAt(0).getBoundingClientRect();if(0==a.top&&0==a.right)return;var d=a.top>35?a.top-35+c:c,r=a.right+70>document.documentElement.clientWidth?document.documentElement.clientWidth-65+i:a.right+5+i}else var s=n.boundingLeft+n.boundingWidth,d=n.boundingTop>35?n.boundingTop-35+c:c,r=s+70>document.documentElement.clientWidth?document.documentElement.clientWidth-65+i:s+i;var o=encodeURI(o),l=document.createElement("img");l.src="//tb2.bdstatic.com/tb/static-pb/widget/baidusearch/select-search_9b9b8e9.png",l.alt="\u641C\u7D22",l.style.cssText="width:65px; height:31px; border:0px none;";var u=document.createElement("a");u.id="selectsearch-icon",u.style.cssText="cursor:pointer; position:absolute;",u.href="https://www.baidu.com/s?ie=utf-8&wd="+o+"&tn="+e+"&hl_tag=flayer",u.target="_blank",u.onclick=function(){try{u.parentNode.removeChild(u)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/baidusearch/baidusearch.js",method:"",ln:52}),e}},u.style.left=r+"px",u.style.top=d+"px",u.appendChild(l),document.body.appendChild(u),l.onmouseup=function(e){e=e||window.event,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}}function o(e,t,n){window.attachEvent?e.attachEvent("on"+t,n):window.addEventListener&&e.addEventListener(t,n,!1)}o(document,"mouseup",t)}return{init:e}}();_.Module.define({path:"pb/widget/Baidusearch",sub:{initial:function(){try{this._baiduSearch()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/baidusearch/baidusearch.js",method:"",ln:87}),e}},_baiduSearch:function(){baidusearch.init("SE_hldp00980_x3znwgz5"),$(document.body).on("click",function(e){try{var t=e.target,n=$(t).parent();"selectsearch-icon"===n.tbattr("id")&&$.stats.track("Pb_huaci_search","ps_callback_statics")}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"pb:widget/baidusearch/baidusearch.js",method:"",ln:97}),o}})}}});_.Module.define({requires:["pb/widget/Baidusearch"],path:"pb/widget/Stat",sub:{initial:function(){try{$.stats.scanPage(),this._wpoTongji(),this._baiduSearch()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/stat/stat.js",method:"",ln:10}),t}},_baiduSearch:function(){this.requireInstance("pb/widget/Baidusearch")},_wpoTongji:function(){window.alogObjectConfig={product:"14",page:"14_1",monkey_page:"tieba-pb",speed_page:"1",speed:{sample:PageData.is_ipad?1:.01},monkey:{sample:"0.05",hid:"762"},exception:{sample:"0.05"},csp:{sample:"0.004","script-src":[{match:"*bae.baidu.com",target:"Accept,Warn"},{match:"*.baidu.com,*.bdstatic.com,*.baidustatic.com,*.bdimg.com,www.aipai.com,jump.luna.58.com,www.pokersc.cn",target:"Accept"},{match:/^(127|172|192|10)(\.\d+){3}$/,target:"Accept"},{match:"*",target:"Accept,Warn"}]}}}}});var T,baidu=T=baidu||{version:"1.5.0"};baidu.guid="$BAIDU$",window[baidu.guid]=window[baidu.guid]||{},baidu.fn=baidu.fn||{},baidu.fn.blank=function(){},baidu.string=baidu.string||{},baidu.string.format=function(t,e){t=String(t);var i=Array.prototype.slice.call(arguments,1),n=Object.prototype.toString;return i.length?(i=1==i.length&&null!==e&&/\[object Array\]|\[object Object\]/.test(n.call(e))?e:i,t.replace(/#\{(.+?)\}/g,function(t,e){var s=i[e];return"[object Function]"==n.call(s)&&(s=s(e)),"undefined"==typeof s?"":s})):t},baidu.format=baidu.string.format,baidu.object=baidu.object||{},baidu.object.each=function(t,e){var i,n,s;if("function"==typeof e)for(n in t)if(t.hasOwnProperty(n)&&(s=t[n],i=e.call(t,s,n),i===!1))break;return t},baidu.extend=baidu.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},baidu.number=baidu.number||{},baidu.number.pad=function(t,e){var i="",n=0>t,s=String(Math.abs(t));return s.length<e&&(i=new Array(e-s.length+1).join("0")),(n?"-":"")+i+s},baidu.platform=baidu.platform||{},baidu.platform.isAndroid=/android/i.test(navigator.userAgent),baidu.platform.isIpad=/ipad/i.test(navigator.userAgent),baidu.platform.isIphone=/iphone/i.test(navigator.userAgent),baidu.swf=baidu.swf||{},baidu.browser=baidu.browser||{},baidu.browser.ie=baidu.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,baidu.array=baidu.array||{},baidu.array.remove=function(t,e){for(var i=t.length;i--;)i in t&&t[i]===e&&t.splice(i,1);return t},baidu.lang=baidu.lang||{},baidu.lang.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)},baidu.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},baidu.lang.toArray=function(t){if(null===t||void 0===t)return[];if(baidu.lang.isArray(t))return t;if("number"!=typeof t.length||"string"==typeof t||baidu.lang.isFunction(t))return[t];if(t.item){for(var e=t.length,i=new Array(e);e--;)i[e]=t[e];return i}return[].slice.call(t)},baidu.swf.getMovie=function(t){var e,i=document[t];return 9==baidu.browser.ie?i&&i.length?1==(e=baidu.array.remove(baidu.lang.toArray(i),function(t){return"embed"!=t.tagName.toLowerCase()})).length?e[0]:e:i:i||window[t]},baidu.swf.version=function(){var t=navigator;if(t.plugins&&t.mimeTypes.length){var e=t.plugins["Shockwave Flash"];if(e&&e.description)return e.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}else if(window.ActiveXObject&&!window.opera)for(var i=12;i>=2;i--)try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i);if(n){var s=n.GetVariable("$version");return s.replace(/WIN/g,"").replace(/,/g,".")}}catch(a){}}(),baidu.string.encodeHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},baidu.encodeHTML=baidu.string.encodeHTML,baidu.swf.createHTML=function(t){t=t||{};var e,i,n,s,a,r,o=baidu.swf.version,u=t.ver||"6.0.0",l={},h=baidu.string.encodeHTML;for(s in t)l[s]=t[s];if(t=l,!o)return"";for(o=o.split("."),u=u.split("."),n=0;3>n&&(e=parseInt(o[n],10),i=parseInt(u[n],10),!(e>i));n++)if(i>e)return"";var d=t.vars,c=["classid","codebase","id","width","height","align"];if(t.align=t.align||"middle",t.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",t.codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0",t.movie=t.url||"",delete t.vars,delete t.url,"string"==typeof d)t.flashvars=d;else{var g=[];for(s in d)r=d[s],g.push(s+"="+encodeURIComponent(r));t.flashvars=g.join("&")}var p=["<object "];for(n=0,a=c.length;a>n;n++)r=c[n],p.push(" ",r,'="',h(t[r]),'"');p.push(">");var f={wmode:1,scale:1,quality:1,play:1,loop:1,menu:1,salign:1,bgcolor:1,base:1,allowscriptaccess:1,allownetworking:1,allowfullscreen:1,seamlesstabbing:1,devicefont:1,swliveconnect:1,flashvars:1,movie:1};for(s in t)r=t[s],s=s.toLowerCase(),f[s]&&(r||r===!1||0===r)&&p.push('<param name="'+s+'" value="'+h(r)+'" />');t.src=t.movie,t.name=t.id,delete t.id,delete t.movie,delete t.classid,delete t.codebase,t.type="application/x-shockwave-flash",t.pluginspage="http://www.macromedia.com/go/getflashplayer",p.push("<embed");var m;for(s in t)if(r=t[s],r||r===!1||0===r){if(new RegExp("^salign$","i").test(s)){m=r;continue}p.push(" ",s,'="',h(r),'"')}return m&&p.push(' salign="',h(m),'"'),p.push("></embed></object>"),""},baidu.swf.create=function(t,e){t=t||{};var i=baidu.swf.createHTML(t)||t.errorMessage||"";e&&"string"==typeof e&&(e=document.getElementById(e)),e?e.innerHTML=i:document.write(i)},function(){var t=window[baidu.guid];baidu.lang.guid=function(){return"TANGRAM__"+(t._counter++).toString(36)},t._counter=t._counter||1}(),window[baidu.guid]._instances=window[baidu.guid]._instances||{},baidu.lang.Class=function(t){this.guid=t||baidu.lang.guid(),window[baidu.guid]._instances[this.guid]=this},window[baidu.guid]._instances=window[baidu.guid]._instances||{},baidu.lang.Class.prototype.dispose=function(){delete window[baidu.guid]._instances[this.guid];for(var t in this)baidu.lang.isFunction(this[t])||delete this[t];this.disposed=!0},baidu.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},baidu.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},baidu.isString=baidu.lang.isString,baidu.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},baidu.lang.Class.prototype.addEventListener=function(t,e,i){if(baidu.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var n,s=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;e.hashCode=i,n=i}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof s[t]&&(s[t]={}),n=n||baidu.lang.guid(),e.hashCode=n,s[t][n]=e}},baidu.lang.Class.prototype.removeEventListener=function(t,e){if("undefined"==typeof e||(!baidu.lang.isFunction(e)||(e=e.hashCode))&&baidu.lang.isString(e)){!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var i=this.__listeners;if(i[t])if("undefined"!=typeof e)i[t][e]&&delete i[t][e];else for(var n in i[t])delete i[t][n]}},baidu.lang.Class.prototype.dispatchEvent=function(t,e){baidu.lang.isString(t)&&(t=new baidu.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var i in e)t[i]=e[i];var i,n=this.__listeners,s=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=s.indexOf("on")&&(s="on"+s),baidu.lang.isFunction(this[s])&&this[s].apply(this,arguments),"object"==typeof n[s])for(i in n[s])n[s][i].apply(this,arguments);return t.returnValue},baidu.lang.createClass=function(t,e){e=e||{};var i=e.superClass||baidu.lang.Class,n=function(){i!=baidu.lang.Class?i.apply(this,arguments):i.call(this),t.apply(this,arguments)};n.options=e.options||{};var s=function(){},a=t.prototype;s.prototype=i.prototype;var r=n.prototype=new s;for(var o in a)r[o]=a[o];return"string"==typeof e.className&&(r._className=e.className),r.constructor=a.constructor,n.extend=function(t){for(var e in t)n.prototype[e]=t[e];return n},n},baidu.lang.inherits=function(t,e,i){var n,s,a=t.prototype,r=new Function;r.prototype=e.prototype,s=t.prototype=new r;for(n in a)s[n]=a[n];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof i&&(s._className=i)},baidu.inherits=baidu.lang.inherits,baidu.lang.isBoolean=function(t){return"boolean"==typeof t},baidu.lang.isElement=function(t){return!(!t||!t.nodeName||1!=t.nodeType)},baidu.lang.isNumber=function(t){return"[object Number]"==Object.prototype.toString.call(t)&&isFinite(t)},baidu.lang.isObject=function(t){return"function"==typeof t||!(!t||"object"!=typeof t)},baidu.isObject=baidu.lang.isObject,baidu.fn.bind=function(t,e){var i=arguments.length>2?[].slice.call(arguments,2):null;return function(){var n=baidu.lang.isString(t)?e[t]:t,s=i?i.concat([].slice.call(arguments,0)):arguments;return n.apply(e||n,s)}},baidu.each=baidu.array.forEach=baidu.array.each=function(t,e,i){var n,s,a,r=t.length;if("function"==typeof e)for(a=0;r>a&&(s=t[a],n=e.call(i||t,s,a),n!==!1);a++);return t},baidu.array.some=function(t,e,i){for(var n=0,s=t.length;s>n;n++)if(n in t&&e.call(i||t,t[n],n))return!0;return!1},baidu.browser.chrome=/chrome\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,baidu.browser.firefox=/firefox\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,baidu.browser.isWebkit=/webkit/i.test(navigator.userAgent);try{/(\d+\.\d+)/.test(external.max_version)&&(baidu.browser.maxthon=+RegExp.$1)}catch(e){}!function(){var t=navigator.userAgent;baidu.browser.safari=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(t)&&!/chrome/i.test(t)?+(RegExp.$1||RegExp.$2):void 0}(),baidu.dom=baidu.dom||{},baidu.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},baidu.g=baidu.G=baidu.dom.g,baidu.dom._styleFixer=baidu.dom._styleFixer||{},baidu.dom._styleFilter=baidu.dom._styleFilter||[],baidu.dom._styleFilter.filter=function(t,e,i){for(var n,s=0,a=baidu.dom._styleFilter;n=a[s];s++)(n=n[i])&&(e=n(t,e));return e},baidu.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},baidu.dom.setStyle=function(t,e,i){var n,s=baidu.dom;return t=s.g(t),e=baidu.string.toCamelCase(e),(n=s._styleFilter)&&(i=n.filter(e,i,"set")),n=s._styleFixer[e],n&&n.set?n.set(t,i):t.style[n||e]=i,t},baidu.setStyle=baidu.dom.setStyle,baidu.dom.setStyles=function(t,e){t=baidu.dom.g(t);for(var i in e)baidu.dom.setStyle(t,i,e[i]);return t},baidu.setStyles=baidu.dom.setStyles,baidu.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return baidu.browser.ie<8?(t["for"]="htmlFor",t["class"]="className"):(t.htmlFor="for",t.className="class"),t}(),baidu.dom.setAttr=function(t,e,i){return t=baidu.dom.g(t),"style"==e?t.style.cssText=i:(e=baidu.dom._NAME_ATTRS[e]||e,t.setAttribute(e,i)),t},baidu.setAttr=baidu.dom.setAttr,baidu.dom.setAttrs=function(t,e){t=baidu.dom.g(t);for(var i in e)baidu.dom.setAttr(t,i,e[i]);return t},baidu.setAttrs=baidu.dom.setAttrs,baidu.dom.create=function(t,e){var i=document.createElement(t),n=e||{};return baidu.dom.setAttrs(i,n)},baidu.cookie=baidu.cookie||{},baidu.cookie._isValidKey=function(t){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(t)},baidu.cookie.getRaw=function(t){if(baidu.cookie._isValidKey(t)){var e=new RegExp("(^| )"+t+"=([^;]*)(;|$)"),i=e.exec(document.cookie);if(i)return i[2]||null}return null},baidu.cookie.get=function(t){var e=baidu.cookie.getRaw(t);return"string"==typeof e?e=decodeURIComponent(e):null},baidu.cookie.setRaw=function(t,e,i){if(baidu.cookie._isValidKey(t)){i=i||{};var n=i.expires;"number"==typeof i.expires&&(n=new Date,n.setTime(n.getTime()+i.expires)),document.cookie=t+"="+e+(i.path?"; path="+i.path:"")+(n?"; expires="+n.toGMTString():"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":"")}},baidu.cookie.remove=function(t,e){e=e||{},e.expires=new Date(0),baidu.cookie.setRaw(t,"",e)},baidu.cookie.set=function(t,e,i){baidu.cookie.setRaw(t,encodeURIComponent(e),i)},baidu.sio=baidu.sio||{},baidu.sio._createScriptTag=function(t,e,i){t.setAttribute("type","text/javascript"),i&&t.setAttribute("charset",i),t.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(t)},baidu.sio._removeScriptTag=function(t){if(t.clearAttributes)t.clearAttributes();else for(var e in t)t.hasOwnProperty(e)&&delete t[e];t&&t.parentNode&&t.parentNode.removeChild(t),t=null},baidu.sio.callByServer=function(t,e,i){function n(t){return function(){try{t?l.onfailure&&l.onfailure():(e.apply(window,arguments),clearTimeout(a)),window[s]=null,delete window[s]}catch(i){}finally{baidu.sio._removeScriptTag(o)}}}var s,a,r,o=document.createElement("SCRIPT"),u="bd__cbs__",l=i||{},h=l.charset,d=l.queryField||"callback",c=l.timeOut||0,g=new RegExp("(\\?|&)"+d+"=([^&]*)");baidu.lang.isFunction(e)?(s=u+Math.floor(2147483648*Math.random()).toString(36),window[s]=n(0)):baidu.lang.isString(e)?s=e:(r=g.exec(t))&&(s=r[2]),c&&(a=setTimeout(n(1),c)),t=t.replace(g,"$1"+d+"="+s),t.search(g)<0&&(t+=(t.indexOf("?")<0?"?":"&")+d+"="+s),baidu.sio._createScriptTag(o,t,h)};var mbox=mbox||{};T.extend(mbox,{namespace:function(){var t,e,i,n=arguments,s=null;for(t=0,len=n.length;len>t;t++)for(i=(""+n[t]).split("."),s=mbox,e="mbox"==i[0]?1:0;e<i.length;e+=1)s[i[e]]=s[i[e]]||{},s=s[i[e]];return s},Fuze:function(){var t,e,i;return t=[],e=function(e){i?e():t.push(e)},e.fire=function(){for(;t.length;)t.shift()();i=!0},e.extinguish=function(){i=!1},e.wettish=function(){this.fire(),this.extinguish()},e.clear=function(){for(;t.length;)t.shift();this.extinguish()},e},convertTime:function(t){var e,i;return t=Math.round(t/1e3),e=Math.floor(t/60),i=t%60,T.number.pad(e,2)+":"+T.number.pad(i,2)},Timer:function(t){var e=function(t,e){this._timer=function(){},this._listener=function(){},this._timerComplete=function(){},this._timerID=null,this._delay=this._remain=t,this._repeatCount=e||0,this._currentCount=0,this._isRunning=!1,this._startTime=this._endTime=0,this.EVENTS={TIMER:"timer",COMPLETE:"timerComplete"}};return e.prototype={_createTimer:function(e,i){var n=this;return 1==i?function(){return t.setTimeout(function(){n.reset(),n._listener(n._delay,i),n._timerComplete()},e)}:function(){return t.setInterval(function(){0!=i&&n._currentCount>=i?(n.reset(),n._timerComplete()):(n._currentCount++,n._listener(e,n._currentCount))},e)}},addEventListener:function(t,e){"timer"==t?(this._listener=e,this._timer=this._createTimer(this._delay,this._repeatCount)):"timerComplete"==t&&(this._timerComplete=e)},reset:function(){this.stop(),1==this._repeatCount&&(this._timer=this._createTimer(this._delay,this._repeatCount)),this._currentCount=0,this._remain=this._delay,this._startTime=this._endTime=0},start:function(){this._timerID||(this._timerID=this._timer(),1==this._repeatCount&&(this._startTime=(new Date).getTime()),this._isRunning=!0)},stop:function(){this._timerID&&(1==this._repeatCount?t.clearTimeout(this._timerID):t.clearInterval(this._timerID),this._timerID=null,this._isRunning=!1)},pause:function(){1==this._repeatCount?this._timerID&&(this.stop(),this._endTime=(new Date).getTime(),this._remain=this._remain-(this._endTime-this._startTime),this._remain>0?this._timer=this._createTimer(this._remain,1):this.reset()):this.stop()},getCurrentCount:function(){return this._currentCount},isRunning:function(){return this._isRunning}},e}(window),StopWatch:function(){var t=0,e=function(){this.startTime=0,this.isRunning=!1,this.isReset=!0,this.passedTime=0,t++};return e.prototype={reset:function(){this.startTime=0,this.pauseTime=0,this.passedTime=0,this.isRunning=!1,this.isReset=!0},start:function(){this.isReset?(this.reset(),this.startTime=(new Date).getTime()):this.isRunning||(this.startTime=(new Date).getTime()),this.isRunning=!0,this.isReset=!1},pause:function(){!this.isReset&&this.isRunning&&(this.pauseTime=(new Date).getTime(),this.passedTime+=this.pauseTime-this.startTime,this.isRunning=!1)},isRunning:function(){return this.isRunning},isReset:function(){return this.isReset},getTime:function(){return this.isReset?0:this.isRunning?(new Date).getTime()-this.startTime+this.passedTime:this.passedTime},getCounts:function(){return t}},e}(window)}),mbox.namespace("mbox.lang"),T.extend(mbox.lang,{createClass:function(t,e){var i=T.lang.createClass(t,e);return i.prototype.removeEventListener=function(t,e){if("undefined"==typeof e||(!baidu.lang.isFunction(e)||(e=e.hashCode))&&baidu.lang.isString(e)){!this.__listeners&&(this.__listeners={});var i=t.split(".");t.length>1&&(t=i[0],e=i[1]),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;if(n[t])if("undefined"!=typeof e)n[t][e]&&delete n[t][e];else for(var s in n[t])delete n[t][s]}},i.extend=function(t){for(var e in t)i.prototype[e]=function(t,e){return T.lang.isFunction(t)?function(){this.dispatchEvent(e,{name:e,arguments:arguments});var i=t.apply(this,arguments);return i}:t}(t[e],e);return i},i}});var mbox=mbox||{};!function(){var t="mbox";mbox.CONF={instanceCallName:t,autoPlay:!1,autoNext:!1,engineArg:{audio:{constructorName:"PlayEngine_Audio"},fmp:{constructorName:"PlayEngine_FMP_MP3",args:{swfPath:"https://gss2.baidu.com/5LgHhXSm2Q5IlBGlnYG/player/static/flash/fmp.swf",instanceName:t+".player"}}},logOpt:{ref:"pc_widget_tieba"},songLinkHost:{link:"https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.song.play&format=jsonp&bit=128&songid=",lrc:"https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.song.lry&fromat=jsonp&songid=",sug:"https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.search.common&page_size=1&page_no=1&query="}}}(void 0);var PlayEngine_Interface=mbox.lang.createClass(function(){var t=0,e={mute:!1,volume:50},i=function(t){this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"},this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"},t=t||{},this.mute="undefined"==typeof t.mute?e.mute:!!t.mute,this.volume="undefined"==typeof t.volume?e.volume:t.volume,this.ready=!1,this.url="",this.state=this.STATES.INIT,this.engineType="",this.stateStack=[this.STATES.INIT],this.supportMimeType=[]};return i.prototype={newId:function(){return"_m3_"+t++},init:function(){},reset:function(){},setUrl:function(){},getUrl:function(){return this.url},play:function(){},pause:function(){},stop:function(){},setMute:function(){},getMute:function(){return this.mute},setVolume:function(){},getVolume:function(){return this.volume},getState:function(){return""},setCurrentPosition:function(){},getCurrentPosition:function(){return 0},getLoadedPercent:function(){return 0},getLoadedBytes:function(){return 0},getTotalBytes:function(){return 0},getTotalTime:function(){return 0},getVersion:function(){return""},getEngineType:function(){return this.engineType},canPlayType:function(t){var e=this.getSupportMimeTypeList();return T.array.some(e,function(e){return t==e})},getSupportMimeTypeList:function(){return this.supportMimeType},setEventListener:function(t,e,i){var n=T.fn.bind(function(){return e.apply(this,arguments)},this);this.addEventListener(t,n,i)}},i}(window),{superClass:T.lang.Class,className:"PlayEngine_Interface"}),PlayEngine_Audio=mbox.lang.createClass(function(t){t=t||{},this.engineType="audio",this.contentType={mp3:["audio/mpeg","audio/mp3"],mp4:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],m4a:["audio/mp4","audio/MP4A-LATM","video/mpeg4","audio/mpeg4-generic"],aac:["audio/aac","audio/aacp"],"3gp":["audio/3gpp","audio/3gpp2"],ogg:["audio/ogg","video/ogg","application/ogg","audio/vorbis"],oga:["audio/ogg","application/ogg","audio/vorbis"],wma:["audio/x-ms-wma"]},this.supportAudio="undefined"!=typeof Audio,this.supportMimeType=[],this.supportAudio&&(this.audio=new Audio,"function"==typeof this.audio.canPlayType&&T.object.each(this.contentType,T.fn.bind(function(t,e){for(var i=0;i<t.length;i++){var n=this.audio.canPlayType(t[i]);if("probably"==n||"maybe"==n){this.supportMimeType.push(e);break}}},this)),this.supportMimeType.length||(this.supportAudio=!1)),this.supportVolume=T.fn.bind(function(){return this.supportAudio?(this.audio.volume=.5,this.audio.volume<1):!1},this)()},{superClass:PlayEngine_Interface,className:"PlayEngine_Audio"}).extend({test:function(t){return t=!!t,!this.supportAudio&&t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),this.supportAudio},init:function(){this.lastState=this.STATES.INIT,this.muted=this.audio.muted=!1,this.volume=50,this.audio.volume=.5,this.url="",this._definedEvents(),this.state=this.STATES.READY,this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.audio})},reset:function(){this.supportAudio&&(this.url="",this.audio.pause(),this.state="ready",this.lastState="ready")},setUrl:function(t){this.supportAudio&&(this.url=t,this.audio.src=t,this.audio.load(),this._firePlayStateChange(this.STATES.PREBUFFER))},play:function(){if(this.supportAudio&&"ready"!=this.state)if(T.platform.isAndroid&&T.browser.isWebkit&&this.audio.readyState<3){var t=T.fn.bind(function(){this.audio.play(),this.audio.removeEventListener("canplay",t,!1)},this);this.audio.addEventListener("canplay",t,!1)}else this.audio.play()},pause:function(){this.supportAudio&&this.state!=this.STATES.STOP&&this.state!=this.STATES.READY&&this.state!=this.STATES.END&&(this.audio.pause(),this._firePlayStateChange(this.STATES.PAUSE))},stop:function(){this.supportAudio&&this.state!=this.STATES.READY&&(0!=this.audio.currentTime&&(this.audio.currentTime=0),this.audio.pause(),this._firePlayStateChange(this.STATES.STOP))},setMute:function(t){this.supportAudio&&(this.audio.muted=this.mute=t)},setVolume:function(t){this.supportAudio&&(t=T.lang.isNumber(t)?t:50,t=Math.max(Math.min(t,100),0),this.volume=t,this.audio.volume=t/100)},setCurrentPosition:function(t){if(this.supportAudio)if(T.platform.isAndroid&&this.audio.readyState<3){var e=T.fn.bind(function(){this.audio.currentTime=t/1e3,this.audio.play(),this.audio.removeEventListener("canplay",e,!1)},this);this.audio.addEventListener("canplay",e,!1)}else this.audio.currentTime=t/1e3,this.audio.play()},getCurrentPosition:function(){return this.supportAudio?Math.round(1e3*this.audio.currentTime):0},getLoadedPercent:function(){try{var t=this.audio.buffered.end(0),e=this.audio.duration;return e=isNaN(e)?0:e,Math.round(t/e*100)/100}catch(i){return 0}},getTotalTime:function(){if(!this.supportAudio)return 0;var t=this.audio.duration;return t=isNaN(t)?0:t,Math.round(1e3*t)},getState:function(){return this.state},_firePlayStateChange:function(t){this.state!=t&&(this.lastState=this.state,this.state=t,this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:t,oldState:this.lastState,engineType:this.engineType}))},_definedEvents:function(){this.audio.addEventListener("error",T.fn.bind(function(){this._firePlayStateChange(this.STATES.ERROR),this.dispatchEvent(this.EVENTS.ERROR,{engineType:this.engineType})},this),!1),this.audio.addEventListener("ended",T.fn.bind(function(){this._firePlayStateChange(this.STATES.END)},this),!1),this.audio.addEventListener("playing",T.fn.bind(function(){this._firePlayStateChange(this.STATES.PLAY)},this),!1),this.audio.addEventListener("pause",T.fn.bind(function(){this.getState()==this.STATES.PLAY&&this._firePlayStateChange(this.getCurrentPosition()?this.STATES.PAUSE:this.STATES.STOP)},this),!1),this.audio.addEventListener("waiting",T.fn.bind(function(){this._firePlayStateChange(this.getCurrentPosition()?this.STATES.BUFFERING:this.STATES.PREBUFFER)},this),!1)}}),PlayEngine_FMP_MP3=mbox.lang.createClass(function(t){t=t||{},this.supportMimeType=["mp3"],this.engineType="fmp_mp3",this.swfPath="fmp_mp3.swf",this.flashVersionRequire=t.flashVersionRequire||"9.0.0",this.versionErrorMessage=t.versionErrorMessage||"",this.stateCode={"-2":this.STATES.INIT,"-1":this.STATES.READY,0:this.STATES.STOP,1:this.STATES.PLAY,2:this.STATES.PAUSE,3:this.STATES.END,4:this.STATES.BUFFERING,5:this.STATES.PREBUFFER,6:this.STATES.ERROR},this.flashLoaded=!1,this.flashReady=new mbox.Fuze},{superClass:PlayEngine_Interface,className:"PlayEngine_FMP_MP3"}).extend({test:function(t){return this._checkPlayer(t)},init:function(t){t=t||{};var e=t.el;this.instanceName=t.instanceName,this.swfPath=t.swfPath||this.swfPath;var i,n=this.newId();T.lang.isString(e)&&(e=T.g(e)),e||(e=T.dom.create("div"),document.body.appendChild(e)),i=T.dom.create("div"),e.appendChild(i),this.swfPath+="?"+n+"_"+Math.random(),T.swf.create({id:this.flashObjectId=n,width:"1px",height:"1px",ver:this.flashVersionRequire,errorMessage:this.versionErrorMessage,allowscriptaccess:"always",url:this.swfPath,bgcolor:"#ffffff",wmode:"window",scale:"noscale",vars:{_instanceName:this.instanceName+"",_buffertime:2e3}},i),this.flashObject=T.swf.getMovie(this.flashObjectId)},reset:function(){this.stop(),this.state!=this.STATES.INIT&&(this.url="",this.state=this.STATES.READY,this.stateStack=[this.STATES.READY])},setUrl:function(t){this.flashReady(T.fn.bind(function(){this.url=t,this.flashObject.closeStream(),this.flashObject.f_load(t)},this))},play:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.PLAY&&this.flashObject.f_play()},this))},pause:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.PAUSE&&this.state!=this.STATES.STOP&&this.state!=this.STATES.END&&this.flashObject.f_pause()},this))},stop:function(){this.flashReady(T.fn.bind(function(){this.state!=this.STATES.STOP&&this.flashObject.f_stop()},this))},setMute:function(t){this.flashReady(T.fn.bind(function(){this.mute=t,this.flashObject.setData("mute",t)},this))},setVolume:function(t){this.flashReady(T.fn.bind(function(){this.volume=t,this.flashObject.setData("volume",t)},this))},setCurrentPosition:function(t){this.flashReady(T.fn.bind(function(){this.flashObject.f_play(t)},this))},getCurrentPosition:function(){return this.flashLoaded?this.flashObject.getData("currentPosition"):0},getLoadedPercent:function(){return this.flashLoaded?this.flashObject.getData("loadedPct"):0},getTotalTime:function(){return this.flashLoaded?this.flashObject.getData("length"):0},getState:function(t){return T.lang.isNumber(t)?this.stateCode[t]:this.state},getVersion:function(){return T.swf.version},_firePlayStateChange:function(t){if(this.state!=t){this.state=t,this.stateStack.push(t);var e=this.stateStack.shift();this.dispatchEvent(this.EVENTS.STATECHANGE,{newState:t,oldState:e,engineType:this.engineType})}},_onLoad:function(){this.state=this.STATES.READY,this.stateStack=[this.state],this.dispatchEvent(this.EVENTS.INIT,{engineType:this.engineType,engine:this.flashObject}),setTimeout(T.fn.bind(function(){this.flashReady.fire(),this.flashLoaded=!0},this),0)},_onPlayStateChange:function(t){setTimeout(T.fn.bind(function(){this._firePlayStateChange(this.getState(t))},this),0)},_checkPlayer:function(t){t=!!t;var e=T.swf.version,i=this.flashVersionRequire;if(e){var n=e.split("."),s=i.split(".");return n[0]-s[0]>=0&&n[1]-s[1]>=0?!0:(t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),!1)}return t&&this.dispatchEvent(this.EVENTS.INITFAIL,{engineType:this.engineType}),!1}}),PlayEngine=mbox.lang.createClass(function(t){t=t||{},this.subEnginesConf=[],this.subEnginesInitArgs={},this.curEngine=null,this.curEngineType="",this.unInitEngineList=[],this.engineList=[],this.engineTypeList=[],this.ready=!1,this.defaultExt=".mp3",this.coreContainer=null,this.EVENTS={STATECHANGE:"player_playStateChange",POSITIONCHANGE:"player_positionChange",PROGRESS:"player_progress",ERROR:"player_error",INIT:"player_initSuccess",INITFAIL:"player_initFail"},this.STATES={INIT:"init",READY:"ready",STOP:"stop",PLAY:"play",PAUSE:"pause",END:"end",BUFFERING:"buffering",PREBUFFER:"pre-buffer",ERROR:"error"},this.progressTimer=new mbox.Timer(200,0),this.positionTimer=new mbox.Timer(100,0),this._initEngines(t)},{className:"PlayEngine"}).extend({_error:function(t){throw new Error(t)},_initEngines:function(config){this.coreContainer=config.el||null,this.subEnginesConf=config.subEngines||[],T.array.each(this.subEnginesConf,T.fn.bind(function(item,index){var subEngineName=item.constructorName,args=item.args||{},subEngineConstructor;this.subEnginesInitArgs[subEngineName]=args;try{if(subEngineConstructor=eval(subEngineName),!T.lang.isFunction(subEngineConstructor))return}catch(e){return}var engine=new subEngineConstructor(args);this.unInitEngineList.push(engine)},this)),this.curEngine=this.unInitEngineList[0]},init:function(t){if(this.ready)return this._error("");if(t=t||{},this.subEnginesInitArgs=t.subEngines?t.subEngines:this.subEnginesInitArgs,this.coreContainer=t.el?t.el:this.coreContainer,!this.coreContainer){var e=T.dom.create("div",{id:"_player_container_"+T.lang.guid()});T.dom.setStyles(e,{width:"1px",height:"1px",overflow:"hidden"}),document.body.appendChild(e),this.coreContainer=t.el=e}T.array.each(this.unInitEngineList,T.fn.bind(function(t){var e=t.toString(),i="",n=/^\[object (.*)\]$/i;n.test(e)&&(i=RegExp.$1);var s=this.subEnginesInitArgs[i]||{};t.test(!0)&&(s.instanceName=s.instanceName+".engineList["+this.engineList.length+"]",s.el=s.el||this.coreContainer,this.engineList.push(t),t.init.apply(t,[s]))},this)),this.switchEngineByUrl(this.defaultExt),this.ready=!0,this._initProgressEvent(),this._initPositionChangeEvent()},canPlayType:function(t){return T.array.some(this.engineList,function(e){return e.canPlayType(t)})},getSupportMimeTypeList:function(){var t=[];return T.array.each(this.engineList,T.fn.bind(function(e){t=t.concat(e.getSupportMimeTypeList())},this)),t},switchEngineByUrl:function(t){var e=T.array.some(this.engineList,T.fn.bind(function(e){var i=e.getSupportMimeTypeList().join("|"),n=new RegExp("\\.("+i+")(\\?|$)","ig");return n.test(t)?(this.curEngine=e,this.curEngineType=e.getEngineType(),!0):void 0},this)),i=arguments[1];e||i||arguments.callee.apply(this,[this.defaultExt,!0])},switchEngineByMimeType:function(t){T.array.some(this.engineList,T.fn.bind(function(e){return e.canPlayType(t)?(this.curEngine=e,this.curEngineType=e.getEngineType(),!0):void 0},this))},reset:function(){this.curEngine.reset.apply(this.curEngine,arguments)},setUrl:function(t){var e=this.curEngine;this.switchEngineByUrl(t),e&&e!=this.curEngine&&e.stop(),this.curEngine&&this.curEngine.setUrl.apply(this.curEngine,arguments)},getUrl:function(){return this.curEngine.getUrl.apply(this.curEngine,arguments)},play:function(t){return"undefined"!=typeof t?this.setCurrentPosition(t):this.curEngine?this.curEngine.play.apply(this.curEngine,arguments):void 0},pause:function(){return this.curEngine?this.curEngine.pause.apply(this.curEngine,arguments):void 0},stop:function(){return this.curEngine?this.curEngine.stop.apply(this.curEngine,arguments):void 0},setMute:function(){var t=arguments;T.array.each(this.engineList,function(e){e.setMute.apply(e,t)})},getMute:function(){return this.curEngine?this.curEngine.getMute.apply(this.curEngine,arguments):!1},setVolume:function(){var t=arguments;T.array.each(this.engineList,function(e){e.setVolume.apply(e,t)})},getVolume:function(){return this.curEngine?this.curEngine.getVolume.apply(this.curEngine,arguments):0},setCurrentPosition:function(){return this.curEngine?this.curEngine.setCurrentPosition.apply(this.curEngine,arguments):void 0},getCurrentPosition:function(){return this.curEngine?this.curEngine.getCurrentPosition.apply(this.curEngine,arguments):0},getCurrentPositionString:function(){return mbox.convertTime(this.getCurrentPosition())},getLoadedPercent:function(){return this.curEngine?this.curEngine.getLoadedPercent.apply(this.curEngine,arguments):0},getLoadedBytes:function(){return this.curEngine?this.curEngine.getLoadedBytes.apply(this.curEngine,arguments):void 0},getTotalBytes:function(){return this.curEngine?this.curEngine.getTotalBytes.apply(this.curEngine,arguments):0},getTotalTime:function(){return this.curEngine?this.curEngine.getTotalTime.apply(this.curEngine,arguments):0},getTotalTimeString:function(){return mbox.convertTime(this.getTotalTime())},getCurEngine:function(){return this.curEngine},getEngineType:function(){return this.getCurEngine().getEngineType()},getVersion:function(){var t={};return T.array.each(this.engineList,function(e){t[e.getEngineType()]=e.getVersion()}),t},getState:function(){return this.curEngine?this.curEngine.getState.apply(this.curEngine,arguments):null},setEventListener:function(t,e,i){var n;n=t==this.EVENTS.INITFAIL||t==this.EVENTS.INIT?T.fn.bind(function(){e.apply(this,arguments)},this):T.fn.bind(function(t){t.target&&t.target.getEngineType()==this.curEngineType&&e.apply(this,arguments)
},this),T.array.each(this.unInitEngineList,function(e){e.setEventListener(t,n,i)})},removeEventListener:function(t,e){T.array.each(this.unInitEngineList,function(i){i.removeEventListener(t,e)})},_initProgressEvent:function(){this.progressTimer.addEventListener("timer",T.fn.bind(function(){var t=this.getLoadedPercent();this.curEngine.dispatchEvent(this.EVENTS.PROGRESS,{progress:t,totalBytes:this.getTotalBytes(),loadedBytes:this.getLoadedBytes(),totalTime:this.getTotalTime()}),1==t&&"wmp"!=this.curEngineType&&this.progressTimer.stop()},this)),this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(t){var e=t.newState;switch(e){case this.STATES.PREBUFFER:case this.STATES.PLAY:this.getLoadedPercent()<1&&this.progressTimer.start();break;case this.STATES.STOP:case this.STATES.READY:case this.STATES.END:this.progressTimer.reset()}},this)),this.setEventListener("setUrl",T.fn.bind(function(){this.progressTimer.reset(),this.progressTimer.start()},this))},_initPositionChangeEvent:function(){this.positionTimer.addEventListener("timer",T.fn.bind(function(){var t=this.getCurrentPosition();this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:t})},this)),this.setEventListener(this.EVENTS.STATECHANGE,T.fn.bind(function(t){var e=t.newState;switch(e){case this.STATES.PLAY:this.positionTimer.start();break;case this.STATES.STOP:case this.STATES.PAUSE:this.positionTimer.pause(),this.curEngine.dispatchEvent(this.EVENTS.POSITIONCHANGE,{position:this.getCurrentPosition()});break;case this.STATES.READY:case this.STATES.END:this.positionTimer.reset()}},this)),this.setEventListener("setUrl",T.fn.bind(function(){this.positionTimer.reset()},this))}});mbox.SongModel=function(t){t=t||{},this.hasLink=!1,this.songId=0,this.songName="",this.artistId=0,this.artistName="",this.albumId=0,this.albumName="",this.songPicSmall="",this.songPicBig="",this.songPicRadio="",this.lrcLink="",this.time=0,this.songLink="",this.showLink="",this.format="",this.rate=0,this.size=0,this.lyricContent="",this.relateStatus=0,this.resourceType=0,this.copyType=0;for(var e in t){var i=t[e];if(!T.isString(this[e])&&""!=i){var n=+i;n==i?i=n:null==i&&(i="")}this[e]=i}},mbox.SongModel.prototype={set:function(t){for(var e in t){var i=t[e];if(!T.isString(this[e])&&""!=i){var n=+i;n==i?i=n:null==i&&(i="")}this[e]=i}},get:function(t){return this[t]},unset:function(t){delete this[t]}},function(){var t=T.lang.createClass(function(){this.allSongCache={},this.apiAddress=mbox.CONF.songLinkHost.link,this.lrcAddress=mbox.CONF.songLinkHost.lrc,this.sugAddress=mbox.CONF.songLinkHost.sug}).extend({createSongModel:function(t,e){var i=[],t=T.lang.toArray(t),e=T.lang.toArray(e);return T.each(t,function(t){t&&"null"!==t&&"undefined"!==t&&(this.allSongCache[t]||(this.allSongCache[t]=new mbox.SongModel({songId:t})),i.push(this.allSongCache[t]))},this),T.object.each(e,function(t){this.allSongCache[t.queryId||t.id]&&this.allSongCache[t.queryId||t.id].set(t)},this),i},fetchIdByQuery:function(t,e){var i=t.split("$$"),n=i[0]||i[2],s=i[1];T.sio.callByServer(this.sugAddress+n+" "+s,function(i){e(i.song_list&&i.song_list.length?i.song_list[0].song_id:t)})},parseHttpsSongPic:function(t){return t&&"https:"===$.tb.location.getProtocol()?t.replace("http://musicdata.baidu.com","https://gss0.baidu.com/8_1ZdTmk2RIF8t7jm9iCKT-xh_"):t},fetchSong:function(t,e){var i=this;t.hasLink?T.lang.isFunction(e.success)&&e.success(t,this):t.songId.toString().indexOf("$$")>-1?this.fetchIdByQuery(t.songId,T.fn.bind(function(n){T.sio.callByServer(this.apiAddress+n,function(n){if(22e3===n.error_code){var s=n.songinfo,a=n.bitrate;if(s.extra){var r=s.extra.split("$$");s.song_id=s.extra,s.title=r[0]||r[2],s.author=r[1]}t.set({hasLink:!0,songId:s.song_id,songName:s.title,artistId:s.ting_uid,artistName:s.author,albumId:s.album_id,albumName:s.album_title,songPicBig:i.parseHttpsSongPic(s.pic_big),songPicSmall:i.parseHttpsSongPic(s.pic_small)||"//tb2.bdstatic.com/tb/static-common/widget/music_player/noPic_7a0425f.jpg",songPicRadio:s.pic_radio,resourceType:s.resource_type,relateStatus:s.relate_status,copyType:s.copy_type,lrcLink:s.lrclink,rate:a.file_bitrate,songLink:a.file_link,showLink:a.show_link,format:a.file_extension,size:a.file_size,time:a.file_duration}),T.lang.isFunction(e.success)&&e.success(t,this)}else T.lang.isFunction(e.error)&&e.error(t,n.error_code)})},this)):T.sio.callByServer(this.apiAddress+t.songId,function(n){if(22e3===n.error_code){var s=n.songinfo,a=n.bitrate;if(s.extra){var r=s.extra.split("$$");s.song_id=s.extra,s.title=r[0]||r[2],s.author=r[1]}t.set({hasLink:!0,songId:s.song_id,songName:s.title,artistId:s.ting_uid,artistName:s.author,albumId:s.album_id,albumName:s.album_title,songPicBig:i.parseHttpsSongPic(s.pic_big),songPicSmall:i.parseHttpsSongPic(s.pic_small)||"//tb2.bdstatic.com/tb/static-common/widget/music_player/noPic_7a0425f.jpg",songPicRadio:s.pic_radio,resourceType:s.resource_type,relateStatus:s.relate_status,copyType:s.copy_type,lrcLink:s.lrclink,rate:a.file_bitrate,songLink:a.file_link,showLink:a.show_link,format:a.file_extension,size:a.file_size,time:a.file_duration}),T.lang.isFunction(e.success)&&e.success(t,this)}else T.lang.isFunction(e.error)&&e.error(t,n.error_code)})},getLrcContent:function(t,e){var i=T.lang.isFunction,n=i(e)?e:i(e.success)?e.success:function(){},s=i(e.error)?e.error:function(){};t.lrcContent?n(t.lrcContent):t.songLink&&t.lrcLink?T.sio.callByServer(this.lrcAddress+t.songId,function(e){e.lrcContent?(t.lrcContent=e.lrcContent,n(e.lrcContent)):s()}):s()}});mbox.SongDataModel=new t}(void 0),function(){var t={RANDOM:0,SINGLE:1,CYCLE:2};mbox.PlayList=T.lang.createClass(function(){this.curSongIndex=-1,this.curSong=null,this.songModels=[],this.mode=t.SINGLE}).extend({_random:function(){return parseInt(Math.random()*this.getLength(),10)},addSong:function(t){t=T.lang.toArray(t),t.length&&(this.songModels=this.songModels.concat(t),this.dispatchEvent("add:songModels",{songModels:t}))},removeSong:function(t){if(-1===t)this.reset(),this.dispatchEvent("remove:songModels",{indexes:e});else{var e=T.lang.toArray(t),i=e.length;if(i){e.sort(function(t,e){return t-e});for(var n=this.curSongIndex,s=n,a=!1;i--;){var r=e[i];this.songModels.splice(r,1),-1!==s&&(r===n&&(a=!0),n>=r&&n--)}a&&n++,-1!==s&&(0>n&&songlist.length>0?(n=0,a=!0):n>songlist.length-1&&(n=0)),a&&(this.curSong=songlist[n],this.curSongIndex=n),this.dispatchEvent("remove:songModels",{indexes:e})}}},prev:function(){var e=this.getLength(),i=-1===this.curSongIndex?0:(this.curSongIndex+e-1)%e;e&&this.setCurIndex(this.mode===t.RANDOM?this._random():i)},next:function(){var e=this.getLength(),i=(this.curSongIndex+1)%e;e&&this.setCurIndex(this.mode===t.RANDOM?this._random():i)},autoNext:function(){this.mode===t.SINGLE?this.setCurIndex(this.curSongIndex):this.next()},setCurIndex:function(t){this.curSongIndex=t,this.setCurSong(this.songModels[t]),this.dispatchEvent("change:curSongIndex",{index:t})},setCurSong:function(t){this.curSong=t,this.dispatchEvent("change:curSong",{curSong:t})},getCurIndex:function(){return this.curSongIndex},getCurSong:function(){return this.curSong},getSongList:function(){return this.songModels},setMode:function(t){this.mode=t},getMode:function(){return this.mode},getLength:function(){return this.songModels.length},reset:function(){this.curSongIndex=-1,this.curSong=null,this.songModels=[],this.playlist=[]},fetchLink:function(t){mbox.SongDataModel.fetchSong(this.curSong,t)}})}(),mbox.LogModel=T.lang.createClass(function(t,e){this.logUrl="http://qianclick.baidu.com/v.gif",this.playerRules={},this.playerRuleCtrl=null,this.player=t,this.playList=e,this.initLog()}).extend({initLog:function(){{var t=this;new mbox.PlayerLog({time:100,resetOnNoVoice:!0,type:"play100ms",player:this.player,handler:function(){t.sendLog("playsong100ms",t.logUrl,{sendCurSong:!0})}}),new mbox.PlayerLog({time:6e4,resetOnNoVoice:!1,type:"play60s",player:this.player,handler:function(){t.sendLog("60play",t.logUrl,{sendCurSong:!0})}})}this.player.setEventListener("setUrl",function(){t.sendLog("playstart",t.logUrl,{sendCurSong:!0})})},_addCurSong:function(t){var e={song_id:"songId",song_title:"songName",singer_id:"artistId",singer_name:"artistName",album_id:"albumId",album_name:"albumName",copytype:"copyType",format:"format",queryid:"queryId",rate:"rate",relatestatus:"relateStatus",resourcetype:"resourceType",songsize:"size",linkCode:"linkCode",lrcLink:"lrcLink",time:"time",status:"status",from:"from",link:"songLink"},i=this.playList.getCurSong();T.object.each(e,function(e,n){t.push(n+"="+encodeURIComponent(null==i[e]?"":i[e]))})},sendLog:function(t,e,i){return}}),mbox.PlayerLog=function(t){this.type=t.type,this.time=t.time,this.resetOnNoVoice=t.resetOnNoVoice,this.player=t.player,this.active=!1,this.timer=null,this.handlers=[],t.handler&&this.handlers.push(t.handler),this._init()},mbox.PlayerLog.prototype={_init:function(){this.timer||null==this.time||(this.timer=new mbox.Timer(this.time,1),this.addHandler(this.handler),this.timer.addEventListener("timer",T.fn.bind(function(){for(var t=0,e=this.handlers.length;e>t;t++)this.handlers[t]&&this.handlers[t].apply(this,arguments)},this)));var t=this.player.EVENTS.STATECHANGE,e=this.player.STATES;this.player.setEventListener("setUrl",T.fn.bind(function(){this.active=!0,this.timer.reset()},this)),this.player.setEventListener(t,T.fn.bind(function(t){this.active&&(t.newState==e.PLAY?this.timer.start():this.resetOnNoVoice?this.timer.reset():t.newState==e.PAUSE||t.newState==e.BUFFERING?t.oldState==e.PLAY&&this.timer.pause():this.timer.reset())},this))},addHandler:function(t){this.handlers.push(t)}},mbox.PlayCtrl=mbox.lang.createClass(function(t){var e=[],i=mbox.CONF.instanceCallName,n=mbox.CONF.engineArg;"object"!=typeof window[i]&&(window[i]={}),/(macintosh|iphone|ipod|ipad)/i.test(navigator.userAgent)?(e.push(n.audio),e.push(n.fmp)):(e.push(n.fmp),e.push(n.audio)),this.player=window[i].player=new PlayEngine({subEngines:e}),this.player.init(),this.curSong=null,this.playList=new mbox.PlayList,this.log=new mbox.LogModel(this.player,this.playList),window[i].logger=this.log,this._init(t),mbox.CONF.exportAPI&&(window[i][mbox.CONF.exportAPI]=this.exportAPI())}).extend({_init:function(t){t=t||{};var e=this.player,i=this.playList,n=t.songId||[],s=mbox.SongDataModel.createSongModel(n),a=this,r=T.lang.isFunction;t.logOpt&&T.object.extend(mbox.CONF.logOpt||{},t.logOpt),e.setEventListener(e.EVENTS.POSITIONCHANGE,function(e){var i=e.position,n=a.getTotalTime();r(t.onPositionChange)&&t.onPositionChange(i,100*i/n||0)}),r(t.onProgressChange)&&e.setEventListener(e.EVENTS.PROGRESS,function(e){t.onProgressChange(100*e.progress)}),e.setEventListener(e.EVENTS.STATECHANGE,function(n){switch(r(t.onPlayStateChange)&&t.onPlayStateChange(n.newState,n.oldState),n.newState){case e.STATES.END:mbox.CONF.autoNext?(i.autoNext(),a.play()):e.stop()}}),i.addEventListener("change:curSong",function(i){e.stop(),(a.curSong=i.curSong)?a.playList.fetchLink({success:function(e){r(t.onChangeCurSong)&&t.onChangeCurSong(e),a.dispatchEvent("fetch:link",{song:e})},error:function(e){r(t.onChangeCurSong)&&t.onChangeCurSong(null,e)}}):r(t.onChangeCurSong)&&t.onChangeCurSong(null)}),i.addSong(s),this.playList.setCurIndex(0),(void 0!==t.autoPlay?t.autoPlay:mbox.CONF.autoPlay)&&this.play()},getCurSong:function(){return this.curSong},getTotalTime:function(){return this.curSong&&1e3*this.curSong.time||this.player.getTotalTime()},setPlayIndex:function(t,e){this.playList.setCurIndex(t),e&&this.play()},play:function(){if(this.curSong&&this.curSong.songLink)this.curSong.songLink!==this.player.getUrl()&&(this.player.reset(),this.player.setUrl(this.curSong.songLink)),this.player.play();else{var t=this;this.addEventListener("fetch:link",function(e){if(!e.song)throw"fetch songLink fail";t.player.setUrl(e.song.songLink),t.player.play(),t.removeEventListener("fetch:link.link")},"link")}},pause:function(){this.player.pause()},stop:function(){this.player.stop()},exportAPI:function(){var t=this,e=this.player.EVENTS;return{getCurSong:function(){return t.curSong},getTotalTime:function(){return t.totalTime},getPlayerState:function(){return t.player.getState()},getPosition:function(){return t.player.getPosition()},getProgress:function(){return t.player.getProgress()},play:function(){t.play.apply(t,arguments)},pause:function(){t.pause()},stop:function(){t.stop()},listenToStateChange:function(i){t.player.setEventListener(e.STATECHANGE,i)},listenToPosChange:function(i){t.player.setEventListener(e.POSITIONCHAGNE,i)},listenToLoadedPercentChange:function(i){t.player.setEventListener(e.PROGRESS,i)},getCurIndex:function(){return t.playList.getCurIndex()},addSong:function(e){var i=T.lang.toArray(e);i.length&&"object"!=typeof i[0]&&(i=mbox.SongDataModel.createSongModel(i)),t.playList.addSong(i)},removeSong:function(e){t.playList.removeSong(e)},setPlayIndex:function(e,i){this.setPlayIndex.call(t,e,i)},setPlayMode:function(e){t.playList.setMode(e)}}}}),mbox.uiConf={prefix:"mbox",allWidget:["slider","time","volume","mute","title","lrc","album","playList","playBtn"],tpl:'<div class="mbox">                <div class="logo" ><a href="http://music.baidu.com" target="_blank" title="\u767E\u5EA6\u97F3\u4E50"></a></div>                <div class="player-main">                    <div class="album-pic mbox-album">                        <img class="pic" data-src="<%=songPicSmall%>"/>                    </div>                    <div class="right-wrapper">                        <div class="right-top">                            <div class="mbox-title player-title">                                <div class="song-name song-info" songid="<%=songId%>"><a href="http://music.baidu.com/song/<%=songId%>" target="_blank"><%=songName%></a></div>                                <span class="artist song-info">\u6B4C\u624B\uFF1A<span class="artist-name"><%var i =0, len = all_artist.length; for(;len -i; i++){%>                                    <a href="<%=all_artist_link[i]%>" target="_blank"><%=all_artist[i]%></a><%};%></span></span>                                <span class="album song-info">\u4E13\u8F91\uFF1A<span class="album-name"><a href="<%=albumLink%>" target="_blank"><%=albumName%></a></span></span>                                <span class="source song-info">\u6765\u6E90\uFF1A<span class="link-source"><a href="javascript:void(0)"></a></span></span>                                <div class="lrc"></div>                            </div>                            <div class="button-wrapper">                                <a class="button add-favour" href="javascript:void(0)" onclick="return false;" title="\u70B9\u51FB\u6536\u85CF"></a>                                <a class="button lrc-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u67E5\u770B\u5168\u90E8\u6B4C\u8BCD"></a>                                <a class="button download-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u4E0B\u8F7D\u6B4C\u66F2"></a>                                <a class="button go-to-listen-btn" href="javascript:void(0)" target="_blank" onclick="return false;" title="\u5F39\u51FA\u64AD\u653E"></a>                            </div>                        </div>                        <div class="bottom-bars">                            <div class="bottom-bars-item mbox-playBtn ctrl-btn stop"><a href="javascript:void(0)" onclick="return false;"></a></div>                            <div class="bottom-bars-item  progress "><div class="slider-wrapper mbox-slider"></div></div>                            <div class="bottom-bars-item mbox-time time"><%=curTime%>/<%=totalTime%></div>                            <div class="bottom-bars-item volume">                                <a class="volume-btn mbox-mute" href="javascript:void(0)" onclick="return false;"  title="">&nbsp</a>                                <div class="slider-wrapper mbox-volume"></div>                            </div>                        </div>                    </div>                </div>                </div>'},function(t){var e="undefined"==typeof module?t.baidu=t.baidu||{}:module.exports;e.template=function(e,n){var s=function(){if(!t.document)return i._compile(e);var n=document.getElementById(e);if(n){if(i.cache[e])return i.cache[e];var s=/^(textarea|input)$/i.test(n.nodeName)?n.value:n.innerHTML;return i._compile(s)}return i._compile(e)}(),a=i._isObject(n)?s(n):s;return s=null,a};var i=e.template;i.versions=i.versions||[],i.versions.push("1.0.6"),i.cache={},i.LEFT_DELIMITER=i.LEFT_DELIMITER||"<%",i.RIGHT_DELIMITER=i.RIGHT_DELIMITER||"%>",i.ESCAPE=!0,i._encodeHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\\/g,"&#92;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},i._encodeReg=function(t){return String(t).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},i._encodeEventHTML=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\\\\/g,"\\").replace(/\\\//g,"/").replace(/\\n/g,"\n").replace(/\\r/g,"\r")},i._compile=function(t){var e="var _template_fun_array=[];\nvar fn=(function(__data__){\nvar _template_varName='';\nfor(name in __data__){\n_template_varName+=('var '+name+'=__data__[\"'+name+'\"];');\n};\neval(_template_varName);\n_template_fun_array.push('"+i._analysisStr(t)+"');\n_template_varName=null;\n})(_template_object);\nfn = null;\nreturn _template_fun_array.join('');\n";return new Function("_template_object",e)},i._isObject=function(t){return"function"==typeof t||!(!t||"object"!=typeof t)},i._analysisStr=function(t){var e=i.LEFT_DELIMITER,n=i.RIGHT_DELIMITER,s=i._encodeReg(e),a=i._encodeReg(n);return t=String(t).replace(new RegExp("("+s+"[^"+a+"]*)//.*\n","g"),"$1").replace(new RegExp("<!--.*?-->","g"),"").replace(new RegExp(s+"\\*.*?\\*"+a,"g"),"").replace(new RegExp("[\\r\\t\\n]","g"),"").replace(new RegExp(s+"(?:(?!"+a+")[\\s\\S])*"+a+"|((?:(?!"+s+")[\\s\\S])+)","g"),function(t,e){var i="";if(e)for(i=e.replace(/\\/g,"&#92;").replace(/'/g,"&#39;");/<[^<]*?&#39;[^<]*?>/g.test(i);)i=i.replace(/(<[^<]*?)&#39;([^<]*?>)/g,"$1\r$2");else i=t;return i}),t=t.replace(new RegExp("("+s+"[\\s]*?var[\\s]*?.*?[\\s]*?[^;])[\\s]*?"+a,"g"),"$1;"+n).replace(new RegExp("("+s+":?[hvu]?[\\s]*?=[\\s]*?[^;|"+a+"]*?);[\\s]*?"+a,"g"),"$1"+n).split(e).join("	"),t=i.ESCAPE?t.replace(new RegExp("\\t=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'"):t.replace(new RegExp("\\t=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':$1,'"),t=t.replace(new RegExp("\\t:h=(.*?)"+a,"g"),"',typeof($1) === 'undefined'?'':baidu.template._encodeHTML($1),'").replace(new RegExp("\\t(?::=|-)(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':$1,'").replace(new RegExp("\\t:u=(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':encodeURIComponent($1),'").replace(new RegExp("\\t:v=(.*?)"+a,"g"),"',typeof($1)==='undefined'?'':baidu.template._encodeEventHTML($1),'").split("	").join("');").split(n).join("_template_fun_array.push('").split("\r").join("\\'")}}(window),function(t,e){t.widget&&"function"===t.widget&&(t.box_widget=t.widget);var i=0,n=Array.prototype.slice,s=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(a){}s(e)},t.box_widget=function(e,i,n){var s,a,r,o,u=e.split(".")[0];e=e.split(".")[1],s=u+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][s.toLowerCase()]=function(e){return!!t.data(e,s)},t[u]=t[u]||{},a=t[u][e],r=t[u][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new r(t,e)},t.extend(r,a,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),o=new i,o.options=t.box_widget.extend({},o.options),t.each(n,function(e,s){t.isFunction(s)&&(n[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},n=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,a=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=a,e}}())}),r.prototype=t.box_widget.extend(o,{widgetEventPrefix:e},n,{constructor:r,namespace:u,widgetName:e,widgetBaseClass:s,widgetFullName:s}),a?(t.each(a._childConstructors,function(e,i){var n=i.prototype;t.box_widget(n.namespace+"."+n.widgetName,r,i._proto)}),delete a._childConstructors):i._childConstructors.push(r),t.box_widget.bridge(e,r)},t.box_widget.extend=function(i){for(var s,a,r=n.call(arguments,1),o=0,u=r.length;u>o;o++)for(s in r[o])a=r[o][s],r[o].hasOwnProperty(s)&&a!==e&&(i[s]=t.isPlainObject(a)?t.box_widget.extend({},i[s],a):a);return i},t.box_widget.bridge=function(i,s){var a=s.prototype.widgetFullName;t.fn[i]=function(r){var o="string"==typeof r,u=n.call(arguments,1),l=this;return r=!o&&u.length?t.box_widget.extend.apply(null,[r].concat(u)):r,this.each(o?function(){var n,s=t.data(this,a);return s?t.isFunction(s[r])&&"_"!==r.charAt(0)?(n=s[r].apply(s,u),n!==s&&n!==e?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0):t.error("no such method '"+r+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+r+"'")}:function(){var e=t.data(this,a);e?e.option(r||{})._init():new s(r,this)}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.box_widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetName,this),t.data(n,this.widgetFullName,this),this._on({remove:"destroy"}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var s,a,r,o=i;if(0===arguments.length)return t.box_widget.extend({},this.options);if("string"==typeof i)if(o={},s=i.split("."),i=s.shift(),s.length){for(a=o[i]=t.box_widget.extend({},this.options[i]),r=0;r<s.length-1;r++)a[s[r]]=a[s[r]]||{},a=a[s[r]];if(i=s.pop(),n===e)return a[i]===e?null:a[i];a[i]=n}else{if(n===e)return this.options[i]===e?null:this.options[i];o[i]=n}return this._setOptions(o),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,i){i?(e=t(e),this.bindings=this.bindings.add(e)):(i=e,e=this.element);var n=this;t.each(i,function(i,s){function a(){return n.options.disabled===!0||t(this).hasClass("ui-state-disabled")?void 0:("string"==typeof s?n[s]:s).apply(n,arguments)}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var r=i.match(/^(\w+)\s*(.*)$/),o=r[1]+n.eventNamespace,u=r[2];u?n.widget().delegate(u,o,a):e.bind(o,a)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var s,a,r=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(s in a)s in i||(i[s]=a[s]);return this.element.trigger(i,n),!(t.isFunction(r)&&r.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,s,a){"string"==typeof s&&(s={effect:s});var r,o=s?s===!0||"number"==typeof s?i:s.effect||i:e;s=s||{},"number"==typeof s&&(s={duration:s}),r=!t.isEmptyObject(s),s.complete=a,s.delay&&n.delay(s.delay),r&&t.effects&&(t.effects.effect[o]||t.uiBackCompat!==!1&&t.effects[o])?n[e](s):o!==e&&n[o]?n[o](s.duration,s.easing,a):n.queue(function(i){t(this)[e](),a&&a.call(n[0]),i()})}}),t.uiBackCompat!==!1&&(t.Widget.prototype._getCreateOptions=function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.box_widget("ui.box_mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1==i.which,a="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return s&&!a&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return!t.browser.msie||document.documentMode>=9||e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target==this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){var e=5;t.box_widget("ui.box_slider",t.ui.box_mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",progressbar:!1,progress:0,constraintProgress:!1,range:!1,step:1,value:0,values:null},_create:function(){var i=this,n=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' hidefocus='true'><span></span></a>",r=n.values&&n.values.length||1,o=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(n.disabled?" ui-slider-disabled ui-disabled":"")),this.range=t([]),n.range&&(n.range===!0&&(n.values||(n.values=[this._valueMin(),this._valueMin()]),n.values.length&&2!==n.values.length&&(n.values=[n.values[0],n.values[0]])),this.range=t("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===n.range||"max"===n.range?" ui-slider-range-"+n.range:""))),n.progressbar&&(this.progressbar=t("<div></div>").appendTo(this.element).addClass("ui-slider-progressbar ui-widget-header"));for(var u=s.length;r>u;u+=1)o.push(a);this.handles=s.add(t(o.join("")).appendTo(i.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(t){t.preventDefault()}).hover(function(){n.disabled||t(this).addClass("ui-state-hover ui-slider-handle-hover")},function(){t(this).removeClass("ui-state-hover ui-slider-handle-hover")}).focus(function(){n.disabled?t(this).blur():(t(".ui-slider .ui-state-focus").removeClass("ui-state-focus ui-slider-handle-focus"),t(this).addClass("ui-state-focus ui-slider-handle-focus"))}).blur(function(){t(this).removeClass("ui-state-focus ui-slider-handle-focus")}),this.handles.each(function(e){t(this).data("index.ui-slider-handle",e)}),this.handles.keydown(function(n){var s,a,r,o,u=t(this).data("index.ui-slider-handle");if(!i.options.disabled){switch(n.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n.preventDefault(),!i._keySliding&&(i._keySliding=!0,t(this).addClass("ui-state-active ui-slider-handle-active"),s=i._start(n,u),s===!1))return}switch(o=i.options.step,a=r=i.options.values&&i.options.values.length?i.values(u):i.value(),n.keyCode){case t.ui.keyCode.HOME:r=i._valueMin();break;case t.ui.keyCode.END:r=i._valueMax();break;case t.ui.keyCode.PAGE_UP:r=i._trimAlignValue(a+(i._valueMax()-i._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:r=i._trimAlignValue(a-(i._valueMax()-i._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(a===i._valueMax())return;r=i._trimAlignValue(a+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(a===i._valueMin())return;r=i._trimAlignValue(a-o)}i._slide(n,u,r)}}).keyup(function(e){var n=t(this).data("index.ui-slider-handle");i._keySliding&&(i._keySliding=!1,i._stop(e,n),i._change(e,n),t(this).removeClass("ui-state-active ui-slider-handle-active"))}),this._refreshValue(),this._refreshProgress(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(e){var i,n,s,a,r,o,u,l,h,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(i),s=this._valueMax()-this._valueMin()+1,r=this,this.handles.each(function(e){var i=Math.abs(n-r.values(e));s>i&&(s=i,a=t(this),o=e)}),d.range===!0&&this.values(1)===d.min&&(o+=1,a=t(this.handles[o])),u=this._start(e,o),u===!1?!1:(this._mouseSliding=!0,r._handleIndex=o,a.addClass("ui-state-active ui-slider-handle-active").focus(),l=a.offset(),h=!t(e.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-a.width()/2,top:e.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,o,n),this._animateOff=!0,!0))
},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active ui-slider-handle-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,n,s,a;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/e,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),s=this._valueMax()-this._valueMin(),a=this._valueMin()+n*s,this._trimAlignValue(a)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var n,s,a;this.options.values&&this.options.values.length?(n=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>n||1===e&&n>i)&&(i=n),i!==this.values(e)&&(s=this.values(),s[e]=i,a=this._trigger("slide",t,{handle:this.handles[e],value:i,values:s}),n=this.values(e?0:1),a!==!1&&this.values(e,i,!0))):i!==this.value()&&(a=this._trigger("slide",t,{handle:this.handles[e],value:i}),a!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("change",t,i)}},_progress:function(t){var e={progress:this.options.progress};this._trigger("progress",t,e)},progress:function(t){var e=this._trimAlignProgress(t);return arguments.length&&this.options.progress!=e?(this.options.progress=e,this._refreshProgress(),this._progress(null),void(this.options.constraintProgress&&this.value()>e&&this.value(e))):this.options.progress},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,i){var n,s,a;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(n=this.options.values,s=arguments[0],a=0;a<n.length;a+=1)n[a]=this._trimAlignValue(s[a]),this._change(null,a);this._refreshValue()},_setOption:function(e,i){var n,s=0;switch(t.isArray(this.options.values)&&(s=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover ui-slider-handle-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this._refreshProgress();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;s>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"progress":this._refreshProgress(),this._progress(null),this.options.constraintProgress&&this.options.value>this.options.progress&&(this._animateOff=!0,this.value(this.options.progress),this._animateOff=!1);break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._refreshProgress(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,n;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(t){if(t<=this._valueMin())return this._valueMin();if(!this.options.constraintProgress&&t>=this._valueMax())return this._valueMax();this.options.progressbar&&this.options.constraintProgress&&t>=this.options.progress&&(t=this.options.progress);var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,n=t-i;return 2*Math.abs(i)>=e&&(n+=i>0?e:-e),parseFloat(n.toFixed(5))},_trimAlignProgress:function(t){return t<=this._valueMin()?this._valueMin():t>=this._valueMax()?this._valueMax():t},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,n,s,a,r=this.options.range,o=this.options,u=this,l=this._animateOff?!1:o.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(n){e=(u.values(n)-u._valueMin())/(u._valueMax()-u._valueMin())*100,h["horizontal"===u.orientation?"left":"bottom"]=e+"%",t(this).stop(1,1)[l?"animate":"css"](h,o.animate),u.options.range===!0&&("horizontal"===u.orientation?(0===n&&u.range.stop(1,1)[l?"animate":"css"]({left:e+"%"},o.animate),1===n&&u.range[l?"animate":"css"]({width:e-i+"%"},{queue:!1,duration:o.animate})):(0===n&&u.range.stop(1,1)[l?"animate":"css"]({bottom:e+"%"},o.animate),1===n&&u.range[l?"animate":"css"]({height:e-i+"%"},{queue:!1,duration:o.animate}))),i=e}):(n=this.value(),s=this._valueMin(),a=this._valueMax(),e=a!==s?(n-s)/(a-s)*100:0,h["horizontal"===u.orientation?"left":"bottom"]=e+"%",this.handle.stop(1,0)[l?"animate":"css"](h,o.animate),"min"===r&&"horizontal"===this.orientation&&this.range.stop(1,0)[l?"animate":"css"]({width:e+"%"},o.animate),"max"===r&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-e+"%"},{queue:!1,duration:o.animate}),"min"===r&&"vertical"===this.orientation&&this.range.stop(1,0)[l?"animate":"css"]({height:e+"%"},o.animate),"max"===r&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-e+"%"},{queue:!1,duration:o.animate}))},_refreshProgress:function(){var t=this.options,e=this._valueMax(),i=t.progress,n=i/e*100;this.progressbar&&this.progressbar.css("horizontal"===this.orientation?{width:n+"%"}:{height:n+"%"})},setLoading:function(t,e){var i;arguments.length<=1?(e=t,i=this.handle):i=this.handles.eq(t),i[e?"addClass":"removeClass"]("ui-slider-handle-loading")}}),t.extend(t.ui.box_slider,{version:"1.8.20"})}(jQuery),function(t){t.cutString=function(t,e,i){var n,s,a,r=t.length,o=0,u=0;for(s=0;r>s;s++)if(o+=t.charCodeAt(s)>128?2:1,o>e){n=t.substring(0,s-1)+"...";break}for(a=r;a>0;a--){if(s>=a||0===i)return n;if(u+=t.charCodeAt(s)>128?2:1,u>i)return n+=t.substring(a)}return t}}(jQuery),mbox.UiCtrl=mbox.lang.createClass(function(t,e){this.guid="mbox_ui_"+setTimeout(function(){},0),this.conf=e||mbox.uiConf,this.conf&&(this.widget={},this._init(t),this.EVENTS={POSITIONCHANGE:"ui_poschange",TOGGLEPLAY:"ui_toggleplay",VOLCHANGE:"ui_volchange",MUTECHANGE:"ui_mutechange"},this.volume=80,this.$root=$(t),this.active=!1)}).extend({_init:function(t){if(this.conf.tpl){for(var e=$(this.conf.tpl).appendTo(t||"body").css("display","none"),i=this.conf.allWidget,n=this.conf.prefix,s={},a=i.length-1;a>-1;a--){var r=e.find("."+n+"-"+i[a]),o=r.html();o=o&&o.replace(/&lt;%/g,"<%").replace(/%&gt;/g,"%>"),s[i[a]]={dom:r,tpl:o}}this.conf.domJson=s,e.css("display","block"),this.$root=e}var u=this.conf.domJson;for(var l in u)if(u.hasOwnProperty(l))switch(l){case"slider":this._initSlider(u[l]);break;case"volume":this.widget[l]=$(u[l].dom).box_slider({animate:!0,max:100,min:0,orientation:"horizental",progressbar:!1,range:"min",value:80}).bind("slide",T.fn.bind(function(t,e){this.active&&this.fireVolChange(+e.value,0===+e.value)},this)).bind("slidestop",T.fn.bind(function(){this.active||this.widget.volume.box_slider("option","value",this.volume)},this));break;case"mute":var h=this;this.widget[l]=$(u[l].dom).click(function(){var t=$(this).hasClass("mute");h.fireVolChange(h.volume,!t)});break;case"title":case"time":case"playList":case"album":this.widget[l]=$(u[l].dom),this.widget[l].tpl=u[l].tpl;break;case"playBtn":this.widget[l]=$(u[l].dom).bind("click",T.fn.bind(function(){var t=this.widget.playBtn.hasClass("stop");this.dispatchEvent(this.EVENTS.TOGGLEPLAY,{isPlay:t})},this))}this.conf.tpl&&this.tplToHtml()},_initSlider:function(t){var e=t.maxValue||1e4;this.widget.slider=$(t.dom).box_slider({animate:175,max:e,min:0,orientation:"horizontal",progressbar:!0,progress:0,constraintProgress:!0,range:"min",value:0}),this.widget.slider.maxValue=e,this.widget.slider.sliding=!1;var i=this;this.widget.slider.bind("slidestart",function(){i.widget.slider.isSliding=!0}).bind("slidestop",function(t,e){i.widget.slider.isSliding=!1,i.dispatchEvent(i.EVENTS.POSITIONCHANGE,{percent:e.value/i.widget.slider.maxValue}),!i.active&&i.widget.slider.box_slider("option","value",0)})},tplToHtml:function(t,e,i,n){function s(t){$(e).delegate("."+t,"click",function(){n.sendLog("click",n.logUrl,{pos:i[t]})})}if(this.widget.title){var a=this.createSongFilter(t);a.songName&&"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6"!==a.songName?this.widget.title.removeClass("grey"):this.widget.title.addClass("grey"),this.widget.title.html(baidu.template(this.widget.title.tpl,a))}if(this.widget.lrc&&this.widget.lrc.lrc("setLrc",""),this.widget.album){this.widget.album.html(baidu.template(this.widget.album.tpl,t));var r=this.widget.album.find("img");if(!r[0].src){var o=r.attr("data-src");o&&r.attr("src",o)}}this.widget.time&&this.widget.time.html(baidu.template(this.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(0)}));for(var u in i)s(u)},fireVolChange:function(t,e){return this.active?(this.volume=t,e?(this.widget.mute&&this.widget.mute.addClass("mute").attr("title","\u53D6\u6D88\u9759\u97F3"),this.widget.volume&&this.widget.volume.box_slider("option","value",0)):(this.widget.mute&&this.widget.mute.removeClass("mute").attr("title","\u9759\u97F3"),this.widget.volume&&this.widget.volume.box_slider("option","value",this.volume)),this.dispatchEvent(this.EVENTS.VOLCHANGE,{volume:t}),this.dispatchEvent(this.EVENTS.MUTECHANGE,{mute:e}),!0):!1},setActive:function(t){this.active=t,this.$root[t?"addClass":"removeClass"]("active")},setShowLink:function(t,e){var i=t.showLink,n=i?$.cutString(i,16,5):"";("2"==t.resourceType.toString()||void 0===t.resourceType)&&($(e).find(".link-source").text(n).attr("href",i),$(e).find(".source").show())},createSongFilter:function(t){var e,i,n=[],s=[],a=[];if(t){e="http://music.baidu.com/",n=t.artistId.toString().split(","),s=t.artistName.split(","),a=[];for(var r=0,o=s.length;o>r;r++)a[r]=n[r]?e+"artist/"+n[r]:"javascript:;";i={songId:t.songId,songName:t.songName||"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6",albumId:t.albumId,albumLink:t.albumId?e+"album/"+t.albumId:"javascript:;",albumName:t.albumName,all_artist:s,all_artist_id:n,all_artist_link:a}}else i={songId:"",songName:"",albumId:"",albumLink:"",albumName:"",all_artist:s,all_artist_id:n,all_artist_link:a};return i}}),function(){var t=function(t,e){if([].indexOf)return[].indexOf.call(t,e);for(var i=t.length-1;i>-1;i--)if(t[i]===e)return i;return-1};mbox.Controller=function(t){this.playctrl=t,this.uiList=[]},mbox.Controller.prototype={_init:function(){},bindUi:function(e,i){if(t(this.uiList,e)>-1||!e)return!1;if(i&&this.uiList.length>0)for(var n=this.uiList.length;n;n--)this.unbindUi(this.uiList[n-1]),this.uiList.splice(n-1,1);this.bindPlayerEvent(this.playctrl,e),this.bindSongInfoEvent(this.playctrl,e),this.bindPlayListEvent(this.playctrl,e),this.bindUIEvent(this.playctrl,e),this.uiList.push(e);var s=this.playctrl.player;return this._onPosition(e,s.getCurrentPosition()),this._onProgress(e,s.getLoadedPercent()),this._onState(e,s.getState()),e.setActive(!0),e.fireVolChange(e.volume,!e.volume),!0},unbindUi:function(t){var e,i=playctrl.player,n=t.guid,s=i.EVENTS,a=t.EVENTS;for(e in s)s.hasOwnProperty(e)&&i.removeEventListener(s[e]+"."+n);for(e in a)a.hasOwnProperty(e)&&t.removeEventListener(a[e]+"."+n);playctrl.removeEventListener("fetch:link."+n),t.setActive(!1)},bindPlayListEvent:function(){},bindPlayerEvent:function(t,e){var i=t.player,n=e.guid;i.setEventListener(i.EVENTS.POSITIONCHANGE,T.fn.bind(function(t){this._onPosition(e,t.position)},this),n),i.setEventListener(i.EVENTS.PROGRESS,T.fn.bind(function(t){this._onProgress(e,t.progress)},this),n),i.setEventListener(i.EVENTS.STATECHANGE,T.fn.bind(function(t){this._onState(e,t.newState)},this),n)},bindSongInfoEvent:function(t,e){t.addEventListener("fetch:link",T.fn.bind(function(t){this._onSongInfo(e,t.song)},this),e.guid)},bindUIEvent:function(t,e){var i=t.player;e.addEventListener(e.EVENTS.POSITIONCHANGE,function(e){i.setCurrentPosition(t.getTotalTime()*e.percent)},e.guid),e.addEventListener(e.EVENTS.VOLCHANGE,function(t){i.setVolume(t.volume)},e.guid),e.addEventListener(e.EVENTS.TOGGLEPLAY,function(e){t.player[e.isPlay?"play":"pause"]()},e.guid),e.addEventListener(e.EVENTS.MUTECHANGE,function(t){i.setMute(t.mute)},e.guid)},_onSongInfo:function(t,e){if(t.widget.title){var i=t.createSongFilter(e);i.songName&&"\u8BE5\u6B4C\u66F2\u5DF2\u4E0B\u67B6"!==i.songName?t.widget.title.removeClass("grey"):t.widget.title.addClass("grey"),t.widget.title.html(baidu.template(t.widget.title.tpl,i))}if(t.widget.lrc&&e&&mbox.SongDataModel.getLrcContent(e,{success:function(e){t.widget.lrc.lrc("setLrc",e)},error:function(){t.widget.lrc.lrc("setLrc","")}}),t.widget.album){t.widget.album.html(baidu.template(t.widget.album.tpl,e));var n=t.widget.album.find("img");if(!n[0].src){var s=n.attr("data-src");s&&n.attr("src",s)}}if(t.widget.time){var a=this.playctrl.getTotalTime();t.widget.time.html(baidu.template(t.widget.time.tpl,{curTime:mbox.convertTime(0),totalTime:mbox.convertTime(a)}))}},_onPosition:function(t,e){var i=this.playctrl.getTotalTime();t.widget.slider&&!t.widget.slider.isSliding&&t.widget.slider.box_slider("option","value",e*t.widget.slider.maxValue/i||0),t.widget.lrc&&t.widget.lrc.lrc("scrollTo",e),t.widget.time&&t.widget.time.html(baidu.template(t.widget.time.tpl,{curTime:mbox.convertTime(e),totalTime:mbox.convertTime(i)}))},_onProgress:function(t,e){t.widget.slider&&!t.widget.slider.sliding&&t.widget.slider.box_slider("progress",e*t.widget.slider.maxValue)},_onState:function(t,e){if(t.widget.playBtn){var i=this.playctrl.player;playing=e===i.STATES.PLAY||e===i.STATES.PREBUFFER||e===i.STATES.BUFFERING,playing?t.widget.playBtn.removeClass("stop"):t.widget.playBtn.addClass("stop")}}}}(window);
;_.Module.define({path:"common/widget/MusicPlayer",requires:[],sub:{initial:function(t,i){window.playctrl||(window.playctrl=new window.mbox.PlayCtrl),this.api=window.playctrl.exportAPI(),this.log=window.playctrl.log,this.controller=new window.mbox.Controller(window.playctrl),this.logList={"song-name a":"song_title","artist-name a":"artist_name","album-name a":"album_name",logo:"logo","lrc-btn":"lrc","download-btn":"download","go-to-listen-btn":"to_musicbox"},this.ui=[];for(var o=0;o<t.length;o++)this.mboxInit(i[o],t[o],o);this.eventInit()},mboxInit:function(t,i,o){var n=this.ui,e=this.logList,a=this.log,l=this.api,s=this.controller;if(n[o]=new window.mbox.UiCtrl($(t)),"object"!=typeof i){var r=window.mbox.SongDataModel.createSongModel(i);window.mbox.SongDataModel.fetchSong(r[0],{success:function(i){n[o].tplToHtml(i,t,e,a),n[o].setShowLink(i,t)}})}else 1!=i.hasLink&&(i={hasLink:!0,songId:i.song_id,songName:i.title,artistId:i.ting_uid,artistName:i.author,albumId:i.album_id,albumName:i.album_title,songPicBig:i.pic_big,songPicSmall:i.pic_small,songPicRadio:i.pic_radio,resourceType:i.resource_type,relateStatus:i.relate_status,copyType:i.copy_type,lrcLink:i.lrclink,rate:i.file_bitrate,songLink:i.file_link,showLink:i.show_link,format:i.file_extension,size:i.file_size,time:i.file_duration}),n[o].tplToHtml(i,t,e,a),n[o].setShowLink(i,t);l.addSong(i),$(t).find(".ctrl-btn").click(function(){function i(t){return function(){s.bindUi(n[t],!0),l.setPlayIndex(t,!0)}}if($(t).find(".mbox-time").addClass("red_text"),!n[o].$root.hasClass("active")){window.playctrl.player.stop();var e=i(o);setTimeout(e,100)}})},eventInit:function(){$(document).delegate(".add-favour","click",function(){var t=this,i=$(this).parents(".right-top").find($(".song-name")).tbattr("songid"),o="https://gss2.baidu.com/6Ls1aze90MgYm2Gp8IqW0jdnxx1xbK/v1/restserver/ting?method=baidu.ting.favorite.addSongFavorite&from=tieba";$.getJSON(o+"&callback=?",{songId:i},function(i){var o=i.error_code;22e3===o||22322===o?$(t).addClass("add-favour-red"):22452===o&&_.Module.use("common/widget/LoginDialog",["",""])})}).delegate(".lrc-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+t+"#song_lyric")}).delegate(".download-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com/song/"+t+"/download")}).delegate(".go-to-listen-btn","click",function(){var t=$(this).parents(".right-top").find($(".song-name")).tbattr("songid");window.open("http://music.baidu.com//box?&&__methodName=mboxCtrl.playSong&__argsValue="+t)})}}});_.Module.define({path:"pb/widget/NoAutoVideo",requires:["common/widget/MusicPlayer"],sub:{POST_WIDTH:565,_configs:{},initial:function(e){try{null!=e&&(this._configs=$.extend(this._configs,e)),this.postWrapper=$("#j_p_postlist"),this.videoElem=null,this.run()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/no_auto_video/no_auto_video.js",method:"",ln:23}),t}},run:function(){this._delMusic(),this._delFlash()},_getSearch:function(e){return e.replace(/http:\/\/box\.baidu\.com\/widget\/flash\/bdspacesong\.swf\?/g,"")},_getSearchValue:function(e,t){var a=t.replace(/^\?/,""),i={};if(!a)return void 0===e?i:void 0;a=a.split("&amp;");for(var o,s=0,r=a.length;r>s;s++)o=a[s].indexOf("="),o>0?i[a[s].substring(0,o)]=a[s].substring(o+1):i[a[s]]="";return void 0===e?i:i[e]},_delMusic:function(){var e=this.postWrapper.find(".BDE_Music");e.remove()},_genericMusicImage:function(e){var t='<embed width="402" height="95" class="BDE_Music" src="'+e+'" scale="noborder" allowscriptaccess="never" menu="false" loop="false" play="true" wmode="transparent" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" allowfullscreen="true" style="display:block;">';return $(t)},_delFlash:function(){var e=this,t=this.postWrapper.find(".BDE_Flash");if(!(t.length<1)){var a=!0;$.each(t,function(t,i){var o=$(i);if("voteFlash"==$(i).tbattr("id"))return!0;if(0==t&&1==e._configs.can_auto_play&&1==PageData.pager.cur_page){$.stats.track("\u9996\u697C\u64AD\u653E","\u5E73\u53F0\u5316\u9996\u697C\u89C6\u9891\u64AD\u653E\u7EDF\u8BA1");var s=o.parents(".l_post").data("field"),r=s&&s.content&&1==s.content.post_no;if(r)return o.css("display","block"),!0}var n=e._gettbattrs(i),d=(n.vsrc,n.duration?n.duration:""),p=n.video_from?n.video_from:"",c=!1;if(1===PageData.thread.is_ad&&a){var l=$(i).parents("div.l_post"),h=l.getData();1==h.content.floor||2==h.content.floor?c=!0:a=!1}e.videoElem=c?e._getAdReplaceElem():e._getReplaceElem(n,d,p),$(i).replaceWith(e.videoElem),e._bindPlayEvent(n)})}},_getReplaceElem:function(e,t,a){var i,o=e.vpic,s=this;return o||(o="//tb2.bdstatic.com/tb/static-pb/widget/no_auto_video/img/video_default_background_fdda8ae.png"),i=s._getVideoPic(o,t,a,e)},_getVideoPic:function(e,t,a,i){var o=i.width,s=i.height,r=280/210,n=o/s,d="";n>r?(s=210,o=s*n,d="margin-left: -"+(o-280)/2+"px;"):(o=280,s=o/n,d="margin-top: -"+(s-210)/2+"px;");var p='<div class="video_src_wrap_main"><div class="vpic_wrap"><img class="vpic_img"  style="width:'+o+"px;height:"+s+"px; "+d+'" src="'+e+'"/><span class="vpic_play"></span></div>',c='<div class="video_src_info"><div class="video_src_info_name" >'+a+'</div><div class="video_src_info_duration" >'+t+"</div></div></div>",l=$(p+c);return l},_getAdReplaceElem:function(){var e=$(document.createElement("div"));e.tbattr({id:"ad_video_area","class":"ad_video_area"});var t=$('<div class="ad_video_bg"></div>');t.css({background:"url('"+(PageData.thread.video_url||"")+"')"});var a=$('<div class="ad_play_btn"></div>');return e.append(t).append(a).append($('<div class="ad_play_bar"></div>')),e.hover(function(){a.css({"background-position":"0 -64px"})},function(){a.css({"background-position":"0 0"})}),e.bind("click",function(){try{if(document.images){var e=new Image,t="https:"===$.tb.location.getProtocol()?"https://gsp0.baidu.com/9q9JcDHa2gU2pMbgoY3K":"http://bzclk.baidu.com";e.src=t+"/video.php?page=pb&forumid="+(PageData.forum_id||"")+"&tid="+(PageData.thread.id||"")+"&t="+(new Date).getTime(),e=null}}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/no_auto_video/no_auto_video.js",method:"",ln:226}),a}}),e},_gettbattrs:function(e){var t={};if(t.src=$(e).tbattr("src"),t.width=$(e).tbattr("width"),t.height=$(e).tbattr("height"),t.scale=$(e).tbattr("scale"),t.allowscriptaccess=$(e).tbattr("allowscriptaccess"),t.menu=$(e).tbattr("menu"),t.loop=$(e).tbattr("loop"),t.play=$(e).tbattr("play"),t.wmode=$(e).tbattr("wmode"),t.type=$(e).tbattr("type"),t.pluginspage=$(e).tbattr("pluginspage"),t.allowfullscreen=$(e).tbattr("allowfullscreen"),t.flashvars="playMovie=true&auto=1&adss=0&isAutoPlay=true",t.vsrc=$.tb.escapeHTML($(e).tbattr("vsrc")||""),t.vpic=$.tb.escapeHTML($(e).tbattr("vpic")||""),t.duration=$.tb.escapeHTML($(e).tbattr("duration")||""),t.video_from=$.tb.escapeHTML($(e).tbattr("video_from")||""),t.vhsrc=$.tb.escapeHTML($(e).tbattr("vhsrc")||""),t["data-video"]=$.tb.escapeHTML($(e).data("video")||""),t.videoType=$(e).tbattr("videoType"),t.tmplId=$(e).tbattr("templateId"),t.width>this.POST_WIDTH){var a=t.width/t.height;t.show_height=this.POST_WIDTH/a,t.show_width=this.POST_WIDTH}else t.show_width=t.width,t.show_height=t.height;return t},_bindPlayEvent:function(e){var t=this,a=t.videoElem;if(e.src&&/^http:\/\//.test(e.src)&&"https:"===$.tb.location.getProtocol())return a.bind("click",function(){try{window.open(e.vsrc.replace(/amp;/g,""))}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/no_auto_video/no_auto_video.js",method:"",ln:282}),t}}),void 0;if(6===+e.videoType&&document.createElement("video").canPlayType)a.bind("click",function(){try{var a=t._createTponitVideoTagForH5Browser(e),i=a;$(this).html(i),t.bindVideoReplay($(this).find("video")),t._bindTponitVideoEvent(e)}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"pb:widget/no_auto_video/no_auto_video.js",method:"",ln:293}),o}});else if("\u767E\u5EA6\u8D34\u5427"===e.video_from&&document.createElement("video").canPlayType){var i=t._createVideoTagForH5Browser(e),o=i,s=e.duration.split(":"),r=parseInt(s[0],10);r>=3&&1===parseInt(this._configs.is_show_advideo,10)?(a.html('<div id="tieba_video_Container" style="width:'+e.show_width+"px; height: "+e.show_height+'px;"></div>'),window.advPlayComplete=function(){var e=document.getElementById("tieba_video_Container");e.innerHTML="",a.html(o),t.bindVideoReplay(a.find("video"))},BAIDU_VIDEO_FROAD_FILL("3083453","tieba_video_Container")):(a.html(o),t.bindVideoReplay(a.find("video")))}else a.bind("click",function(){try{var a=t._createVideoTagForOtherBrowser(e),i=$(a);$(this).replaceWith(i),i.css("display","block")}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"pb:widget/no_auto_video/no_auto_video.js",method:"",ln:340}),o}})},_createVideoTagForH5Browser:function(e){var t,a=this,i=e.src,o=e.show_width,s=e.show_height,r=$.tb.unescapeHTML(i),n=location.pathname.split("/")[2],d=e["data-video"],p=$.tb.unescapeHTML(d);if(p)c=p,t=c.split("_")[1];else{var c,l=new RegExp("(^|&)video=([^&]*)(&|$)"),h=r.match(l);null===h?c=e.vhsrc:(c=h[2],t=c.split("_")[1],c&&(c="https://gss3.baidu.com/6LZ0ej3k1Qd3ote6lo7D0j9wehsv/tieba-smallvideo/"+c+".mp4"))}return mediaBoxHtml='<video style="width: '+o+"px; height: "+s+'px; background: #000;" src="'+c+'"data-threadid="'+n+'"data-md5="'+t+'"controls autoplay></video>',a._sendLog(n,t,1),mediaBoxHtml},_createTponitVideoTagForH5Browser:function(e){var t=this,a=e.src,i=e.show_width,o=e.show_height,s=($.tb.unescapeHTML(a),location.pathname.split("/")[2]);return mediaBoxHtml='<video class="tp-video"style="width: '+i+"px; height: "+o+'px;    background: #000;" src="'+a+'"data-md5="'+a.split("_")[1]+'"data-threadid="'+s+'"controls autoplay></video>',t._sendLog(s,null,2),mediaBoxHtml},_createVideoTagForOtherBrowser:function(e){var t=this,a=new Array;a.push('<embed type="'+e.type+'" '),a.push(' class="BDE_Flash"'),a.push(' src="'+e.src+'"'),a.push(' width="'+e.show_width+'"'),a.push(' height="'+e.show_height+'"'),a.push(' scale="'+e.scale+'"'),a.push(' allowscriptaccess="never"'),a.push(' menu="'+e.menu+'"'),a.push(' loop="true"'),a.push(' play="true"'),a.push(' womode="'+e.wmode+'"'),a.push(' pluginspage="'+e.pluginspage+'"'),a.push(' allowfullscreen="true"'),a.push(' flashvars="'+e.flashvars+'"'),a.push(' style="visibility:visible;">'),a.push("</embed>");var i=location.pathname.split("/")[2];return t._sendLog(i,null,2),a.join("")},_createVideoTagForIEBrowser:function(e){var t=this,a='<object style="visibility:visible" class="BDE_Flash" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,22,0" width="'+e.show_width+'" height="'+e.show_height+'">',i=[];i.push('<param name="FlashVars" value="'+e.flashvars+'">'),i.push('<param name="Movie" value="'+e.src+'">'),i.push('<param name="Src" value="'+e.src+'">'),i.push('<param name="WMode" value="Transparent">'),i.push('<param name="Play" value="0">'),i.push('<param name="Loop" value="0">'),i.push('<param name="Quality" value="High">'),i.push('<param name="Menu" value="0">'),i.push('<param name="AllowScriptAccess" value="never">'),i.push('<param name="Scale" value="NoScale">'),i.push('<param name="DeviceFont" value="0">'),i.push('<param name="EmbedMovie" value="0">'),i.push('<param name="BGColor" value="">'),i.push('<param name="MovieData" value="">'),i.push('<param name="AllowNetworking" value="all">'),i.push('<param name="AllowFullScreen" value="true">'),i.push(t._createVideoTagForOtherBrowser(e));var o=i.join(""),s=location.pathname.split("/")[2];return t._sendLog(s,null,2),a+o+"</object>"},_sendLog:function(e,t,a){var i={thread_id:e,forum_id:PageData.forum.id||PageData.forum.forum_id,obj_locate:"pb",obj_id:0,tbs:PageData.tbs,obj_type:a||2};t&&(i.video_md5=t),$.post("/video/playStat",i)},_bindTponitVideoEvent:function(e){var t=this,a=$(".tp-video"),i=0,o=0;a.on("play",function(){var a=$(this).get(0),i=a.duration,o={action_type:"CLICK",loc_param:"PLAY",tmplId:e.tmplId,obj_param:0,params:i};0===+a.currentTime&&t._tponitVideoPostTrack(o)}),a.on("ended",function(){o+=1}),$(window).bind("beforeunload",function(){$.each(a,function(a,s){s.pause();var r=null,n=s.duration;i=o*n+(s.ended?0:s.currentTime),r={action_type:"CLICK_FEEDBACK",loc_param:"PLAY_FINISH",tmplId:e.tmplId,obj_param:i,params:n},t._tponitVideoPostTrack(r)})})},_tponitVideoPostTrack:function(e){var t="http://"+location.host+"/official/click/tpointVideoRedirect",a={line:"PT",locate:"P0248",page:"PB",task:"tpoint",client_type:"PC_WEB",loc_param:e.loc_param,action_type:e.action_type,obj_id:e.tmplId,obj_name:e.tmplId,obj_cpid:"0",obj_good_id:"0",obj_throw_type:"BY_POST",obj_param:e.obj_param,params:e.params,fid:PageData.forum.forum_id,fname:PageData.forum.forum_name,tid:PageData.thread.thread_id};$.ajax({type:"GET",url:t,data:a,dataType:"json"})},bindVideoReplay:function(e){var t=this;e.on("ended",function(e){var a=e.target;a.play();var i=$(a).data("md5"),o=$(a).data("threadid");t._sendLog(o,i,1)})}}});_.Module.define({path:"common/widget/AudioPlayer",requires:[],sub:{defaultOptions:{src:"//tb1.bdstatic.com/tb/fmp.swf"},isReady:!1,isPlaying:!1,isMute:!1,volume:void 0,url:"",initial:function(t){var e=this;this.options=$.extend(this.defaultOptions,t);var i=$("<div></div>").css({width:1,height:1,overflow:"hidden"});i.appendTo("body"),i.html(this.renderSwf(this.options.src));var s=i.find("object"),a=$.browser.msie?s[0]:s.find("embed")[0];this.$container=i,this.$swf=s,this.swfObject=a;var n=setInterval(function(){e.swfObject&&e.swfObject.PercentLoaded&&100===e.swfObject.PercentLoaded()&&(clearInterval(n),setTimeout(function(){e.onSwfLoaded()},100))},100);window.pl=this},onSwfLoaded:function(){this.isReady=!0,this.bindEvents(),this.trigger("playerloaded",this)},renderSwf:function(){var t=['<object id="audio_player_core" width="#{width}" height="#{height}" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#4,0,0,0">','<param name="quality" value="high" />','<param name="allowscriptaccess" value="always">','<param name="scale" value="noscale">','<param name="wmode" value="window">','<param name="movie" value="#{srcWithStamp}">','<embed name="audio_player_core" width="#{width}" height="#{height}" allowscriptaccess="always" wmode="window" scale="noscale" src="#{srcWithStamp}" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer">',"</object>"].join("");return function(e){return $.tb.format(t,{src:e,srcWithStamp:e,width:1,height:1})}}(),bindEvents:function(){this.bind("reset",this._reset,this),this.bind("load",this._load,this),this.bind("play",this._play,this),this.bind("pause",this._pause,this),this.bind("stop",this._stop,this),this.bind("setmute",this._setMute,this)},_reset:function(){this.stop(),this.url="",this.isPlaying=!1},_load:function(t,e,i,s){function a(){var t=n._getLoadedPercent();return t>.3?(n.trigger("songloaded",t),n.failHandler&&clearTimeout(n.failHandler),i&&i(),!0):!1}var n=this;this.url=e,this.swfObject.closeStream(),this.swfObject.f_load(e),this.failHandler&&clearTimeout(this.failHandler),this.failHandler=setTimeout(function(){s&&s()},5e3),this.checkLoadedHandler&&clearTimeout(this.checkLoadedHandler),this.checkLoadedHandler=setTimeout(function(){a()||(n.checkLoadedHandler=setTimeout(arguments.callee,50))},50)},_play:function(t,e,i,s){function a(){var t=n._getCurrentPosition();return i&&i({percent:t,totalTime:n._getTotalTime(),currentTime:n._getCurrentTime()}),1==t?(n.trigger("playfinish",t),s&&s(),!0):!1}var n=this;if(!this.isPlaying){var o=this._getTotalTime();this.swfObject.f_play(),this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler),this.isPlaying=!0,e&&e({totalTime:o}),this.checkFinishedHandler=setTimeout(function(){a()||(n.checkFinishedHandler=setTimeout(arguments.callee,500))},1e3)}},_pause:function(){this.isPlaying&&(this.swfObject.f_pause(),this.isPlaying=!1)},_stop:function(){this.swfObject.f_stop(),this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler),this.isPlaying=!1},_setMute:function(t,e){this.isMute=e,this.swfObject.setData("mute",e)},_setVolume:function(t,e){this.volume=e,this.swfObject.setData("volume",e)},_setCurrentPosition:function(){},_getCurrentPosition:function(){return this.swfObject.getData("postionPct")},_getLoadedPercent:function(){return this.swfObject.getData("loadedPct")},_getTotalTime:function(){return this.swfObject.getData("length")},_getCurrentTime:function(){return this.swfObject.getData("currentPosition")}}});_.Module.define({path:"common/widget/VoicePlayer",requires:[],sub:{defaultOptions:{},isReady:!1,isPlaying:!1,isMute:!1,volume:void 0,url:"",isSupport:!!document.createElement("audio").canPlayType,initial:function(t){var i=this;if(!this.isSupport)return void setTimeout(function(){i.trigger("playerloaderror",i)},0);this.options=$.extend(this.defaultOptions,t);var e=this.$player=$("<audio></audio>"),n=this.options.attrs||{};e.tbattr(n),e.appendTo("body"),this.player=e[0],this.isReady=!0,this.bindEvents(),setTimeout(function(){i.trigger("playerloaded",i)},0)},bindEvents:function(){var t=this;this.bind("reset",this._reset,this),this.bind("load",this._load,this),this.bind("play",this._play,this),this.bind("pause",this._pause,this),this.bind("stop",this._stop,this),this.bind("setmute",this._setMute,this),this.$player.on("canplay",function(){t.options.oncanplay&&t.options.oncanplay()}).on("error",function(){t.options.onerror&&t.options.onerror()}).on("play",function(){t.options.onplay&&t.options.onplay()}).on("ended",function(){t.isPlaying=!1,t.options.onended&&t.options.onended()})},_reset:function(){this.stop(),this.url="",this.isPlaying=!1},_load:function(t,i,e,n){e&&(this.options.oncanplay=e),n&&(this.options.onerror=n),i===this.player.currentSrc&&4===this.palyer.readyState?e&&e():(this.url=i,this.player.src=i,this.player.load())},_play:function(t,i,e,n){function s(){var t=o._getCurrentPosition();return e&&e({percent:t,totalTime:o._getTotalTime(),currentTime:o._getCurrentTime()}),o.player.ended?!0:!1}var o=this;this.isPlaying||(this.checkFinishedHandler&&clearTimeout(this.checkFinishedHandler),i&&(this.options.onplay=function(){i({totalTime:o._getTotalTime()})}),n&&(this.options.onended=n),this.player.play(),this.isPlaying=!0,this.checkFinishedHandler=setTimeout(function(){s()||(o.checkFinishedHandler=setTimeout(arguments.callee,500))},1e3))},_pause:function(){this.isPlaying&&(this.player.pause(),this.isPlaying=!1)},_stop:function(){this._pause();var t=this.player.duration;this.player.readyState>0&&1/0!==t&&(this.player.currentTime=t)},_setMute:function(t,i){this.isMute=i,this.player.muted=i},_setVolume:function(t,i){i=+i,i>=0&&1>=i&&(this.volume=i,this.player.volume=i)},_setCurrentPosition:function(t){this.player.currentTime=t},_getCurrentPosition:function(){return this.player.currentTime/this.player.duration},_getTotalTime:function(){return 0===this.player.readyState||1/0===this.player.duration?0:1e3*this.player.duration},_getCurrentTime:function(){return 1e3*this.player.currentTime}}});_.Module.define({path:"common/widget/Voice",requires:["common/widget/Card","common/widget/AudioPlayer"],sub:{version:"0.1",api:"/voice/index?",pidWhiteList:[40649447103,40649504943,40649558518,40649601183],initial:function(e){if(!PageData.pbVoiceLoaded){PageData.pbVoiceLoaded=!0;this.product=PageData.product||e.product,this.product&&(this.api=e&&e.api||this.api,this.useMd5=e&&e.useMd5,this.canPlay=e&&e.canPlay,this.playerType=e&&e.playerType,$("body").on("click",".voice_player a ",function(e){e.preventDefault()}),this.initPlayer(),$(window).bind("initvoicelength",function(e,t){var a=$(t),i=a.find(".minute"),n=a.find(".second");if(i.length>0||n.length>0&&n.text()>=30)a.width(125);else if(n.length>0){var r=n.text();a.width(5>=r?50:50+3*(r-5))}}),$(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)}))}},initPlayer:function(){var e=this;"audio"===this.playerType||"audioFlash"===this.playerType?(this.player=this.use("common/widget/VoicePlayer"),this.player.isSupport||"audioFlash"!==this.playerType||(this.player=this.use("common/widget/AudioPlayer"))):this.player=this.use("common/widget/AudioPlayer"),this.player.bind("playerloaded",function(){e.bindPlayerEvent(),e.player._setVolume("",100)})},bindPlayerEvent:function(){var e=this,t=this.animateIcon,a=this.player,i=null;$("body").on("click",".voice_player a",function(n){function r(e){e.totalTime>0&&!u.data("time")&&0!=e.totalTime&&u.data("time",e.totalTime)}function s(t){var a=(0!=t.totalTime?t.totalTime:u.data("time"))-t.currentTime;e.updateTime(u,a)}function o(){d.data("state",""),e.resetTime(u),t.reset(c)}n.preventDefault(),$.stats.track("voice_btn_total","pc_voice");{var l,p,d=$(this).parent(".voice_player"),c=d.find(".speaker"),u=d.find(".time"),m=d.hasClass("voice_player_mini");m?"lzl":e.product}if(d.hasClass("in_live_thread")){var h=d.data("info")||{};l=h.tid,p=h.pid}else"pb"===e.product?(l=PageData.thread&&PageData.thread.thread_id,p=m?d.parents(".j_lzl_s_p").getData().spid:d.parents(".l_post").getData().content.post_id):"frs"==e.product?l=d.parents(".j_thread_list").data("field").id:"index"==e.product&&(l=d.data("tid"));var g="";if(g=1==e.useMd5?e.api+"?voice_md5="+d.data("md5"):e.api+"tid="+l+(p?"&pid="+p:""),1!=e.canPlay&&-1==$.inArray(p,e.pidWhiteList))return void(i&&(a.trigger("stop"),e.resetPrevPlayer(i)));if("playing"===d.data("state"))a.trigger("stop"),d.data("state",""),t.reset(c),e.resetTime(u),$.stats.track("voice_stop","pc_voice");else{e.resetPrevPlayer(i),a.trigger("stop"),d.data("state","playing"),t.set(c,"loading"),$.stats.track("voice_play","pc_voice");var y=u.find(".minute"),f=u.find(".second"),v=y.length>0?+y.html():0,_=f.length>0?+f.html():0;u.data("time",6e4*v+1e3*_),a.trigger("load",g,function(){a.trigger("play",r,s,o),t.set(c,"playing")},function(){a.trigger("stop"),d.data("state",""),t.reset(c),e.resetTime(u);var i=$.tb.alert({title:"\u64AD\u653E\u5931\u8D25",message:"\u6211\u4E0D\u662F\u6545\u610F\u7684\uFF0C\u64AD\u653E\u5931\u8D25\u4E86\uFF0C\u8BF7\u518D\u8BD5\u4E00\u4E0B\u5427~",buttons:[{text:"\u786E\u8BA4"}],width:310});i.modal.bind("click",function(){i.hide()})}),i=d}})},updateTime:function(e,t){t=t||e.data("time")||0;var a=Math.floor(t/6e4),i=Math.round(t%6e4/1e3),n="";a>0&&(n+='<span class="minute">'+a+"</span>'"),(i>0||a>0)&&(n+='<span class="second">'+i+'</span>"'),e.html(n)},resetTime:function(e){this.updateTime(e)},resetPrevPlayer:function(e){if(e){var t=e.find(".speaker"),a=e.find(".time");e.data("state",""),this.resetTime(a),this.animateIcon.reset(t)}},animateIcon:function(){function e(e,t){if($.browser.mozilla){var a=e.parent().parent().hasClass("loading")?"loading":"playing",i=e.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal",n=t+"px "+s[i][a]+"px";e.css("background-position",n)}else e.css("background-position-x",t)}function t(t,s){l&&a(l),a(t),l=t,t.parent().parent().addClass(s);var p=t.parent().parent().parent().hasClass("voice_player_mini")?"mini":"normal";"playing"===s?(t.parent().parent().hasClass("voice_player_mini")?e(t,-38):e(t,-58),o=setTimeout(function(){var a=0;return function(){a=(a+1)%4,e(t,i[p][a]),o=setTimeout(arguments.callee,r[s])}}(),r[s])):"loading"===s&&(t.parent().parent().hasClass("voice_player_mini")?e(t,-1):e(t,-1),o=setTimeout(function(){var a=0;return function(){a=(a+1)%12,e(t,-1-a*n[p]),o=setTimeout(arguments.callee,r[s])}}(),r[s]))}function a(t){clearTimeout(o),t.parent().parent().removeClass("loading playing"),t.parent().parent().parent().hasClass("voice_player_mini")?e(t,-38):e(t,-58)}var i={normal:[-1,-20,-39,-58],mini:[1,-12,-25,-38]},n={normal:20,mini:15},r={playing:400,loading:100},s={normal:{playing:-206,loading:-171},mini:{playing:-264,loading:-237}},o=null,l=null;return{set:t,reset:a}}()}});_.Module.define({path:"encourage/widget/meizhi_vote",requires:["common/component/Card"],sub:{_visit_card:null,_vote_card:null,_visit_card_ajax:null,_vote_button:null,_visit_card_option:{width:280,height:237},_special_visit_card_option:{width:280,height:210},initial:function(){this._wrap=$("body"),this._is_meizhi=PageData.user.is_login&&PageData.user.meizhi_level>=0?!0:!1,this.bindEvents()},bindEvents:function(){var t=this;this._wrap.delegate(".j_meizhi_vip","mouseenter",function(){return t.buildVisitCard(this),!1}),this._wrap.delegate(".j_meizhi_vip","mouseleave",function(){return t._visit_card_ajax&&t._visit_card_ajax.abort(),t._visit_card&&t._visit_card.closeCard({type:"delayClose",time:200}),t._visit_card=null,!1}),this._wrap.delegate(".j_meizhi_vote","click",function(e){return t._vote_card&&(t._vote_card.closeCard(),t._vote_card=null,t._vote_button==e.target)?(e.preventDefault(),!1):(t.buildVoteCard(this),t._vote_button=e.target,e.preventDefault(),void 0)})},buildVoteCard:function(t){var e=this,i=$(t).getData(),a=i.user_id;$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),s=$(t),_=s.offset().left-140+s.outerWidth(!0)/2,d=s.offset().top-64-12;e._vote_card&&(e._vote_card.closeCard(),e._vote_card=null),e._vote_card=e.use("common/component/Card",{content:n,card_css:{top:d,left:_,width:280,height:64},attr:"id='meizhi_vote_card'",wrap:$("body")}),e.bindVoteCardEvent()}})},bindVoteCardEvent:function(){var t=this;t._vote_card.showCard(),t._vote_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("frs_btn","meizhi_vote"),t.vote(this)})},vote:function(t){var e=this,i=$(t),a=i.getData(),o=a.vote_type,n="/encourage/post/meizhi/checkvcode",s="/encourage/post/meizhi/getvcode";_.Module.use("common/component/PostorServiceMeizhi",[],function(t){t.postHandler({data:{content:"",tbs:PageData.tbs,fid:PageData.forum.id||PageData.forum.forum_id,kw:PageData.forum.name,uid:a.user_id,scid:PageData.user.id||0,vtype:o,ie:"utf-8",vcode:""},checkUrl:n,vCodeUrl:s,url:"/encourage/post/meizhi/vote",type:"vote",success:function(t){var a=t,n=$('<img class="add_one_icon" src="/tb/static-encourage/img/meizhi/add_one.gif">');n.appendTo(i).animate({top:"-=20",opacity:0},1e3);var s=e.cutVoteCount(a.vote_count[o]);s=s?s:1,i.find(".j_vote_count").text(s);var _=i.parent();_.find(".j_vote_text").addClass("vote_text_small"),_.find(".j_vote_count").removeClass("hide"),_.siblings(".j_vote_tip").text("\u6295\u7968\u6210\u529F\uFF0C\u5BF9\u8BE5\u7528\u6237\u6BCF\u56DB\u5C0F\u65F6\u53EA\u80FD\u6295\u7968\u4E00\u6B21\u3002"),_.addClass("disabled").find(".j_vote_button").removeClass("j_vote_button"),1==a.hasCheckVcode&&e._msgDialog(),$.stats.track("vote_succ","meizhi_vote")}})})},_msgDialog:function(){var t={image:'<img style="border:none;" src="https://gsp0.baidu.com/5aAHeD3nKhI2p27j8IqW0jdnxx1xbK/tb/img/messageFace.gif">',subMessage:"\u6295\u7968\u6210\u529F",message:"",dialogSet:{width:410,height:50,title:"\u53D1\u8D77\u6295\u7968"}},e='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "\u5B8B\u4F53";"><table style="width:90%"><tbody><tr><td width="60">'+t.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "\u9ED1\u4F53";">'+t.subMessage+"</td></tr></tbody></table>"+t.message+"</div>";$.dialog.alert(e,t.dialogSet)},buildVisitCard:function(t){var e=this,i=$(t).parent().getData(),a=i.user_id;this._visit_card_ajax&&this._visit_card_ajax.abort(),this._visit_card_ajax=$.ajax({type:"post",url:"/encourage/get/meizhi/panel",data:{user_id:a,type:1},dataType:"json"}).success(function(i){if(0==i.no){var o=i.data,n=o.level-1?o.level-1:"",s=e.calPercent(o.vote_count),_="/i/sys/jump?un="+encodeURIComponent(o.uname)+"&ie=utf-8",d=o.group_info.has_group,v=d?'<span class="group_icon" title="\u5FEB\u5230\u88D9\u91CC\u6765">&nbsp;</span>':"",r=d?'<div class="clearfix"><span style="display:inline;float:left;">Ta\u7684\u7FA4\u7EC4\uFF1A</span><a class="group_name" href="/group/index?id='+o.group_info.group_id+'" target = "_blank" >'+o.group_info.group_name+"</a></div>":"",c=["<a href="+_+' title="\u5934\u50CF" class="meizhi_avatar" target="_blank"><img src="'+o.avatar+'"></a>','<div class="meizhi_corner"></div>','<div class="meizhi_info">','<h1 class="clearfix"><a class="name" href='+_+' title="\u540D\u5B57" target="_blank">'+o.uname+"</a>"+v+"</h1>",r,'<div>\u7B49\u7EA7\uFF1A<span class="level">MVP'+n+"</span></div>",'<div>\u6240\u5728\u5427\uFF1A<span class="forum_name">'+o.forum_name+"\u5427</span></div>","</div>",'<p><a href = "/p/'+o.thread_id+'" target = "_blank" >\u770B\u770BTa\u7684\u8BA4\u8BC1\u8D34>>></a></p>',"<p>\u5DF2\u6295\u7968\u6BD4\u4F8B\uFF1A</p>",'<div class="meizhi_vote_weight_wrap">','<span class="vote_weight_meizhi" style="width:'+s.meizhi_orign_percent+'%">'+s.meizhi_need_percent+"</span>",'<span class="vote_weight_weiniang" style="width:'+s.weiniang_orign_percent+'%;">'+s.weiniang_need_percent+"</span>",'<span class="vote_weight_renyao" style="width:'+s.renyao_orign_percent+'%;">'+s.renyao_need_percent+"</span>","</div>"].join(""),l=e._is_meizhi;l||(c+=o.can_vote?'<p class="j_vote_tip">\u6295\u51FA\u65E0\u8282\u64CD\u7684\u771F\u8BDA\u4E00\u7968\uFF01</p>':"<p>\u6295\u7968\u6210\u529F\uFF0C\u5BF9\u8BE5\u7528\u6237\u6BCF\u56DB\u5C0F\u65F6\u53EA\u80FD\u6295\u7968\u4E00\u6B21\u3002</p>"),c+=e.buildVoteBtnGroup(o.can_vote,a,o.vote_count),c+=e.addTip(o,l);var u=$(t),p=l?e._special_visit_card_option:e._visit_card_option;e._visit_card&&(e._visit_card.closeCard(),e._visit_card=null),e._visit_card=e.use("common/component/Card",{content:c,card_css:{width:p.width,height:p.height},auto_positon:!0,event_target:u,attr:"id='meizhi_visit_card'",wrap:$("body")}),e.bindVisitCardEvent()}})},addTip:function(t,e){var i;return i=e?'<p class="level_up_tip"><span class="level_up_tip_title">\u5B8C\u6210\u5EA6:</span>\u83B7\u5F97'+t.exp_value+"\u70B9\u7ECF\u9A8C\u3001"+t.levelup_left+"\u5F20\u59B9\u7EB8\u7968\u540E\u5347\u7EA7</p>":'<a class="meizhi_card_tip" href="//tieba.baidu.com/tb/zt/meizhi/index.html" target="_blank">\u4EC0\u4E48\u662F\u59B9\u7EB8\u8BA4\u8BC1\u7CFB\u7EDF>></a>'},calPercent:function(t){var e=t.meizhi+t.weiniang+t.renyao,i=Math.round(t.meizhi/e*100),a=Math.round(t.weiniang/e*100),o=100-i-a,n=10,s=i>n?i+"%":"",_=a>n?a+"%":"",d=o>n?o+"%":"";$.browser.msie&&$.browser.version<8&&(i>30?i-=1:a>30?a-=1:o>30&&(o-=1));var v={meizhi_orign_percent:i,weiniang_orign_percent:a,renyao_orign_percent:o,meizhi_need_percent:s,weiniang_need_percent:_,renyao_need_percent:d};return v},buildVoteBtnGroup:function(t,e,i){var a;if(this._is_meizhi)a=['<div class="meizhi_vote_button_wrap meizhi_disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">\u59B9\u7EB8</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">\u4F2A\u5A18</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<span class="btn_split"></span>','<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">\u4EBA\u5996</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");else if(t){var o={user_id:e,vote_type:"meizhi"},n={user_id:e,vote_type:"weiniang"},s={user_id:e,vote_type:"renyao"};a=['<div class="meizhi_vote_button_wrap">','<div class="j_vote_button vote_button vote_button_meizhi"'+$.tb.dataField(o)+">",'<div class="vote_text j_vote_text">\u59B9\u7EB8</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_weiniang"'+$.tb.dataField(n)+">",'<div class="vote_text j_vote_text">\u4F2A\u5A18</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="j_vote_button vote_button vote_button_renyao"'+$.tb.dataField(s)+">",'<div class="vote_text j_vote_text">\u4EBA\u5996</div>','<div class="vote_count j_vote_count hide">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("")}else a=['<div class="meizhi_vote_button_wrap disabled">','<div class="vote_button vote_button_meizhi">','<div class="vote_text vote_text_small">\u59B9\u7EB8</div>','<div class="vote_count">'+this.cutVoteCount(i.meizhi)+"</div>","</div>",'<div class="vote_button vote_button_weiniang">','<div class="vote_text vote_text_small">\u4F2A\u5A18</div>','<div class="vote_count">'+this.cutVoteCount(i.weiniang)+"</div>","</div>",'<div class="vote_button vote_button_renyao">','<div class="vote_text vote_text_small">\u4EBA\u5996</div>','<div class="vote_count">'+this.cutVoteCount(i.renyao)+"</div>","</div>","</div>"].join("");return a},cutVoteCount:function(t){return t>9999?"9999+":t},bindVisitCardEvent:function(){var t=this;this._visit_card.showCard({type:"delayShow",time:200}),this._visit_card._j_card.delegate(".j_vote_button","click",function(){$.stats.track("card_btn","meizhi_vote"),t.vote(this)})}}});
;var Thread_add_result={resultNo:0,fid:"",tid:"",vid:"",sign:"",bdauditreason:0,bdQueryWordEnc:"",autoMsg:"",is_login:0,init:function(e){if(Thread_add_result&&e.data&&"object"==typeof e.data)for(var a in e.data)Thread_add_result[a]=e.data[a];Thread_add_result.resultNo=e.no,Thread_add_result.errCode=e.err_code},isNeedWaitForCheck:function(){var e=!1;switch(this.resultNo){case 9:case 20:case 23:e=!0}return e},isNeedBindPhone:function(){return 4010==this.resultNo},Action_FocusTitle:"focusTitle",Action_FocusContent:"focusContent",Action_ClearYZM:"clearYZM",Action_FocusUrl:"focusUrl",Action_GoToHead:"goToHead",Action_FlushAndGoToHead:"flushAndGoToHead",getActionType:function(){var e="";switch(this.resultNo){case 10:case 14:case 501:case 15:case 36:case 41:case 42:case 43:case 46:case 9001:case 10010:case 10011:case 10012:case 10013:case 220012:case 220015:case 220035:case 2130001:case 2130007:case 2130008:case 2130009:case 2130011:case 2130012:case 2130014:case 2130005:e=this.Action_FocusContent;break;case 11:case 20:e=this.Action_FocusTitle;break;case 17:case 0:e=this.Action_FlushAndGoToHead;break;case 22:case 9:case 23:case 119:case 44:case 100:case 703:case 704:case 705:e=this.Action_GoToHead;break;case 38:case 39:case 40:e=this.Action_ClearYZM;break;case 1120:case 1121:e=this.Action_FocusUrl}return e},getMessage:function(){var e="",a=null;if(this.resultNo>=901&&this.resultNo<=950)return Thread_add_result.autoMsg;switch(null==a&&(a=PageData.forum?PageData.forum.id:null),null==a&&(a=PageData.forum_id),null==a&&(a=PageData.forumID),this.resultNo){case 10:e="\u8D34\u5B50\u5185\u5BB9\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57";break;case 11:e="\u8D34\u5B50\u6807\u9898\u548C\u5185\u5BB9\u592A\u957F";break;case 12:e=this.errCode+""=="3250012"?"\u53D1\u8D34\u5931\u8D25\uFF0C\u60A8\u7684\u8D26\u53F7\u5B58\u5728\u88AB\u76D7\u98CE\u9669\uFF0C\u8BF7\u5728\u53D1\u8D34\u9875\u9762\u70B9\u51FB\u9A8C\u8BC1":null!=a?"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u8D26\u53F7\u56E0\u8FDD\u89C4\u64CD\u4F5C\u800C\u88AB\u5C01\u7981&nbsp;&nbsp;<a href='/pmc/main' target=\"_blank\">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>":"\u64CD\u4F5C\u5931\u8D25";break;case 13:e=null!=a?"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01<br/><a href='/upc/userinfo?fid="+a+'\' target="_blank">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>':"\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01 ";break;case 14:e="\u60A8\u53D1\u5E03\u7684\u8D34\u5B50\u5DF2\u7ECF\u5B58\u5728";break;case 501:case 15:e="\u8BF7\u4E0D\u8981\u53D1\u8868\u542B\u6709\u4E0D\u9002\u5F53\u5185\u5BB9\u7684\u7559\u8A00<br>\u8BF7\u4E0D\u8981\u53D1\u8868\u5E7F\u544A\u8D34";break;case 16:e="\u5BF9\u4E0D\u8D77\uFF0C\u60A8\u6240\u8F93\u5165\u7684\u8D34\u5427\u4E0D\u5B58\u5728\u3002\u7531\u4E8E\u7CFB\u7EDF\u5347\u7EA7\u7EF4\u62A4\uFF0C\u65B0\u5EFA\u8D34\u5427\u529F\u80FD\u6682\u505C\uFF0C\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\uFF01";break;case 19:case 200:case 201:case 202:e="\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868";break;case 20:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u7684\u6807\u9898\u6216\u6B63\u6587\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u53D1\u8868";break;case 17:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 18:case 21:e="\u5176\u4ED6\u672A\u77E5\u539F\u56E0";break;case 22:e="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u7531\u4E8E\u7279\u6B8A\u539F\u56E0\u6211\u4EEC\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u6211\u4EEC\u4F1A\u572810\u5206\u949F\u5185\u786E\u8BA4\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85\uFF01";break;case 9:e=this.getCheckMessage(this.bdauditreason);break;case 33:e=1==Thread_add_result.is_login?"\u60A8\u53D1\u8D34\u592A\u5FEB\u4E86:) \u8BF7\u7A0D\u540E\u518D\u53D1":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 34:e=1==Thread_add_result.is_login?"\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 220034:e="\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898";break;case 220035:e="\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~";break;case 35:e=1==Thread_add_result.is_login?"\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~":"\u60A8\u53D1\u8D34\u901F\u5EA6\u592A\u5FEB\u4E86\u3002\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u8D34\uFF0C\u7CFB\u7EDF\u5BF9\u533F\u540D\u53D1\u8D34\u8FDB\u884C\u4E25\u683C\u7684\u63A7\u5236\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD";break;case 36:e="\u8BF7\u4E0D\u8981\u53D1\u5E7F\u544A\u8D34\uFF01";break;case 37:e="\u60A8\u5DF2\u5C1D\u8BD5\u63D0\u4EA4\u591A\u6B21\u4E86\uFF0C\u8BF7\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 38:e="\u9A8C\u8BC1\u7801\u8D85\u65F6\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165";break;case 39:e="\u7531\u4E8E\u60A8\u591A\u6B21\u8F93\u9519\u9A8C\u8BC1\u7801\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34";break;case 40:e="\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u91CD\u65B0\u8F93\u5165";break;case 41:e="\u60A8\u7684\u8D34\u5B50\u53EF\u80FD\u5305\u542B\u4E0D\u5408\u9002\u7684\u5185\u5BB9\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u63D0\u4EA4";break;case 42:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u88AB\u7CFB\u7EDF\u8BA4\u4E3A\u6709\u53D1\u5E7F\u544A\u5ACC\u7591\uFF0C\u8BF7\u60A8\u7A0D\u540E\u518D\u53D1";break;case 43:e="\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u6216\u8D34\u5B50\u5185\u5BB9\u6709\u5E7F\u544A\u6216\u4E0D\u5408\u9002\u7684\u7279\u5F81\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u53D1\u9001";break;case 23:e="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u9700\u8981\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u5EFA\u7ACB\u8D34\u5427";break;case 119:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u4E3B\u9898\u7684\u56DE\u590D\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C\u611F\u8C22\u60A8\u7684\u53C2\u4E0E\uFF0C\u6B22\u8FCE\u60A8\u6D4F\u89C8\u672C\u5427\u7684\u5176\u5B83\u4E3B\u9898";break;case 1120:e="\u62B1\u6B49\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u3001\u89C6\u9891\u94FE\u63A5\u5730\u5740\u9519\u8BEF\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB<a href='//www.baidu.com/search/post_img.html' target='_blank'>\u67E5\u770B\u76F8\u5173\u5E2E\u52A9</a>\u6216\u8FD4\u56DE\u4FEE\u6539";break;case 1121:e="\u62B1\u6B49\uFF0C\u89C6\u9891\u670D\u52A1\u5347\u7EA7\u4E2D\uFF0C\u60A8\u6682\u65F6\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u89C6\u9891\u7684\u8D34\u5B50\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u8BF7\u539F\u8C05";break;case 44:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8868\u4E3B\u9898\u8D34\u5B50\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u6216\u56DE\u590D\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 100:e="\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u4F7F\u7528\u5B8C\u6574\u7684\u8D34\u5427\u529F\u80FD\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002";break;case 701:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u4E0D\u5141\u8BB8\u672A\u767B\u5F55\u7528\u6237\u53D1\u8D34\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 702:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 703:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u4F1A\u5458\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F\u3002<a href='/f?kw="+this.bdQueryWordEnc+"#1' target=_blank>\u70B9\u6B64\u7533\u8BF7\u52A0\u5165</a>\u672C\u5427\u4F1A\u5458";break;case 704:e="\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u7BA1\u7406\u56E2\u961F\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F";break;case 705:e="\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01";break;case 706:e="\u62B1\u6B49\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 45:e="\u62B1\u6B49\uFF0C\u60A8\u63D0\u4EA4\u7684\u8D34\u5427\u540D\u79F0\u542B\u7279\u6B8A\u5B57\u7B26\uFF0C\u76EE\u524D\u65E0\u6CD5\u521B\u5EFA\uFF0C\u63A8\u8350\u60A8\u4F7F\u7528\u6C49\u5B57\u3001\u5B57\u6BCD\u6216\u6570\u5B57\u4F5C\u4E3A\u8D34\u5427\u540D\u79F0";break;case 46:e="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8FC7\u957F\uFF0C\u65E0\u6CD5\u6B63\u5E38\u63D0\u4EA4\u3002\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u91CD\u65B0\u63D0\u4EA4\uFF0C\u8C22\u8C22!";break;case 800:break;case 801:break;case 802:break;case 803:break;case 804:break;case 805:break;case 806:break;case 807:break;case 808:break;case 809:break;case 814:break;case 815:e="\u62B1\u6B49\uFF0C\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u6216\u672A\u8D2D\u4E70\u97F3\u4E50\u9053\u5177\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5";break;case 900:e="\u4E3A\u62B5\u5FA1\u6316\u575F\u5371\u5BB3\uFF0C\u672C\u5427\u5427\u4E3B\u5DF2\u653E\u51FA\u8D34\u5427\u795E\u517D--\u8D85\u7EA7\u9759\u6B62\u86D9\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002";break;case 961:e="\u53D1\u8D34\u5931\u8D25\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u5730\u5740\u6709\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u66F4\u6B63\u540E\u518D\u6B21\u53D1\u5E03\uFF1A\uFF09";break;case 9001:e="\u7531\u4E8E\u533F\u540D\u72B6\u6001\u6216\u672C\u5427\u8BBE\u7F6E\uFF0C\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u56FE\u7247\u7684\u4E3B\u9898\u3002";break;case 2100:e="\u5185\u5BB9\u542B\u6709\u9AD8\u7EA7\u5B57\u4F53\u6548\u679C\uFF0C\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u5C31\u80FD\u4F7F\u7528\u54E6~~";break;case 4010:e="\u60A8\u7684\u8D26\u53F7\u5B58\u5728\u5B89\u5168\u98CE\u9669\u6682\u4E0D\u80FD\u53D1\u8D34\uFF0C\u8BF7\u5148\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u540E\u518D\u53D1\u8D34\u5427\u3002";break;case 9e3:e="\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148\u586B\u5199\u7528\u6237\u540D\u3002";break;case 10010:e="\u60A8\u7684\u6027\u522B\u65E0\u6CD5\u8FDB\u884C\u59B9\u7EB8\u8BA4\u8BC1</br><a style = 'font-size:12px;' href = '//www.baidu.com/p/setting/profile/basic' target ='_blank'>\u53BB\u4FEE\u6539\u6211\u7684\u6027\u522B>><a>";break;case 10012:e="\u8BF7\u4E0A\u4F20\u81F3\u5C11\u4E00\u5F20\u56FE\u7247\u3002";break;case 10013:e="\u60A8\u53D1\u5F80\u7684\u5427\u672A\u5F00\u901A\u59B9\u7EB8\u8BA4\u8BC1\u529F\u80FD\u3002";break;case 2130001:e="\u8BF7\u4E0D\u8981\u7ED9\u975E\u59B9\u7EB8\u7528\u6237\u6295\u7968\u3002";break;case 2130007:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2130008:e="\u60A8\u5DF2\u7ECF\u7ED9\u8BE5\u7528\u6237\u6295\u8FC7\u7968\u3002";break;case 2130009:e="\u6295\u7968\u5931\u8D25\u3002";break;case 2130005:e="\u60A8\u5DF2\u7ECF\u53D1\u8D77\u8FC7\u59B9\u7EB8\u8BA4\u8BC1\u8D34</br><a href='/p/"+Thread_add_result.thread_id+"' target = '_blank' >//tieba.baidu.com/p/"+Thread_add_result.thread_id+"</a>";break;case 2130011:e="\u59B9\u7EB8\u8BA4\u8BC1\u7528\u6237\u4E4B\u95F4\u4E0D\u80FD\u76F8\u4E92\u6295\u7968\u3002";break;case 220012:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 220013:e="\u60A8\u7684IP\u5DF2\u88AB\u5C01\u7981\u3002";break;case 225001:e="\u60A8\u7684\u8D26\u53F7\u7981\u6B62\u8D34\u6761\u3002";break;case 220015:e="\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u542B\u6709\u654F\u611F\u4FE1\u606F\u3002";break;case 219e4:e="<p>\u62B1\u6B49\u60A8\u6CA1\u6709\u8D34\u6761\u9053\u5177\u4E86\u4E0D\u80FD\u53D1\u5E03\u8D34\u6761\u4FE1\u606F\u3002</p><p>PS\uFF1A\u53D1\u8D34,\u56DE\u8D34,\u53C2\u52A0\u6D3B\u52A8\u90FD\u6709\u673A\u4F1A\u83B7\u5F97\u8D34\u6761\u9053\u5177\u3002</p>";break;case 2130012:e="\u4E0D\u80FD\u7ED9\u81EA\u5DF1\u6295\u7968\u3002";break;case 2130014:e="\u4E0D\u80FD\u7ED9\u7537\u6027\u7528\u6237\u6295\u7968";break;case 2190001:e="\u60A8\u8BF4\u8BDD\u592A\u5FEB\u5566\uFF0C\u8BF7\u4F11\u606F\u4E00\u4E0B\u3002";break;case 2190002:e="\u62B1\u6B49\uFF0C\u6BCF10\u5206\u949F\u53EA\u80FD\u62A2\u4E00\u6B21\u8D34\u6761\u3002";break;case 2190003:e="<p>\u771F\u9057\u61BE~\u60A8\u6CA1\u6709\u62A2\u5230\u8D34\u6761\u9053\u5177\u3002</p><p>PS\uFF1A\u7B49\u7EA7\u8D8A\u9AD8\u83B7\u5F97\u9053\u5177\u51E0\u7387\u8D8A\u9AD8\u54E6\uFF01</p>";break;case 2190004:e="\u670D\u52A1\u5668\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5";break;case 2190005:e="\u60A8\u7684\u8D26\u53F7\u5DF2\u88AB\u5C01\u7981\u3002";break;case 2190006:e="\u8D34\u6761\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u3002";break;case 2190007:e="\u8D34\u6761\u5185\u5BB9\u8FC7\u957F\u3002";break;case 2190008:e="\u4ECA\u5929\u7684\u9053\u5177\u88AB\u62A2\u5B8C\u5566\uFF0C\u660E\u5929\u7EE7\u7EED\u52A0\u6CB9\uFF01";break;default:e="\u672A\u77E5\u9519\u8BEF\u3002"}return e},getCheckMessage:function(e){var a="";switch(e){case-61:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u6240\u53D1\u7684\u8D34\u5B50\u5F85\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-62:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u8D34\u56FE\u7684\u8D34\u5B50\u9700\u8981\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-74:case-75:case-60:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85";break;case-70:a="\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u63A7\u5236\u5E7F\u544A\u8D34\uFF0C\u9700\u8981\u901A\u8FC7\u5BA1\u6838\u540E\u624D\u80FD\u53D1\u5E03\u3002\u767B\u9646\u7F72\u540D\u53D1\u8D34\u4E0D\u53D7\u6B64\u9650\u5236\u3002";break;case-71:a="\u60A8\u53D1\u8868\u7684\u5E16\u5B50\u592A\u957F\u4E86\u3002\u4E3A\u4E86\u9632\u6B62\u704C\u6C34\uFF0C\u9700\u7CFB\u7EDF\u5BA1\u6838\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u7A0D\u540E\u67E5\u770B";break;default:a="\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85"}return a}};_.Module.define({path:"encourage/widget/WelfareIcon",sub:{_card:null,_isGifing:!1,initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var t=this;this._wrap.on("mouseenter",".j_score_welfare",function(){t._buildCard(this)}).on("mouseleave",".j_score_welfare",function(){return t._card&&t._card.closeCard({type:"delayClose",time:200}),t._card=null,!1}).on("click",".j_score_welfare",function(e){return t.showGif(e),!1})},showGif:function(t){var e=$("<div></div>"),i=this,o="//tb1.bdstatic.com/tb/r/image/2014-04-11/968642070f6c20e5274ba44b5a75707f.gif",n=$('<img style="position:absolute;z-index: 50000; left: 80px; top: 80px;width:1px;height: 1px;" src="">');this._isGifing||(this._isGifing=!0,e.css({position:"absolute",zIndex:5e4,left:t.pageX-80,top:t.pageY-80}),e.append(n),$("body").append(e),setTimeout(function(){n.tbattr("src",o)},0),n.animate({width:190,height:134,top:0,left:0},300),setTimeout(function(){n.animate({width:1,height:1,top:80,left:80},300,function(){e.remove(),i._isGifing=!1})},3e3))},_buildCard:function(t){var e,i=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u6709\u6548\u671F\uFF1A2014\u5E7412\u670831\u65E5</p></div>"].join(""),o=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u53D1\u798F\u5229\u6709\u673A\u4F1A\u83B7\u5F97\uFF01</p>",'<p style="color:#fc6853">\u70B9\u6211\uFF01</p></div>'].join(""),n=$(t),s=n.getData();if(s){e=s.user_id!==PageData.user.user_id?o:i;var a=n.offset().left-86+n.outerWidth(!0)/2,d=n.offset().top-64-12;this._card=this.use("common/widget/Card",{content:e,card_css:{top:d,left:a,width:172},auto_positon:!0,event_target:n,wrap:$("body")}),this._card.showCard({type:"delayShow",time:200})}}}});_.Module.define({path:"encourage/widget/achieveCard",requires:["common/component/Card"],sub:{initial:function(){this._wrap=$("body"),this._bindEvent()},_bindEvent:function(){var a=this;this._wrap.on("mouseenter",".j_fighter",function(e){var t=$(e.target),i=t.getData();$.post("/tbmall/gthread/iconbanner",{tbs:PageData.tbs,user_id:i.user_id},function(e){var i=t.offset();if(0===e.no){var c='<div class="achievement_card">    <p class="achievement_card_content">       <img class="achievement_card_img" src="https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/'+e.data.portrait+'" alt="" height=66 width=66 />        <span class="achievement_card_uname">'+e.data.user_name+'</span><i class="achievement_card_icon"></i></br>        <span class="achievement_card_medal">\u9996\u5C4A\u62F3\u738B\u4E89\u9738\u8D5B - '+e.data.icon_name+' </span></br>    </p><a class="achievement_card_link" href="/tbmall/gthread/center" target="_blank">\u9996\u5C4A\u8D34\u5427\u62F3\u738B\u4E89\u9738\u8D5B>></a></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:265,"z-index":1e3,top:i.top-117-12,left:i.left-126,card_leave_display:!0},wrap:$("body"),attr:"id='achieve_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}})}).on("mouseleave",".j_fighter",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_fighter",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_cup_a, .j_cup_b",function(e){var t=$(e.target),i=t.offset(),c="A CUP \u5370\u8BB0",d="//tb1.bdstatic.com/tb/cms/fifa/girl/cup_a.png";$(this).hasClass("j_cup_b")&&(c="B CUP \u5370\u8BB0",d="//tb1.bdstatic.com/tb/cms/fifa/girl/cup_b.png");var n='<div class="cup_card"><div class="cup_card_top clearfix"><img src="'+d+'" width="57" height="57" /><p class="title">'+c+'</p><p>\u8981\u4E24\u4E2A\u4E00\u8D77\u624D\u591F\u597D\uFF01</p></div><div class="cup_card_bottom"><a href="/f?ie=utf-8&kw=%E4%B8%96%E7%95%8C%E6%9D%AF#cupicon" target="_blank">\u4E16\u754C\u676F\u671F\u95F4\u7ED9\u5973\u795E\u9C9C\u82B1\u83B7\u5F97\uFF01</a></div></div>';a._medalCard=a.use("common/component/Card",{content:n,card_css:{width:235,"z-index":1e3,top:i.top-110-12,left:i.left-110,card_leave_display:!0},wrap:$("body"),attr:"id='cup_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_cup_a, .j_cup_b",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_cup_a, .j_cup_b",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_minigame",function(e){var t=$(e.target),i=(t.getData(),t.offset()),c='<div class="minigame_card"><div class="minigame_card_top clearfix"><img src="//tb1.bdstatic.com/tb/r/image/2014-08-05/32d9b951b986efbb2ad5ce0f445ce9be.png" width="57" height="57" /><p class="title">\u6E38\u620F\u738B\u5370\u8BB0</p><p>\u5728\u3010T\u8C46\u5C0F\u6E38\u620F\u3011\u4E2D\u8FDE\u7EED3\u5929\uFF0C\u6BCF\u5929\u81F3\u5C11\u5B8C\u6210\u4E00\u5C40\u6BD4\u8D5B\uFF0C\u5373\u53EF\u83B7\u5F97\u3002</p></div><div class="minigame_card_bottom"><a href="/minigame/home" target="_blank">T\u8C46\u5C0F\u6E38\u620F</a></div></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:275,"z-index":1e3,top:i.top-110-12,left:i.left-130,card_leave_display:!0},wrap:$("body"),attr:"id='minigame_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_minigame",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})})}}});_.Module.define({path:"fanclub/widget/fancard",requires:["common/widget/Card"],sub:{_fancard:null,_fancard_ajax:null,_fancard_data:{},_forum_id:"0",initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var a=this;this._wrap.delegate(".j_fanclub_vip","mouseenter",function(){return $(this).tbattr("title",""),a._getCardData(this),!1}),this._wrap.delegate(".j_fanclub_vip","mouseleave",function(){return a._fancard_ajax&&a._fancard_ajax.abort(),a._fancard&&a._fancard.closeCard({type:"delayClose",time:200}),a._fancard=null,!1})},_getCardData:function(a){var t=$(a).getData();if(t){var n=t.user_id,r=this;this._fancard_ajax=$.ajax({type:"GET",url:"/frsstar/browse/fanclub/fanInfo?userid="+n,dataType:"json",success:function(t){switch(t.no){case 0:r._fancard_data=t,r._buildCard(a)}},error:function(){$(a).tbattr("title","\u7F51\u7EDC\u9519\u8BEF")}})}},_buildCard:function(a){var t="",n=this._fancard_data.fanclub_array.length;n>3&&(n=3);for(var r=0;n>r;r++)0==r&&(this._forum_id=this._fancard_data.fanclub_array[r].forum_id),t+='<a  target="_blank"  href="/f?kw='+encodeURIComponent(this._fancard_data.fanclub_array[r].name)+'&ie=utf-8" class="fanclub_card_forum_name">'+this._fancard_data.fanclub_array[r].name+' <span class="fanclub_icon fanclub_icon_vip_'+this._fancard_data.fanclub_array[r].level+'"></span></a>',n-1>r&&(t+='<a class="fanclub_card_forum_name_gap">|</a>');var e=baidu.template('    <div id="fanclub_card_container">   <div class="fanclub_card_head" >    <a  target="_blank"  href="/i/sys/jump?un=\'+encodeURIComponent(this._fancard_data.username)+\'&ie=utf-8"  ><img src="https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/<%= portrait%>" alt="" /></a>   </div>   <div class="fanclub_card_right">    <a target="_blank" href="/i/sys/jump?un=<%:u= username %>&ie=utf-8" class="fanclub_card_right_title"><%= name %><span class="fanclub_icon fanclub_icon_frs "></span></a>    <p>\u52A0\u5165\u4F1A\u5458\u65F6\u95F4:<span><%= time %></span></p>    <p>\u5DF2\u52A0\u5165\u7C89\u4E1D\u4F1A:<span><%= count %>\u4E2A</span></p>   </div>   <div class="fanclub_card_forum_icon_wrapper" >    <%:= icon %>   </div>   <div class="fanclub_card_bottom">    <a  target="_blank"  href="//tieba.baidu.com/p/2676282434">\u4EC0\u4E48\u662F\u7C89\u4E1D\u4F1A\u5458&gt;&gt;</a>   </div>  </div>',{portrait:this._fancard_data.portrait,name:this._fancard_data.username,time:this._formatDate(this._fancard_data.entertime),count:this._fancard_data.fanclub_count,icon:t}),i=$(a),_=i.offset().left-140+i.outerWidth(!0)/2,c=i.offset().top-64-12;this._fancard=this.use("common/widget/Card",{content:e,card_css:{top:c,left:_,width:302,height:147},auto_positon:!0,event_target:i,attr:"id='fancard_show'",wrap:$("body")}),this._fancard.showCard({type:"delayShow",time:200})},_buildErrorCard:function(){},_formatDate:function(a){var t=new Date(1e3*a);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}});_.Module.define({path:"liveshow/widget/xiu8FollowWarn",requires:["frs/widget/forum_card/focus_btn"],sub:{initial:function(e){var t=this;t.forum_name=e.forum_name||"\u79C0",this.$el=$("#xiu8_follow_warn"),this.bindEvents()},bindEvents:function(){var e=this;this.$el.on("click",".j_xiu8_follow_warn_close",function(t){t.preventDefault(),e.$el.remove(),$.stats.track("\u5173\u95ED\u6309\u94AE",e.forum_name+"\u5427\u573A\u666F\u8499\u7248")}).on("click",".j_xiu8_follow_btn",function(t){t.preventDefault(),e.requireInstance("frs/widget/forum_card/focus_btn",[{tbs:PageData.user.tbs,uid:PageData.user.user_id}])._dolike(),$.stats.track("\u5173\u6CE8\u6309\u94AE",e.forum_name+"\u5427\u573A\u666F\u8499\u7248"),e.$el.remove()})}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(e){try{this.isOfficial=e.isOfficial,this.tbs=e.tbs,this.uid=e.uid,this.is_forum_fourth_manager=e.is_forum_fourth_manager,this.avatar=e.avatar,this.userForumList=e.userForumList||"",this.forum_name="",e.fr&&"bawu"==e.fr&&(this.forum_name=$.tb.unescapeHTML(e.forum_name));var t=this,a=$("#j_head_focus_btn"),o=null;t.config={},t.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(e.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return t._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var e=PageData.forum_name||PageData.forum.forum_name;e=$.tb.subByte(e,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+e+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{t._undolike(),o.close()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),e}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),e}})}:function(){t._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:95}),e}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:98}),e}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:101}),e}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:104}),e}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:105}),i}},_showAlert:function(e){var t='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+e+"</div>";$.dialog.open(t,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var e=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var t={};1==$.tb.location.getSearchValue("fromadlike")&&$.stats.track("\u95F4\u63A5\u52A0\u5173\u6CE8","\u5206\u53D1\u5173\u6CE8\u5427\u63A8\u8350","","click"),PageData.forum&&(t={fid:PageData.forum.id||PageData.forum.forum_id,fname:e.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},t.fname=$.tb.escapeHTML(t.fname)),$.post(e.config.url.dolike,t,function(t){var a=!1;try{var o=t}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),e.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:e.tbs,uid:e.uid,is_forum_fourth_manager:e.is_forum_fourth_manager,avatar:e.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no},e.userForumList]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else if(1990055===o.no)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var s="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),n="https://passport";$.JsLoadManager.use([n+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(s/6e4),n+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(s/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:$.tb.location.protocol+"/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var r="";r=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",e._showAlert(r)}},"json")},_undolike:function(){var e=this,t=null;PageData.forum&&(t={fid:PageData.forum.forum_id,fname:e.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},t.fname=$.tb.escapeHTML(t.fname)),$.tb.post(e.config.url.undolike,t,function(e){var t=!1;try{var a=e}catch(o){t=!0}if(!t)if(a&&0==a.no)$.tb.location.reload(!0);else if(1990055===a.no)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var i="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),s="https://passport";$.JsLoadManager.use([s+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(i/6e4),s+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(i/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:$.tb.location.protocol+"/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show()})}}});_.Module.define({path:"pplatform/widget/LocalityPopWindow",requires:[],sub:{initial:function(t,o){var i=$.parseJSON(t);i&&(this.pageMap={0:"FRS",1:"PB","0,1":"\u5168\u90E8"},this.windowTypeMap={1:"\u56FE\u7247\u5F39\u7A97","00":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E00","01":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E8C"},this.popWindow=$(".locality_pop_window_wrap"),this.bindEvents(i,o),this.runStrategy(i))},bindEvents:function(t,o){var i=this,a=i.pageMap[t.position],e="1"==t.type?t.type:t.type.toString()+t.subtype.toString();e=i.windowTypeMap[e],$(".locality_pop_window_wrap").on("click",".locality_pop_head_close_btn",function(o){o.preventDefault(),$.stats.track("\u6587\u5B57\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".locality_pop_window_pic_close_btn",function(o){o.preventDefault(),$.stats.track("\u56FE\u7247\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".j_local_pic_pop_window",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".locality_pop_text_img",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".locality_pop_text_title",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".local_pop_window_content",function(){$.stats.track("frs"==o?73:75,t.taskName,a,"click",{popWindowType:e,taskName:t.taskName,tbjump:t.link,obj_id:t.adId})})},runStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);if(!o||0>o)this.resetStrategy(t),this.stepStrategy(t);else{if(0==o)return;this.stepStrategy(t)}this.showPop(t)},resetStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,1)},stepStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);$.cookie("locality_pop_window_"+t.adId,++o)},clearStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,0)},showPop:function(){var t=this,o=setTimeout(function(){t.popWindow.show().css("bottom","-280px").animate({bottom:0},500),clearTimeout(o),o=null},2e3)},hidePop:function(){this.popWindow.animate({bottom:"-280px"},500,function(){$(this).hide()})}}});_.Module.define({path:"common/widget/PlatformSpreadLayer",requires:[],sub:{initial:function(t){this.$platformLayer=$("#platform_left_float"),this.$platformCloseBtn=$("#j_platform_close_btn"),this.$platformClickBtn=$("#j_platform_left_content"),this.shouldShowLayer=$.cookie("platform_float_hide_"+t)?!0:!1,this.opt=t,this.shouldShowLayer||($.stats.track("\u6574\u4F53","\u8D34\u5427\u6D6E\u6807",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:t}),this.$platformLayer.show(),this._bindEvent())},_bindEvent:function(){var t=this,o=t.$platformLayer,a=t.$platformCloseBtn,e=t.$platformClickBtn,i=t.opt;e.on("click",function(){$.stats.track("\u6574\u4F53\u70B9\u51FB","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i})}),a.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i}),o.hide(),$.cookie("platform_float_hide_"+i,1,{expires:999,path:"/"}),!1})}}});_.Module.define({path:"common/widget/pkFixedBubble",sub:{initial:function(){this.$wrap=$("#pk_bubble_w"),this.$close_btn=this.$wrap.find(".close_btn"),this.showBubble(),this.bindEvent()},showBubble:function(){if(1!=$.cookie("pk_bubble_hide")&&document.body.clientWidth>1024){var i=Math.round($(window).height()/2-this.$wrap.outerHeight()/2);this.$wrap.css({top:i}).show()}else this.$wrap.hide()},bindEvent:function(){var i=this;this.$close_btn.click(function(e){e.preventDefault(),i.$wrap.remove(),$.cookie("pk_bubble_hide",1,1)}),$(window).resize(function(){i.showBubble()})}}});_.Module.define({path:"common/widget/PlatformSpreadVideo",requires:[],sub:{ANIMATE_STYLE:{UP:1,DOWN:2},videoHeight:255,ch:document.documentElement.clientHeight||document.body.clientHeight,cw:document.documentElement.clientWidth||document.body.clientWidth,initial:function(t,o){var e=$.cookie("platform_spread_video_"+o),i=$.cookie("platform_video_spread_close_"+o),a=$.cookie("platform_video_spread_autoShow_"+o),n=null!=i,d=null==e&&!parseInt(e),s=$.browser.msie&&6==Number($.browser.version);return this.swfURL=t,this.opt=o,this.$videoWrap=$("#platform_spread_video"),this.$videoTopHeads=this.$videoWrap.find(".platform_video_head"),this.$videoContent=this.$videoWrap.find(".platform_video_content"),this.$upHead=this.$videoTopHeads.eq(0),this.$downHead=this.$videoTopHeads.eq(1),this.$downBtn=this.$upHead.find(".head_down_btn"),this.$upBtn=this.$downHead.find(".head_up_btn"),this.$closeBtns=this.$videoTopHeads.find(".head_close_btn"),this.shouldShowVideo=d,s||n?(this.$videoWrap.hide(),void 0):($.stats.track("\u6574\u4F53","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:o}),d&&null==a?($.cookie("platform_video_spread_autoShow_"+o,1,{expires:999,path:"/"}),this._animateTo(this.ANIMATE_STYLE.UP)):this._animateTo(this.ANIMATE_STYLE.DOWN),this._bindEvent(),void 0)},_animateTo:function(t){var o=this,e=o.$videoWrap,i=o.$videoContent,a=o.$downHead,n=o.$upHead,d=o.opt;t&o.ANIMATE_STYLE.UP?($.stats.track("\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d}),i.show(),e.animate({bottom:0},600,function(){a.hide(),n.show(),setTimeout(function(){$.stats.track("\u6709\u6548\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d})},5e3)}),o._loadSwf()):e.animate({bottom:-1*o.videoHeight},600,function(){i.hide(),n.hide(),a.show()})},_bindEvent:function(){var t=this,o=t.$videoWrap,e=t.$closeBtns,i=t.$upBtn,a=t.$downBtn,n=t.opt;e.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),$.cookie("platform_video_spread_close_"+n,1,{expires:999,path:"/"}),o.hide(),!1}),i.on("click",function(){return t._animateTo(t.ANIMATE_STYLE.UP),!1}),a.on("click",function(){return $.stats.track("\u6536\u8D77\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),t._animateTo(t.ANIMATE_STYLE.DOWN),!1}),a.one("click",function(){return $.cookie("platform_video_spread_"+n,1,{expires:999,path:"/"}),!1})},_loadSwf:function(){{var t=this,o=t.swfURL,e=t.opt;t.$videoContent}new $.swf(o,{id:"platform_video_spread_"+e,container:"#j_platform_video_content",width:340,height:255})}}});var PopWidowHandle=function(t){var o={url:{P_GET:"/app/pop/bws/popup",P_POST:"/app/pop/commit/click"},delay:15,from_forum:"",page:""};this._option=$.extend(!0,o,t),this._init()};PopWidowHandle.prototype={constructor:PopWidowHandle,_init:function(){var t=this;$(document).ready(function(){setTimeout(function(){t._getPopWindow()},1e3*t._option.delay)})},_getPopWindow:function(){var t=this._option,o=this;$.tb.get(t.url.P_GET,{from_forum:$.tb.escapeHTML(t.from_forum),position:t.page},function(t){0==t.no&&t.data.task_id&&o._showPopWindow(t.data)})},_showPopWindow:function(t){this.data=t;var o=this._option,n={styleId:t.style_id,templateObj:{title:t.title,content:t.content,button:t.button,note:t.note,link:t.link}};this.popWindow=new PopWindow(n);var i=this.popWindow;i.bind("closeSuccess",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:1,count:t.count},function(){})},!0),i.bind("clickBtn",function(){$.tb.post(o.url.P_POST,{task_id:t.task_id,type:2,count:t.count},function(){})},!0),i.showPop()}};_.Module.define({path:"common/component/image_flash_editor",sub:{_swfPath:"//tb2.bdstatic.com/tb/static-common/swf/FlashFilterUI_6e543a5.swf",_vars:{configURL:"/tb/static-common/htmlfilter/filterconf.js",reviewURL:"",iconPath:"/tb/static-common/img/image_editor/",uploadURL:"",maxSize:5,maxWidth:3e3,maxHeight:3e3},_events:["upload_complete","compress_complete","upload_error"],_flashInstance:null,initial:function(t,i){i&&$.extend(this._vars,i),this._buildHTML(t.container,t.width,t.height),this._buildFlash(t)},_buildHTML:function(t,i,s){var a=this,e='<div class="image_flash_editor"><div class="flash_editor_container"></div><div class="button_bar"><a href="#" class="ui_btn ui_btn_m j_ok"><span><em>\u786E \u5B9A</em></span></a><a href="#" class="ui_btn ui_btn_sub_m j_cancel"><span><em>\u53D6 \u6D88</em></span></a></div></div>';this.$root=$(e),this.$root.css({width:i,height:s}),this.$root.find(".j_ok").click(function(){return a.startUpload(),!1}),this.$root.find(".j_cancel").click(function(){return a.trigger("cancel"),!1}),$(t).append(this.$root)},_buildFlash:function(t){this._swfOptions=t,this._swfOptions.height=t.height-45,this._swfOptions.container=this.$root.find(".flash_editor_container"),this._swfOptions.vars=this._vars,this._swfOptions.callBacks={},this._generateCallBack(),this._flashInstance=new $.swf(this._swfPath,this._swfOptions)},_generateCallBack:function(){var t=this;for(var i in this._events){var s=this._events[i];this._swfOptions.callBacks[s]=function(i){return function(){var s=Array.prototype.slice.call(arguments,0);s.unshift(i),t.trigger.apply(t,s)}}(s)}},loadRemoteImage:function(t){this._flashInstance.remote("loadRemoteImage",t)},startUpload:function(){this._flashInstance.remote("startUpload")},setUploaderVariables:function(t){this._flashInstance.remote("setUploaderVariables",t)},clearPreview:function(){this._flashInstance.remote("clearPreview")}}});_.Module.define({path:"common/widget/EditorPicMeizhi",requires:["common/widget/EditorPicMeizhi/EditorPicMeizhiUpload"],sub:{tempHTML:['<div id="meizhi_img_layer" class="img_layer_content j_content ui_card_wrap hide"><ul class="mz_ul clearfix"><li class="mz_imgUpload_btn" ><a class="mz_uploader_container" href="#" onclick="return false;" ></a><span class="cut_line"></span></li><li class="mz_album_btn"><a class="mz_btn_myalbum" href="#" onclick="return false;"></a><span class="cut_line"></span></li><li class="mz_camera_btn"><a class="mz_btn_camera" href="#" onclick="return false;" ></a></li></ul><span class="ui_white_down arrow"></span></div>'].join(""),count:0,imageLimite:20,initial:function(){},init:function(i,e){var t=this;t.editor=e,i.before(this.tempHTML),t.j_content=i.siblings(".j_content"),t.picUploader=this.use("common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",t.j_content.find(".mz_uploader_container"),e),t.myAlbumHandler(e),t.myCameraHandler(e),t.addImageArray={}},myAlbumHandler:function(i){var e=this,t=e.j_content.find(".mz_album_btn");t.click(function(){e.editorAlbum?e.editorAlbum.run():(e.editorAlbum=e.use("common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",i),e.editorAlbum.run())})},myCameraHandler:function(i){var e=this,t=e.j_content.find(".mz_camera_btn");t.click(function(){e.editorCamera?e.editorCamera.run():(e.editorCamera=e.use("common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",i),e.editorCamera.run())})},getLimitNum:function(){var i=this,e=i.editor.config.imageLimite||100,t=e-i.editor.getImageNum();return t},showMaxImage:function(){var i=this,e=i.editor.config.imageLimite||100,t=e-i.editor.getImageNum();t=Math.max(0,t),i.j_tip.find(".j_image_num").html(t)}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",requires:["common/widget/ScrollPanel"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{GET_ALBUM_URL:"/photo/interface/alblist",initial:function(e){var l=this;l.editor=e},run:function(){this.selectedPic={},this.albumList={},this.curAlbumId=null,this.myAlbumLayer(),this.getAlbumList()},layerHeight:451,layerWidth:683,selectedPic:{},albumList:{},curAlbumId:null,errorHandler:function(e){var l=this;switch(e){case"noalbum":return $('<div class="album_error">\u4E0A\u4F20\u56FE\u7247\u5230\u767E\u5EA6\u76F8\u518C\uFF0C\u53D1\u8D34\u914D\u56FE\u968F\u9009\u968F\u7528\uFF0C\u65B9\u4FBF\u5FEB\u6377\uFF01<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7ACB\u5373\u4E0A\u4F20</a></div>');case"creatAlbum":return $('<div class="album_error">\u5F00\u901A\u767E\u5EA6\u76F8\u518C\uFF0C\u53EF\u4EE5\u53D1\u8D34\u65F6\u76F4\u63A5\u63D2\u5165\u56FE\u7247\uFF0C\u65B9\u4FBF\u5FEB\u6377~<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7ACB\u5373\u5F00\u901A</a></div>');case"login":return $("<div class=\"album_error\">\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u72B6\u6001\uFF0C\u8BF7\u91CD\u65B0<a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', '']);\">\u767B\u5F55</a></div>");case"systemError":var a=$('<div class="album_error">\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8BF7<a href="#" >\u5237\u65B0</a>\u91CD\u8BD5</div>');return a.find("a").click(function(){l.getAlbumList()}),a;case"noImage":return'<div class="album_error">\u8BE5\u76F8\u518C\u6CA1\u6709\u56FE\u7247\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u76F8\u518C\u8BD5\u8BD5~</div>'}},renderAlbumList:function(e,l){var a=this,t='<div class="l_album_list"><select class="l_album_select" onmousewheel="event.returnValue=false;return false;" >';for(i=0;e>i;i++)album=l[i],t+="<option "+(album==a.curAlbumId?'selected="selected"':"")+' value="'+album.id+'">',t+=album.name+"</option>",a.albumList[album.id]=album.pic_num;var r=a.getImageLimit(a.albumContainer.find(".l_album_selected_con"));t+='</select>\u8FD8\u53EF\u4EE5\u9009\u4E2D<span class="j_image_num" id="album_max">'+r+"</span>\u5F20</div>";var s=$(t);return s.find(".l_album_select").change(function(){a.getPicByUrl($(this).val())}),s},renderAlbumPic:function(e,l){var a=this,i=$('<div class="l_album_pics" ></div>'),t=a.getImgEles(e,1,50);return l.append(i),a.l_album_pics=i,l.click(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){$.browser.msie&&$.browser.version<8?a.l_album_pics.html(t):(a.scrollPanel=a.use("common/widget/ScrollPanel",{container:i,height:350,content:t}),a.rightScrollPanel=a.use("common/widget/ScrollPanel",{container:a.albumContainer.find(".l_album_selected_con"),height:350,content:""})),i.delegate(".j_prepage","click",function(){return a.getPicByUrl(a.curAlbumId,a.cur_page-1),!1}),i.delegate(".j_nextpage","click",function(){return a.getPicByUrl(a.curAlbumId,a.cur_page+1),!1}),i.delegate(".l_album_small_pics","click",function(){return a.selectImage(this),!1}),i.delegate(".l_album_small_pics","mouseenter",function(){return $(this).addClass("l_hover"),!1}),i.delegate(".l_album_small_pics","mouseleave",function(){return $(this).removeClass("l_hover"),!1}),a.reloadImage()}),i},reloadImage:function(){var e=this;this.l_album_pics.find(".l_album_pic").each(function(){var l=$(this),a=l.data("src");l.load(function(){e.resetImg(this,120,120)}).tbattr("src",a)})},addSelected:function(e,l){var a=this,i=$('<a class="i_item_con complete" data-url="'+e+'"><img src="'+l+'"  onload="resizePic_temp(this,84,84)" /></a>');return $.browser.msie&&$.browser.version<8?a.albumContainer.find(".l_album_selected_con").append(i):a.rightScrollPanel.appendContent(i),i},removeSelected:function(){},selectImage:function(e){var l=this;e="IMG"==e.tagName?$(e).parent():$(e);var a=e.tbattr("data-url"),i=e.tbattr("data-surl");if(this.errDom=$(".i_error_tips"),this.errDom.text(""),e.hasClass("selected"))e.removeClass("selected"),l.selectedPic[a].remove(),delete l.selectedPic[a];else{var t=l.getImageLimit(l.albumContainer.find(".l_album_selected_con"));if(0>=t)return;if(a.match("priv.hiphotos.baidu.com"))return this.errDom.text("\u60A8\u7684\u79C1\u6709\u7167\u7247\u65E0\u6CD5\u5728\u8D34\u5B50\u4E2D\u663E\u793A\uFF0C\u8BF7\u4F7F\u7528\u5176\u4ED6\u7167\u7247\u3002"),void 0;e.addClass("selected"),l.selectedPic[a]=l.addSelected(a,i)}l.updateRemianImage(l.albumContainer)},getAlbumList:function(){var e=this;$.get(e.GET_ALBUM_URL,{_t:(new Date).getTime()},function(l){var a=e.albumContainer.find(".l_album_lwrapper");if(l=$.parseJSON(l),"0"==l.no){{var i,t=l.data.defalut_album,r=l.data.album_list,s=r.length,n=t.pic_list;n.length}if(e.curAlbumId=t.id,0==s)i=e.errorHandler("noalbum"),a.html(i);else{a.append(e.renderAlbumList(s,r)),e.renderAlbumPic(n,a)}}else if("4049"==l.no){var i=e.errorHandler("creatAlbum");a.html(i)}else if("265"==l.no){var i=e.errorHandler("login");a.html(i)}else{var i=e.errorHandler("systemError");a.html(i)}})},getPicByUrl:function(e,l){var a=this;a.curAlbumId=e,$.get("/photo/interface/piclist",{album_id:e,pn:l,_t:(new Date).getTime()},function(e){if(e=$.parseJSON(e),0==e.no){var l=e.data;$.browser.msie&&$.browser.version<8?a.l_album_pics.html(a.getImgEles(l.pic_list,l.cur_page,l.page_size)):(a.scrollPanel.setContent(a.getImgEles(l.pic_list,l.cur_page,l.page_size)),a.scrollPanel.scrollTopTo(0)),a.reloadImage()}else a.l_album_pics.html(a.errorHandler("systemError"))})},getImgEles:function(e,l,a){var i,t,r="",s=e.length,a=a||50,n=this;if(n.curPagePicNum=s,n.cur_page=l||1,0==s)r=this.errorHandler("noImage");else{for(r+="<div class='l_album_pics_container'>",i=0;s>i;i++)t=this.selectedPic[e[i].big_pic]?"selected":"",r+='<a href="#" onclick="return false" class="l_album_small_pics '+t+'" data-surl="'+e[i].small_pic+'" data-url="'+e[i].big_pic+'"><span class="l_album_pic_hover"></span><span class="l_album_pic_select" title="\u5DF2\u9009\u4E2D"></span><img class="l_album_pic" data-src="'+e[i].small_pic+'"/></a>';r+="</div>";var c=this.albumList[this.curAlbumId],o=((c-1)/a|0)+1;1!=o&&(r+='<div class="l_album_pic_pager">',1!=l&&(r+='<a href="#"  class="l_album_page j_prepage" >&lt;\u4E0A\u4E00\u9875</a>'),o>l&&(r+='<a href="#"  class="l_album_page j_nextpage" >\u4E0B\u4E00\u9875&gt;</a>'),r+="</div>")}return r},myAlbumLayer:function(){var e=this;if(!e.lDialogOp){var l=$("<div></div>"),a=$('<div class="l_album_container"></div>'),i='<div class="l_album_lwrapper"></div><div class="l_album_rwrapper"><div class="l_album_rwrapper_title">\u5F53\u524D\u9009\u4E2D</div><div class="l_album_selected_con"></div></div>';e.albumContainer=a,a.html(i),l.append(a).append(e.layerBottom("showtips"));var t=e.layerWidth,r={html:l,title:"\u6211\u7684\u76F8\u518C",width:t,height:e.layerHeight,closeable:!0};$.browser.msie&&$.browser.version<7&&l.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"}),e.editor.overlay.hide(),e.lDialogOp=new $.dialog(r),e.lDialogOp.bind("onclose",function(){e.editor.overlay.show(),delete e.lDialogOp}),e.lDialogOp.show()}},submit:function(){var e=this,l=[];for(var a in this.selectedPic)l.push({url:a,pic_id_encode:e.getEncode(a)});this.editor.insertImage(l),this.lDialogOp.close(),this.editor.overlay.show()}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",requires:["common/widget/image_uploader_manager","common/widget/ScrollPanel","common/component/image_flash_editor"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{picItemPath:"https://imgsa.baidu.com/forum/pic/item/",abpicPath:"https://imgsa.baidu.com/forum/abpic/item/",layerHeight:460,layerWidth:680,initial:function(e,i){var t=this;t.editor=i,t.j_con=e,t.uploader=t.localUploader(e),t.addImageArray={},Function.prototype.BINDEVENT=function(e){var i=this;return function(){i.apply(e,arguments)}}},localUploader:function(e){var i=this,t=this.use("common/widget/image_uploader_manager",{container:e,width:e.width(),height:e.height(),queueLen:100,fid:PageData.forum.forum_id||PageData.forum.id,isAutoUp:!1});return t.bind("onFileSelected",function(e,a){for(var o=i.dealWithData(a.imageList),r=o.filterId,n=0,d=r.length;d>n;n++)t.deleteFile(r[n]);var l=i.getImageLimit(i.imageContainer),c=o.imageList.length,s=c-r.length;if(s>l){for(var p=l;c>p;p++)t.deleteFile(o.imageList[p].id);o.imageList=o.imageList.splice(0,l)}t.startUpload(),i.startRender(o.imageList,"upload")}),t.bind("onProgressListen",function(e,t){i.progressHandler(t)}),t.bind("onComplete",function(e,t){i.uploadComplete(t)}),t.bind("onError",function(){}),t},imageHandler:function(e,i){var t=e.id,a=i.filter('[data-id="'+t+'"]'),o=a.find("b"),r=e.response,n=e.percent,d=this;a.hasClass("complete")||(o.css({width:n+"%"}),100==n&&d.renderItem(r,a))},renderItem:function(e,i){var t=this,a=i.find("b");if(null!=e&&0==e.error_code){var o=e.info.pic_id_encode,r=e.info.fullpic_width,n=e.info.fullpic_height,d=e.info.pic_water,l=i.find("img")[0];l.src="/tb/static-common/editor_img/layer/i.gif";if(200>r||200>n)return t.errorBigHandler(i.find("img")),a.parent().hide(),!1;i.removeClass("uploading").addClass("complete"),i.tbattr("data-url",t.picItemPath+o+".jpg"),i.tbattr("href","#"),i.tbattr("data-water-url",d),i.tbattr("data-width",r),i.tbattr("data-height",n),i.tbattr("data-id-encode",o),(new Image).src=t.picItemPath+o+".jpg";var c=new Image;c.onload=function(){l.style.backgroundImage="url("+t.abpicPath+o+".jpg)",a.parent().hide()},c.src=t.abpicPath+o+".jpg",d&&((new Image).src=d)}else t.errorHandler(i.find("img")),a.parent().hide()},errorHandler:function(e){e.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var i=e.parent();i.removeClass("uploading").addClass("i_up_error")},errorBigHandler:function(e){e.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var i=e.parent();i.removeClass("uploading").addClass("i_up_error_big")},addImageArray:{},dealWithData:function(e){for(var i=[],t=[],a=this.addImageArray,o=0,r=e.length;r>o;o++){var n=e[o],d=n.id,l=n.name,c=n.size,s=l+c;a[s]==s?t.push(d):(i.push(n),a[s]=s)}return{imageList:i,filterId:t}},renderContinueUpload:function(){var e=this.getImageLimit(this.imageContainer),i="";0==e&&(i="i_upload_limit");var t='<a class="i_continue_add '+i+'"><div class="i_continue_upbtn"></div><span class="i_image_remain">\u8FD8\u53EF\u4EE5\u6DFB\u52A0<span class="j_image_num">'+e+"</span>\u5F20</span></a>";return t},addDragger:function(){},startRender:function(e){var i=this,t=e;if(i.lDialogOp){if(t.length>0){var a=i.genericImageCon(t,"continue");i.continueUploader.before(a),$.browser.msie&&$.browser.version<8||(i.scrollPanel._resizeHeight(),i.scrollPanel.scrollTopTo(2e4),i.updateRemianImage(i.container,function(){i.continueUploader.addClass("i_upload_limit")},function(){i.continueUploader.removeClass("i_upload_limit")}),i.addDragger())}}else{var o=$('<div class="l_image_container clearfix"></div>');i.imageContainer=o,i.imageContainer.css({width:667});var r=$('<div class="l_image_upcontainer"></div>'),a=i.genericImageCon(t,"first");i.imageContainer.delegate(".close","click",function(){var e=$(this).parent(),t=e.tbattr("data-name"),a=e.tbattr("data-size"),o=e.tbattr("data-id"),r=e.tbattr("data-uptype");"first"==r?i.uploader.deleteFile(o):"continue"==r&&i.conUploader.deleteFile(o),delete i.addImageArray[t+a],e.remove(),i.updateRemianImage(i.container,function(){i.continueUploader.addClass("i_upload_limit")},function(){i.continueUploader.removeClass("i_upload_limit")})}),i._layerBottom=i.layerBottom("upload"),r.append(i.imageContainer).append(i._layerBottom);var n=i.layerWidth,d={html:r,holderClassName:"meizhi_uploader",title:"\u63D2\u5165\u56FE\u7247",width:n,height:i.layerHeight,show:!1,closeable:!0};if(i.editor.overlay.width(1),i.editor.overlay.height(1),i.lDialogOp=new $.dialog(d),i.lDialogOp.bind("onclose",function(){i.uploader&&i.uploader.stopUpload(),i.uploader&&i.uploader.clearList();try{i.conUploader&&i.conUploader.stopUpload(),i.conUploader&&i.conUploader.clearList()}catch(e){}i.destroyJquery(i.imageContainer),window.PicUploaderShow=!1,i.editor.overlay.width(700),i.editor.overlay.height(650),delete i.lDialogOp}),r.closest(".dialogJcontent").css("padding","0"),window.PicUploaderShow=!0,i.uploader.uploader.flash){var l=i.lDialogOp.element;i.lDialogOp.element=i.lDialogOp.element.add(i.uploader.uploader.flash.parentNode),i.lDialogOp.show(),i.lDialogOp.element=l}else i.lDialogOp.show();i.container=r,$.browser.msie&&$.browser.version<8?(i.imageContainer.html(a),i.imageContainer.append(i.renderContinueUpload()),i.continueUploader=i.imageContainer.find(".i_continue_add"),i.addContinueUploader()):$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){i.scrollPanel=i.use("common/widget/ScrollPanel",{container:i.imageContainer,height:388,content:a}),i.scrollPanel.appendContent(i.renderContinueUpload()),i.continueUploader=i.imageContainer.find(".i_continue_add"),i.addDragger(),i.addContinueUploader()}),i.initPictureEditor()}},initPictureEditor:function(){var e=this;e.$pictureEditorContainer=$("<div class='pic_editor_container' id='picture_editor_container'></div>"),e.container.append(e.$pictureEditorContainer),this.pictureEditor=this.use("common/component/image_flash_editor",{container:e.$pictureEditorContainer,width:678,height:461},{uploadURL:"https://uploadphotos.baidu.com/upload/pic?tbs=4f165305af36ccdc013751701760125500_1&fid="+PageData.forum.forum_id||PageData.forum.id}),this.imageContainer.delegate(".j_editor_button","click",function(){var i=$(this).closest(".i_item_con");e.showPictureEditor(i)}),this.pictureEditor.bind("upload_complete",function(i,t){e.hidePictureEditor(),e.renderItem(t,e.pictureEditor.$item)}),this.pictureEditor.bind("cancel",function(){e.hidePictureEditor()})},showPictureEditor:function(e){this.pictureEditorOpen=!0,this.lDialogOp.setTitle("\u56FE\u7247\u7F16\u8F91"),this.pictureEditor.$item=e,this.pictureEditor.loadRemoteImage(e.tbattr("data-url")),this.$pictureEditorContainer.animate({left:-1},500)},hidePictureEditor:function(){this.pictureEditorOpen=!1,this.lDialogOp.setTitle("\u63D2\u5165\u56FE\u7247"),this.$pictureEditorContainer.animate({left:684},500)},addContinueUploader:function(){var e=this;e.conUploader=e.localUploader(e.continueUploader.find(".i_continue_upbtn"))},uploadComplete:function(e){for(var i=this,t=e.imageList,a=i.imageContainer.find(".i_item_con"),o=0,r=t.length;r>o;o++){var n=t[o];i.imageHandler(n,a)}},progressHandler:function(e){for(var i=this,t=e.imageList,a=i.imageContainer.find(".i_item_con"),o=0,r=t.length;r>o;o++){var n=t[o];i.imageHandler(n,a)}},submit:function(){var e=this,i=e._layerBottom.find(".i_checkbox")[0],t=i.checked?"1":"0";$.cookie("WATER_CHECK",t,{expires:30}),e.closeUploadLayer();var a=e.getURLs(t,e.imageContainer,"obj");e.editor.insertImage(a),e.lDialogOp.close(),e.editor.overlay.width(700),e.editor.overlay.height(650),delete e.lDialogOp},closeUploadLayer:function(){this.j_con.closest(".j_content").addClass("hide")}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{id:"mz_camera_flash",layerHeight:460,layerWidth:680,initial:function(i){var e=this;e.editor=i},run:function(){this.cameraPicLayer()},cameraPicLayer:function(){var i=this;if(!i.lDialogOp){var e=$("<div></div>");i.cameraContainer=$('<div class="l_camerapic_container"></div>'),i._layerBottom=i.layerBottom("showtips"),e.append(i.cameraContainer).append(i._layerBottom);var o={html:e,title:"\u6444\u50CF\u5934\u62CD\u7167",width:i.layerWidth,height:i.layerHeight,closeable:!0};i.editor.overlay.hide(),i.lDialogOp=new $.dialog(o),i.scrollOff(),i.lDialogOp.bind("onclose",function(){i.scrollOn(),i.editor.overlay.show(),delete i.lDialogOp}),e.click(function(i){return i.stopPropagation&&i.stopPropagation(),!1}),$.browser.msie&&$.browser.version<7&&e.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"}),i.lDialogOp.show(),i._loadTBS()}},_showErrorTips:function(i){switch(this.errDom||(this.errDom=$(".i_error_tips")),i){case"compressed":this.errDom.text("\u56FE\u7247\u538B\u7F29\u6210\u529F");break;case"already":this.errDom.text("\u6444\u50CF\u5934\u51C6\u5907\u5B8C\u6BD5\uFF0C\u8BF7\u6309\u4E0B\u786E\u5B9A\u62CD\u7167");break;case"not_support":this.errDom.text("\u6444\u50CF\u5934\u672A\u88AB\u5B89\u88C5\u6216\u5F53\u524D\u7CFB\u7EDF\u4E0D\u652F\u6301");break;case"busy":this.errDom.text("\u6444\u50CF\u5934\u5F53\u524D\u6B63\u88AB\u5360\u7528");break;case"error":this.errDom.text("\u51FA\u73B0\u5185\u90E8\u9519\u8BEF")}},_loadTBS:function(){var i=this;uploadURL="https://uploadphotos.baidu.com/upload/pic",tbsURL="//tieba.baidu.com/dc/common/imgtbs",img_tbs=$.ajax({url:tbsURL,dataType:"json"}),img_tbs.done(function(e){0===Number(e.no)?(uploadURL+="?tbs="+e.data.tbs,i._loadCameraFlash(uploadURL)):alert("tbs error")})},_loadCameraFlash:function(i){var e=this,o={id:e.id,container:".l_camerapic_container",width:660,height:414,params:{wmode:"window"},vars:{imageWidth:800,imageHeight:600,maxSize:3,maxWidth:3e3,maxHeight:3e3,uploadURL:i},callBacks:{completeInterface:function(i){var o=[];o.push({pic_id_encode:e.getEncode(i.info.pic_water),url:i.info.pic_water}),e.editor.insertImage(o),e.lDialogOp.close(),e.scrollOn(),e.editor.overlay.show()},compressInterface:function(){e._showErrorTips("compressed")},errorInterface:function(){e._showErrorTips("error")},cameraStatus:function(i){switch(i){case"ready":e._showErrorTips("already");break;case"not_support":e._showErrorTips("not_support");break;case"busy":e._showErrorTips("busy")}}}};new $.swf("/tb/static-common/editor_img/FlashCameraPrinter.swf?dt=0724",o),this.flash=document[this.id]||window[this.id]},submit:function(){this.flash.print(),this.flash.startUpload()}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",requires:[],sub:{layerHeight:515,layerWidth:810,initial:function(){},genericImageCon:function(t,e){for(var a="",i=0,n=t.length;n>i;i++){var r=t[i].id;a+='<a href="" unselectable="on" onclick = "return false;" class="uploading i_item_con"  data-name="'+t[i].name+'" data-uptype="'+e+'" data-size="'+t[i].size+'" data-id="'+r+'" draggable="false"><img class="i_item_bg" src="/tb/static-common/editor_img/layer/unload.png"><span class="progress"><b></b></span><span class="close" title="\u5220\u9664\u6B64\u56FE"></span><span class="button_bar"><span class="j_editor_button edit_button">\u7F8E\u5316\u56FE\u7247</span></span><span class="error">\u4E0A\u4F20\u5931\u8D25</span><span class="error_big">\u56FE\u7247\u8FC7\u5C0F</span><span class ="error_big_more">\u8BF7\u4E0A\u4F20\u5927\u56FE</span></a>'}return a},destroyJquery:function(t){t.remove(),t=null},imageHandler:function(){},checkURL:function(t){if(t=t.trim(),t.length<=0)return!1;0!==t.search(/http:\/\/|https:\/\//)&&(t+="http://");var e=/(.gif|.jpg|.jpeg|.png)$/i;return!e.test(t)||t.getByteLength()>this.urlLength?!1:t},layerBottom:function(t){var e="",a=this,i="upload"==t?"\u63D2\u5165\u56FE\u7247":"\u786E \u5B9A",n=$('<div class="i_layer_bottom"></div>'),r=$('<a href="#" style="float:left;margin-right:10px;" class="ui_btn ui_btn_m"><span><em>'+i+"</em></span></a>"),s=$(' <a href="#" style="float:left" class="ui_btn ui_btn_sub_m"><span><em>\u53D6 \u6D88</em></span></a>'),l=$('<div class="i_layer_btn"></div>');return l.append(r).append(s),n.append(l),"upload"==t?(e='<div class="i_layer_water"><input class="i_checkbox" checked type="checkbox" /><span style="float:left;">\u6DFB\u52A0\u672C\u5427\u6C34\u5370(gif\u683C\u5F0F\u6216\u8FC7\u5C0F\u7684\u56FE\u7247\u65E0\u6CD5\u6DFB\u52A0)</span></div>',n.append(e)):"showtips"==t&&(e='<div class="i_error_tips"></div>',n.append(e)),n.width(this.layerWidth-2),$.browser.msie&&$.browser.version<7&&n.css({bottom:6}),r.click(function(){return a.submit(),!1}),s.click(function(e){try{a.lDialogOp.close()}catch(e){alert(e.message)}return"upload"==t&&a.closeUploadLayer(),!1}),n},getURLs:function(t,e,a){for(var i,n=[],r=e.find(".i_item_con"),s=0;s<r.length;s++)if(i=r.eq(s),"obj"==a){var l={};i.hasClass("complete")&&i.tbattr("data-url")&&(l.url="1"==t&&""!=i.tbattr("data-water-url")&&"undefined"!=i.tbattr("data-water-url")?i.tbattr("data-water-url"):i.tbattr("data-url"),l.width=i.tbattr("data-width")||0,l.height=i.tbattr("data-height")||0,l.pic_id_encode=i.tbattr("data-id-encode")||0,n.push(l))}else i.hasClass("complete")&&i.tbattr("data-url")&&("1"==t&&""!=i.tbattr("data-water-url")&&"undefined"!=i.tbattr("data-water-url")?n.push(i.tbattr("data-water-url")):n.push(i.tbattr("data-url")));return n},remainImage:function(t,e){var a=this,i=a.getImageLimit(e),n='\u8FD8\u53EF\u4EE5\u6DFB\u52A0<span class="j_image_num">'+i+"</span>\u5F20\u56FE\u7247",r=$('<div class="i_image_tip"></div>');return"upload"==t?(n+=',<span class="i_image_continue">\u7EE7\u7EED\u6DFB\u52A0:</span><span style="color:#1D53BF">\u672C\u5730\u4E0A\u4F20</span><div class="i_uploader_con" ></div>',r.html(n),a.conUploader=a.localUploader(r.find(".i_uploader_con"))):r.html(n),a.jCon=r,a.jCon},resetImg:function(t,e,a){var i,n=t.width,r=t.height,s=0,l=0;n>e||r>a?(i=n>=r?e/n:e/r,l=(e-n*i)/2,s=(a-r*i)/2,$(t).css({height:r*i,width:n*i,top:s,left:l,visibility:"visible"})):(l=(e-n)/2,s=(a-r)/2,$(t).css({top:s,left:l,visibility:"visible"}))},updateRemianImage:function(t,e,a){var i=this,n=i.getImageLimit(t);t.find(".j_image_num").html(n),0==n?e&&e():a&&a()},getImageLimit:function(t){var e=this,a=e.getImageNum(t),i=e.editor.getImageNum()-a;return i=Math.max(0,i)},onStartDrag:function(t,e){var a=e.holder;a.style.left=a.offsetLeft+"px",a.style.top=a.offsetTop+"px",e.holder.style.position="absolute",a.parentNode.insertBefore(this.placeHolder,a),a.parentNode.appendChild(a),this.currentIndex=parseInt(a.offsetLeft/this.width),this.currentIndex=Math.min(this.currentIndex,this.index-1)},onDragging:function(t,e){var a=e.left,i=Math.min(parseInt(a/this.width),this.index-1);i!==this.currentIndex&&(this.swapNode(this.list[i],this.list[this.currentIndex]),this.currentIndex=i)},onStopDrag:function(t,e){e.holder.style.position="relative",e.holder.style.left="0",e.holder.style.top="0",this.swapNode(e.holder,this.placeHolder),this.placeHolder.parentNode.removeChild(this.placeHolder)},swapNode:function(t,e){var a=t.parentNode,i=e.parentNode,n=t.cloneNode(!1);a.replaceChild(n,t),i.replaceChild(t,e),a.replaceChild(e,n)},getImageNum:function(t){var e=0;return e=t&&t.find(".i_item_con").size()||e},getEncode:function(t){var e=t.split("/"),a=e[e.length-1];return a.slice(0,a.indexOf("."))},scrollOn:function(){document.body.parentNode.style.overflow="scroll"},scrollOff:function(){document.body.parentNode.style.overflow="hidden"}}});_.Module.define({path:"postor/widget/MeizhiPostor",requires:["common/widget/LoginDialog","common/widget/EditorPicMeizhi","common/widget/PostService"],sub:{containerHTML:["<div>",'<div id="mz_post_wrapper">','<div class="mz_post_achieve clearfix">','<div class="mz_post_achieve_inner">','<p class="mz_post_achieve_title">\u7ECF\u8FC7\u8BC4\u5BA1\u8BA4\u8BC1\u540E\u83B7\u5F97\uFF1A</p>','<ul class="mz_post_achieve_list">',"<li>",'<img src="//tb1.bdstatic.com/tb/cms/tbmall/guessing/80/h1230014.png" width="75" height="75" />',"<p>\u5B9E\u4E60\u59B9\u7EB8</p>","</li>","<li>",'<img src="//tb1.bdstatic.com/tb/cms/tbmall/guessing/80/h1230013.png" width="75" height="75" />',"<p>\u8BA4\u8BC1\u59B9\u7EB8</p>","</li>","</ul>","</div>","#{meizi_notice}","</div>",'<div id="#{meizhi_tip}" class="meizhi_tip">\u6E29\u99A8\u63D0\u793A\uFF1A\u7533\u8BF7\u524D\u8BF7\u8BA4\u771F\u9605\u8BFB<a href="/tb/zt/meizituan.html" target="_blank">\u59B9\u5B50\u56E2\u5B88\u5219\u53CA\u89C4\u7AE0\u5236\u5EA6</a>\u3002<a class="tip_close" onclick="return false;" href="#"></a></div>','<form id="#{meizhi_post}"  method="post"  autocomplete="off">','<table  width="100%" border="0" cellspacing="0" cellpadding="3">','<tr id="#{title_tr}"> <td class = "label_wrapper" valign="top"  nowrap style="line-height:32px;">\u6807\u9898:</td> <td colspan="3"> <div id = "#{title_div}" class="input_wrapper"><span class ="input_prefix">\u3010\u59B9\u5B50\u56E2\u7533\u8BF7\u3011</span> <input type="text" id="#{title}" class="title_input" name="title" value="" autocomplete="off"  /> </div> <div id="#{titleError}" class="postErrorTitle"></div> </td> </tr>','<tr style="line-height:32px;"> <td class = "label_wrapper" valign="top"  nowrap >\u6700\u559C\u7231\u7684\u6E38\u620F:</td> <td><input id="#{nick_ipt}" class="ui_textfield item_input" type="text" /></td> <td class = "label_wrapper" valign="top"  nowrap >\u6700\u559C\u7231\u7684\u8D34\u5427:</td> <td><input id="#{like_forum_ipt}" type="text" class="ui_textfield item_input" /></td> </tr>','<tr id="#{content_tr}"> <td class = "label_wrapper" valign="top"  nowrap >\u7533\u8BF7\u7559\u8A00:</td> <td colspan="3"> <textarea class="content_input"></textarea> <div id="#{contentError}" class="postErrorContent"></div> </td> </tr>','<tr id="pic_tr"> <td class = "label_wrapper" valign="top"  nowrap >\u7167\u7247:</td> <td colspan="3"> <div id="#{pic_wrapper}" class="pic_wrapper clearfix"> <div id="#{pic_editor}" class="pic_add"> <div class="pic_remain_back"> <div class="pic_remain">\u8FD8\u53EF\u6DFB\u52A0<span class="pic_remain_num">30</span>\u5F20</div></div></div></div><p class="pic_remain_tips">\u6CE8\uFF1A\u81F3\u5C11\u4E0A\u4F203\u5F20\u7167\u7247\u5594</p><p class="pic_remain_like_forum"><input id="meizi_ysjg_like" name="meizi_ysjg_like" type="checkbox" disabled checked /><label for="meizi_ysjg_like">\u5173\u6CE8\u82F1\u4E09\u5609\u54E5\u5427</label></p></td></tr>','<tr id="#{submit_tr}"><td>&nbsp;</td><td class="submit"> <input type="submit" id="#{submit}" alog-alias="richpostor" class="subbtn_bg" value=" \u53D1 \u8868 "/> <span class="pt_posting_status j_posting_status"></span><span id="#{postError}" class="post_error"></span> </td> </tr>',"</tbody> </table> </form></div>","</div>"].join(""),noticeHTML:['<div class="mz_post_notice">',"<h3>\u59B9\u7EB8\u8BA4\u8BC1\u7528\u6237\u4E13\u4EAB</h3>",'<div class="mz_post_notice_inner">','<p class="mz_rewards">\u60A8\u662FLV#{level}\u59B9\u7EB8\u8BA4\u8BC1</p>','<p class="mz_rewards">\u52A0\u5165\u7ACB\u5373\u83B7\u5F97<span class="red_text">#{reward}</span> T\u8C46</p>',"</div>",'<p class="mz_rewards_tips">\u52A0\u5165\u5E76\u8BA4\u8BC1\u6210\u529F\u540E\u59B9\u7EB8\u56FE\u6807\u5C06\u88AB\u65B0\u56FE\u6807\u66FF\u6362</p>',"</div>"].join(""),successHTML:['<div class="mz_post_success">','<p class="success_title">\u52A0\u5165\u7533\u8BF7\u6210\u529F\uFF01</p>',"#{reward_tip}",'<p class="success_relocation">\u8BA4\u8BC1\u7ED3\u679C\u8BF7\u5B9E\u65F6\u5173\u6CE8\u8BBA\u575B\u516C\u544A</p>','<div style="text-align: center; margin-top: 40px">','<a href="#" class="ui_btn ui_btn_m j_mz_iknown">',"<span><em>\u77E5\u9053\u4E86</em></span>","</a>","</div>","</div>"].join(""),rewardTipHTML:['<p class="success_mz_rewards">\u60A8\u662F\u59B9\u7EB8LV#{level} \u83B7\u5F97<span class="red_text">#{reward}</span> T\u8C46</p>'].join(""),config:{imageLimite:30},_likeForumUrl:"/f/like/commit/add",rewardMap:{2:{reward:"200",level:"1"},3:{reward:"2000",level:"2"},4:{reward:"1W",level:"3"}},initial:function(){this._data_postor={},this._option={forum:PageData.forum,tbs:PageData.tbs,user:PageData.user},this._event={};var t=this.containerHTML,i="",e=this._option.user.meizhi_level;e>1&&(i=$.tb.format(this.noticeHTML,{level:this.rewardMap[e].level,reward:this.rewardMap[e].reward})),this._generi_dom_id(),t=$.tb.format(t,$.extend(this._dom_id,{meizi_notice:i})),this.container=$(t);var s=this._option.user.is_login;this._statInit(s),this._initPostService()},_statInit:function(t){return t?(this._canPost(),void 0):(this._cannotPost(),void 0)},_cannotPost:function(){this.use("common/widget/LoginDialog","","userBar")},_canPost:function(){this._dialogInit(),this._initTitleAndContent(),this._editorInitPic(this.picWrapper),this._postBtnInit(),this._hasTip()},_dialogInit:function(){var t={html:this.container.html(),title:"\u7533\u8BF7\u52A0\u5165\u8D34\u5427\u59B9\u5B50\u56E2",width:700,height:650};this.overlay=new $.dialog(t),this.title=$("#"+this._dom_id.title_div).find(".title_input"),this.content=$("#"+this._dom_id.content_tr).find(".content_input"),this.nick=$("#"+this._dom_id.nick_ipt),this.likeForums=$("#"+this._dom_id.like_forum_ipt),this.picEditor=$("#"+this._dom_id.pic_editor),this.picWrapper=$("#"+this._dom_id.pic_wrapper),this.submit_tr=$("#"+this._dom_id.submit_tr),this._likeInit()},_pic_wrapper_toggle:function(){var t=this,i=$("#meizhi_img_layer"),e=this.picEditor.find(".pic_remain_back");e.bind("click",function(){0!=t.getImageNum()?i.hasClass("hide")?(i.removeClass("hide"),$(document).one("click",function(){i.addClass("hide")})):i.addClass("hide"):i.addClass("hide")}),e.bind("click",function(t){t.stopPropagation()})},_initTitleAndContent:function(){var t="\u7231\u6E38\u620F\uFF0C\u7231\u8D34\u5427\u7684\u59B9\u5B50\u7533\u8BF7\u5165\u56E2",i="\u4F8B\u5982\uFF1A\u8D34\u5427\u7BA1\u7406\u3001\u70ED\u7231\u7206\u7167\u5206\u4EAB\u3001\u6587\u5B57\u7F16\u8F91\u3001PS\u56FE\u7247\u8BBE\u8BA1\u3001\u89C6\u9891\u76F4\u64AD\u3001\u5531\u6B4C\u3001\u8DF3\u821E\u3001\u624B\u7ED8\u6F2B\u753B\u7B49\u7279\u957F\u90FD\u53EF";_.Module.use("common/widget/Placeholder",[this.title,t,{left:95,"font-size":14}],function(){}),_.Module.use("common/widget/Placeholder",[this.content,i,{"font-size":14,"max-width":"545px"}],function(){})},_likeInit:function(){var t=this.sel=$("#"+this._dom_id.like_tr).find("select"),i=this._option.forum.name;t.append('<option value="'+i+'">'+i+"</option>"),t.tbattr("disabled","disabled")},_editorInitPic:function(t){return this.imageLayer?this.imageLayer.init(t,this):(this.imageLayer=this.use("common/widget/EditorPicMeizhi"),this.imageLayer.init(t,this)),this._pic_wrapper_toggle(),this._picBoxEvents(),!1},_postBtnInit:function(){var t=this,i=this._dom_id,e=$("#"+i.submit);e.tbattr("disabled",!1),e.className="subbtn_bg",t._postBtnEvent()},_postBtnEvent:function(){var t=this,i=this._dom_id,e=$("#"+i.submit),s=$("#"+i.meizhi_post);e.hasClass("bubbtn_bg_banned")||(e.mouseover(function(){$(this).tbattr("class","subbtn_bg_hover")}),e.mouseout(function(){$(this).tbattr("class","subbtn_bg")}),e.mousedown(function(){$(this).tbattr("class","subbtn_bg_active")})),s.submit(function(){return t._submit(),!1}),s.keydown(function(t){var i=t||window.event;(i.ctrlKey&&13==i.keyCode||i.altKey&&83==i.keyCode)&&(i.preventDefault?i.preventDefault():i.returnValue=!1)})},_generi_dom_id:function(){var t=(new Date).valueOf();this._dom_id={meizhi_tip:"mt"+t,meizhi_post:"mp"+t,title_tr:"tt"+t,title_div:"td"+t,titleError:"te"+t,content_tr:"ct"+t,contentError:"ce"+t,pic_wrapper:"pw"+t,pic_editor:"pe"+t,like_tr:"lt"+t,vcode_tr:"vt"+t,vcode_div:"vd"+t,submit_tr:"st"+t,submit:"sm"+t,postError:"pr"+t,nick_ipt:"ni"+t,like_forum_ipt:"lfi_"+t}},getImageNum:function(){return this.config.imageLimite-this.picWrapper.find(".pic_box").length},insertImage:function(t){for(var i=this,e=0,s=t.length;s>e;e++){var r=$('<div class = "pic_box" ><div class = "pic_box_close"><a href="#" onclick="return false"></a></div><img unselectable="on" style="display:none;" data-id = "'+t[e].pic_id_encode+'" class="tmp_image" src="'+t[e].url+'"/></div>');r.insertAfter(this.picEditor).find("img").one("load",function(){i.resizePicSize($(this)),i.cutPic($(this),100),$(this).show(),i._resizePos()})}},resizePicSize:function(t){var i=560,e=t.width(),s=t.height();if(e>560){var r=i/e;e=560,s*=r}t.tbattr({width:e,height:Math.floor(s)})},cutPic:function(t,i){var e=t.width(),s=t.height();if(e>s&&s>=i){e=e/s*i,s=i;var r=Math.round((e-s)/2),a=Math.round(e-s-r);t.css({width:e,height:s,marginLeft:-1*r,marginRight:-1*a})}else s>e&&e>=i&&(s=s/e*i,e=i,t.css({width:e,height:s}))},_resizePos:function(){var t=$("#"+this._dom_id.pic_wrapper+">div");t.each(function(t){this.className=$(this).hasClass("pic_add")?"pic_add":"pic_box",(t+1)%5==0&&$(this).addClass("right_end"),t>4&&$(this).addClass("bottom_end")}),this.picWrapper.find(".pic_remain_num").text(this.getImageNum())},_picBoxEvents:function(){var t=this;this.picWrapper.find(".pic_box").live("mouseenter",function(){$(this).find(".pic_box_close").show()}).live("mouseleave",function(){$(this).find(".pic_box_close").hide()}),this.picWrapper.find(".pic_box_close").live("click",function(){$(this).parent(".pic_box").remove(),t._resizePos()})},successDialog:function(t){var i=this,e="",s=this._option.user.meizhi_level;s>1&&t&&(e=$.tb.format(i.rewardTipHTML,{level:i.rewardMap[s].level,reward:i.rewardMap[s].reward}));var r=$.tb.format(i.successHTML,{reward_tip:e}),a={html:r,width:700,height:280,title:"\u53D1\u8D77\u59B9\u5B50\u56E2\u7533\u8BF7\u8D34"};this.overlay&&this.overlay.close(),this.overlay=new $.dialog(a),this.overlay.element.find(".j_mz_iknown").on("click",function(){$.tb.location.reload(),i.overlay.close()})},_hasTip:function(){var t="1"==$.cookie("meizhiTipIsClosed"),i=$("#"+this._dom_id.meizhi_tip),e=i.find(".tip_close");t&&i.hide(),e.click(function(t){$.cookie("meizhiTipIsClosed","1",{empires:365,path:"/"}),i.hide(),t.stopPropagation()})},bind:function(t,i,e){var s={stat:e?!0:!1,fun:i};this._event[t]?this._event[t].push(s):(this._event[t]=[],this._event[t].push(s))},triggerEvent:function(t){var i=Array.prototype.slice.call(arguments,0);if(i.shift(),this._event[t])for(var e=this._event[t],s=0;s<e.length;s++)if(e[s].fun&&e[s].fun.apply(this,i),!e[s].stat)return!1;return!0},setPostorData:function(t,i){var e=this._data_postor;e[t]=i},getPostorData:function(t){var i=this._data_postor;return i[t]},removePostorData:function(t){var i=this._data_postor;delete i[t]},setPostingStatus:function(t){var i=this.submit_tr.find(".j_posting_status");t?i.addClass("pt_posting_loading"):i.removeClass("pt_posting_loading")},_getData:function(){var t=this._data_postor,i=(this._dom_id,this._option,this.picWrapper.find(".tmp_image")),e="";i.each(function(){var t=$(this),i=t.tbattr("data-id");v_url=t.tbattr("src"),i&&(e+="[img pic_type=2 width="+t.tbattr("width")+" height="+t.tbattr("height")+"]"+v_url+"[/img][br]")}),t.title="\u3010\u59B9\u5B50\u56E2\u7533\u8BF7\u3011"+this.title.val();var s="";return s+="\u6700\u559C\u7231\u7684\u6E38\u620F\uFF1A"+this.nick.val()+"[br]",s+="\u6700\u559C\u7231\u7684\u8D34\u5427\uFF1A"+this.likeForums.val()+"[br]",s+="\u4E2A\u4EBA\u7279\u957F\u53CA\u7533\u8BF7\u7559\u8A00\uFF1A"+this.content.val()+"[br]",s+=e,t.content=s,t},_validator:function(){return this._validFrsPostTitle()?this._validLikeForumsContent()?this._validNicksContent()?this._validRichEditorContent()?this._validPicEditor()?!0:!1:!1:!1:!1:!1},_validFrsPostTitle:function(){var t=this.title,i=t.val().trim();if(""==i)return this._errorTipShow("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),t.focus(),!1;var e=i.getByteLength(),s=60;if(e>s){var r="\u62B1\u6B49\uFF0C\u60A8\u7684\u6807\u9898\u8D85\u8FC7"+s/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u540E\u518D\u63D0\u4EA4";return this._errorTipShow(r),t.focus(),!1}return!0},_validRichEditorContent:function(){var t=(this._dom_id,this.content),i=this.content.val(),e=this;if(""==i.trim()||""==i.replace(/<[^>]*>|(&nbsp;)|[\s\u3000]*/g,""))return this._errorTipShow("\u53D1\u8D34\u5185\u5BB9\u9700\u5305\u542B\u6587\u5B57"),t.focus(),!1;var s=i.getByteLength(),r=1e4;if(s>r){var a="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8D85\u8FC7"+r/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u518D\u63D0\u4EA4";return e._errorTipShow(a),!1}return!0},_validPicEditor:function(){var t=this.picWrapper.find(".pic_box").length;return 3>t?(this._errorTipShow("\u8BF7\u9009\u62E9\u81F3\u5C11\u4E09\u5F20\u7167\u7247"),!1):!0},_validLikeForumsContent:function(){var t=this.likeForums;return 0==$.trim(t.val()).length?(this._errorTipShow("\u8BF7\u8F93\u5165\u6700\u559C\u7231\u7684\u8D34\u5427"),!1):!0},_validNicksContent:function(){var t=this.nick;return 0==$.trim(t.val()).length?(this._errorTipShow("\u8BF7\u8F93\u5165\u6700\u559C\u7231\u7684\u6E38\u620F"),!1):!0},_errorTipShow:function(t){var i=(this._dom_id,$("#"+this._dom_id.postError));i.css("display",""),i.get(0).innerHTML=t},_errorTipHide:function(){var t=$("#"+this._dom_id.postError);t.css("display","none")},_submit:function(){var t=this;if(this._validator()&&!this.postService.isPosting()){this.setPostingStatus(!0);var i=$("#"+this._dom_id.submit);i.tbattr("disabled",!0),i.removeClass("subbtn_bg").addClass("subbtn_bg_banned"),this.postService.post("thread",t._getData(),PosterContext.getContext())}},_likeForum:function(){var t=PageData.tbs,i=PageData.forum.forum_id,e=PageData.forum.forum_name;$.tb.post(this._likeForumUrl,{fid:i,fname:e,tbs:t})},_initPostService:function(){var t=this;this.postService=this.use("common/widget/PostService"),this.postService.success(function(){var i=t._option.user.meizhi_level;i>1?$.tb.post("/encourage/post/meizhi/addtdou",{tbs:PageData.tbs},function(i){0==i.no?t.successDialog(!0):t.successDialog()}):t.successDialog(),t._likeForum()}).complete(function(){var i=$("#"+t._dom_id.submit);i.tbattr("disabled",!1),i.removeClass("subbtn_bg_banned").addClass("subbtn_bg"),t.setPostingStatus(!1)})}}});_.Module.define({path:"frs/widget/frs_stamp_notice",sub:{initial:function(){try{{var t=PageData.forum.forum_id;$.cookie("fudai_"+t),$.cookie("bless_post_"+t)}}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/frs_stamp_notice/frs_stamp_notice.js",method:"",ln:8}),e}},trackFlower:function(){$.stats.track("stamp_flower_show","fudai","frs/pb","click")}}});_.Module.define({path:"common/component/PostorService",requires:[],sub:{_dataPostor:{ie:"utf-8",kw:"",fid:"",tid:"",vcode_md5:"",floor_num:"",quote_id:"",rich_text:1,tbs:"",content:"\u5185\u5BB9"},_isPosting:!1,_postorUrl:{thread:"/f/commit/thread/add",reply:"/f/commit/post/add"},initial:function(){},isCanPost:function(t){var e={login:!1,canPost:0,noUn:!1,isBlock:!1,forbidFlag:0},a=$.extend(!0,e,t);if(!a.login)return{canPost:!1,type:"login"};if(a.login&&1==a.canPost&&a.noUn)return{canPost:!1,type:"noUn"};if(a.login&&1!=a.canPost){var i=parseInt(a.forbidFlag),o="";switch(i){case 1:o="login";break;case 2:o="old";break;case 3:o="balv";break;case 4:o="bawu";break;case 5:o="law"}return""!=o||a.isBlock||(o="isBlock"),{canPos:!1,type:o}}return a.login&&1==a.canPost&&!a.noUn?{canPost:!0}:void 0},genericRich:function(t){switch(t.type){case"smiley":var e=t.height,a=t.width;return'<img pic_type="" class="BDE_Smiley" src="'+t.src+'" height="'+e+'" width="'+a+'">';case"configSmile":var e=t.height,a=t.width;return'<img pic_type="" class="BDE_Smiley2" src="'+t.src+'" height="'+e+'" width="'+a+'" text="'+t.text+'">'}},postHandler:function(t){var e=this;if(!this._isPosting){this._isPosting=!0;var a=t.url;t.url||(a=this._postorUrl[t.type]),t.data.new_vcode=1,t.data.tag=11,this.post(a,t.data,function(a){e.showAddResult(a,t.success,t.error,t.context,t)})}},captchaHandler:function(t,e){var a=this;_.Module.use("common/component/CaptchaDialog",{message:t.data.vcode.str_reason,vCode:t.data.vcode.captcha_vcode_str,vCodeType:t.data.vcode.captcha_code_type,forumName:e.data.kw,forumId:e.data.fid,isAnonymous:e.data.anonymous,postType:e.type,paramsCallback:function(){var t=e.data,a={content:t.content,title:t.title};return"reply"==e.type&&(a.tid=PageData.thread.id),a}},function(t){a.captchaDialog=t,t.bind("onclose",function(){return t.hide(),e.captchaCloseCallback&&e.captchaCloseCallback(),!1}),t.bind("onaccept",function(){var i=e.data;i.vcode=t.getInputValue(),i.vcode_md5=t.getVCode(),a.postHandler(e)}),t.show()})},_showErrorTip:function(t,e){var a='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "\u5B8B\u4F53";"><table style="width:90%"><tbody><tr><td width="60">'+t.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "\u9ED1\u4F53";">'+t.subMessage+"</td></tr></tbody></table>"+t.message+"</div>",i=$.dialog.alert(a,t.dialogSet);i.bind("onclose",e)},showAddResult:function(t,e,a,i,o){Thread_add_result.init(t);var s=Thread_add_result.resultNo,n=this;if(0==s)e(t.data,i),n._isPosting=!1;else{var r=Thread_add_result.getMessage();if(Thread_add_result.isNeedWaitForCheck()){var d={image:'<img style="border:none;" src="//tb2.bdstatic.com/tb/img/messageFace.gif">',subMessage:"\u7B49\u5F85\u5BA1\u6838...",message:r,dialogSet:{width:380,height:105,title:"\u53D1\u8868\u8D34\u5B50"}};return n._showErrorTip(d,function(){return n.trigger("onCheckError"),!0}),void(n._isPosting=!1)}if(Thread_add_result.isNeedBindPhone())return;if(40==s)n.captchaHandler(t,o),n._isPosting=!1;else{var d={image:'<img style="border:none;" src="//tb2.bdstatic.com/tb/img/errorFace.gif">',subMessage:"\u53D1\u8D34\u5931\u8D25",message:r,dialogSet:{width:410,height:95,title:"\u53D1\u8868\u8D34\u5B50"}};n._showErrorTip(d,function(){return n.trigger("onError",[r,s]),!0}),n._isPosting=!1}}},post:function(t,e,a){$.ajax({type:"post",async:!0,dataType:"json",url:t,data:e,success:function(t){a&&a(t)}})}}});_.Module.define({path:"common/component/image_water/water_flash",requires:[],sub:{initial:function(e){this.options=e,this.imageUrl=e.imageUrl,this.uploadUrl=e.uploadUrl,this.text=e.text||{},this.font=e.font||{},this.EVENTS=["onProgressListen","onComplete","onError"],this.token=+new Date},start:function(){this.initFlashvars(),this.generateCallBack(),this.initUI()},initFlashvars:function(){{var e=this.text,a=this.font;this.imageUrl}this.flashVars=["imageUrl="+encodeURIComponent(this.imageUrl),"uploadURL="+encodeURIComponent(this.uploadUrl),"content="+encodeURIComponent(e.content),"x="+encodeURIComponent(e.x),"y="+encodeURIComponent(e.y),"width="+encodeURIComponent(e.width),"lineHeight="+encodeURIComponent(a.lineHeight||""),"color="+encodeURIComponent(a.color||""),"family="+encodeURIComponent(a.family||""),"size="+encodeURIComponent(a.size||"")].join("&")},initUI:function(){var e=this.flashChecker(),a="flashImageWater"+this.token,t=$("<div>").appendTo(document.body).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:1,bottom:1});e.hasFlash||this.flashError();var n='<object id="'+a+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+this.options.flashUrl+'" /></object>',o='<object id="'+a+'" type="application/x-shockwave-flash" data="'+this.options.flashUrl+'" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /></object>';t.html(-1!=navigator.appName.indexOf("Microsoft")?n:o),this.imageWater=document[a]||window[a]},generateCallBack:function(){for(var e=this.token,a=this,t=0;t<this.EVENTS.length;t++){var n=this.EVENTS[t],o=n+e;window[o]=function(e){return function(t){a.trigger(e,t)}}(n),this.flashVars+="&"+this.decodeCamel(n)+"="+o}},decodeCamel:function(e){return e.replace(/([A-Z])/g,function(e,a){return"_"+a.toLowerCase()})},flashChecker:function(){var e,a=!1,t=0;if(t){var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");n&&(a=!0,e=n.GetVariable("$version"))}else if(navigator.plugins&&navigator.plugins.length>0){var n=navigator.plugins["Shockwave Flash"];n&&(a=!0,e=n.description)}e.split(",");return{hasFlash:a,version:e.match(/\d+/g)}},flashError:function(){$.dialog.alert('\u68C0\u6D4B\u5230\u60A8\u7684\u6D4F\u89C8\u5668\u6CA1\u6709\u5B89\u88C5\u6700\u65B0Adobe Flash Player\u63D2\u4EF6\uFF0C\u8FD9\u4F1A\u5F71\u54CD\u60A8\u8BBF\u95EE\u672C\u9875\u9762\u7684\u90E8\u5206\u529F\u80FD\u3002<br /><center>\u8BF7<a href="http://get.adobe.com/cn/flashplayer/" target="_blank">\u70B9\u6B64</a>\u5B89\u88C5</center>')},merge:function(){this.start()}}});
;_.Module.define({path:"common/component/image_water/water_html5",requires:["common/component/image_uploader"],sub:{initial:function(e){this.options=e,this.imageUrl=e.imageUrl,this._percent=0,this._errorCode=null,this._errorMessage=null,this._response=null,this.text=e.text||{},this.font=e.font||{},this.EVENTS=["onProgressListen","onComplete","onError"]},merge:function(){this._start()},_start:function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d");var e=this.canvas,t=this.context,r=new Image,i=this.imageUrl,n=this;r.onload=function(){e.width=r.width,e.height=r.height,t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.drawImage(r,0,0,e.width,e.height),n._drawText()},r.onerror=function(){n._errorCode=1,n._errorMessage="\u56FE\u7247\u52A0\u8F7D\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u56FE\u7247\u662F\u5426\u5B58\u5728",n._percent=100,n.trigger("onError",n._getData())},r.src=i},_drawText:function(){var e=this.text,t=this.font,r=this.context,i=e.content,n=t.size||12,o=t.family||"",s=e.width,a=t.lineHeight||15,h=(a+t.size)/2,c=e.x,g=e.y,l="",_="";r.fillStyle=t.color||"",r.font=n+"px/"+a+"px "+o;for(var f=0;f<i.length;f++){var m=i[f];_+=m,r.measureText(_).width>s&&(r.fillText(l,c,g+h),g+=a,_=m),l=_}for(var u=r.measureText(_).width,p=r.measureText(" ").width,d=s-u,x=parseInt(d/2/p);x-->0;)_=" "+_;r.fillText(_,c,g+h),this._submit()},_submit:function(){var e=this,t=this.use("common/component/image_uploader",this.options.uploadUrl);t.bind("success",function(t,r,i){e._percent=100,e._response=i,e.trigger("onComplete",e._getData())}),t.bind("progress",function(t,r,i){e._percent=parseInt(r/i*90),e.trigger("onProgressListen",e._getData())}),t.bind("error",function(){e._errorCode=300,e._errorMessage="\u4E0A\u4F20\u5931\u8D25",e._percent=100,e.trigger("onError",e._getData())}),t.upload(this.canvas,5242880,"image/png")},_getData:function(){return{percent:this._percent,errorCode:this._errorCode,errorMessage:this._errorMessage,response:this._response}}}});
;_.Module.define({path:"common/component/image_water",requires:["common/component/image_water/water_flash","common/component/image_water/water_html5"],sub:{initial:function(t){this.options=$.extend({},t),this.EVENTS=["onProgressListen","onComplete","onError"],this._initUploadUrl(),this._initFlash()},merge:function(t){if(!t)throw new Error("merge\u65B9\u6CD5\u5FC5\u987B\u6709\u53C2\u6570");t.text.content=$.tb.subByte(t.text.content,40,""),$.extend(this.options,t),this._start()},_initUploadUrl:function(t){var a=this;if(this.options.uploadUrl)return void(t&&t.apply(a));var e=$.ajax({url:"//tieba.baidu.com/dc/common/imgtbs",dataType:"json"});e.done(function(e){0===Number(e.no)?(a.options.uploadUrl="https://uploadphotos.baidu.com/upload/pic?tbs="+e.data.tbs,t&&t.apply(a)):t&&a._error()}).fail(function(){t&&a._error()})},_start:function(){this._initUploadUrl(this._startImageWater)},_startImageWater:function(){navigator.userAgent.toLowerCase().match(/chrome\/([\d]+)/);this._html5Visible()?this.imageWater=this.use("common/component/image_water/water_html5",this.options):(this.options.flashUrl=this.flashUrl,this.imageWater=this.use("common/component/image_water/water_flash",this.options)),this._generateCallBack(),this.imageWater.merge()},_generateCallBack:function(){for(var t=this,a=0;a<this.EVENTS.length;a++){var e=this.EVENTS[a];this.imageWater.bind(e,function(a){return function(e,o){t.trigger(a,o||e)}}(e))}},_initFlash:function(){if(!this._html5Visible()){var t=$("<div>").appendTo(document.body).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:1,bottom:1});this.flashUrl="//tb2.bdstatic.com/tb/static-common/img/imagewater/imagewater_dc0b981.swf?v=1.0.6";var a="flashImageWater"+ +new Date,e='<object id="'+a+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+this.flashUrl+'" /></object>',o='<object id="'+a+'" type="application/x-shockwave-flash" data="'+this.flashUrl+'" width="1" height="1"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this.flashVars+'" /></object>';t.html(-1!=navigator.appName.indexOf("Microsoft")?e:o)}},_html5Visible:function(){var t=navigator.userAgent.toLowerCase();return t=t.match(/chrome\/([\d]+)/),(t&&parseInt(t[1])>=21||$.browser.mozilla||$.browser.safari)&&!this.options.isFlash?!0:!1},_error:function(t){t=$.extend({percent:0,errorCode:400,errorMessage:"\u5408\u6210\u9519\u8BEF",response:null},t||{}),this.trigger("onError",t)}}});_.Module.define({path:"common/component/InterestSmiley",requires:["common/component/PostorService","common/component/image_water","common/component/ScrollPanel"],sub:{path:"https://gsp0.baidu.com/5aAHeD3nKhI2p27j8IqW0jdnxx1xbK/tb/cms/commonsub/editor/images/",_imgWaterPath:"//tieba.baidu.com/tb/cms/commonsub/editor/images/",smileTip:{qw_x:["\u6CA1\u56FEBS","\u4E0D\u660E\u89C9\u5389","\u778E\u4E86\u72D7\u773C","\u5751\u7239","\u4E0D\u4F1A\u7231","\u8EBA\u67AA","\u767D\u5BCC\u7F8E","\u4E0D\u670D\u6765\u8FA9","\u5BF9\u4E0D\u8D77"],qw_cat:["\u5C0F\u5EA6\u718A\u60CA\u5413\u9053\uFF1A\u76F4\u5230\u6211\u819D\u76D6\u4E2D\u4E86\u4E00\u7BAD","\u6CE2\u6CE2\u55B7\u4E86\u53E3\u8840\u8BF4\uFF1A\u6211\u64E6","\u5C0F\u5EA6\u718A\u6254\u4E86\u4E2A\u80A5\u7682\uFF1A\u4F60\u61C2\u7684","\u5C0F\u5EA6\u718A\u79F0\u8D5E\u9053\uFF1A\u8FD9\u771F\u662F\u6781\u597D\u7684","\u5C0F\u5EA6\u718A\u6FC0\u52A8\u5730\u8BF4\uFF1A\u7ED9\u529B\uFF01","\u5E03\u9C81\u9119\u89C6\u5730\u8BF4\uFF1A\u4F60\u59B9","\u5C0F\u5EA6\u718A\u60B2\u4F24\u5730\u8BF4\uFF1A\u611F\u89C9\u4E0D\u4F1A\u518D\u7231\u4E86","\u738B\u53D4\u6DEB\u7B11\u5730\u8BF4\uFF1A\u697C\u4E0B\u600E\u4E48\u770B\uFF1F","\u5C0F\u5EA6\u718A\u6311\u8845\u5730\u8BF4\uFF1A\u5475\u5475","\u5C0F\u5EA6\u718A\u9876\u7740\u8D34\u8BF4\uFF1A\u4E13\u4E1A\u9876\u5E16\u53EA\u97002\u6BDB","\u5C0F\u5EA6\u718A\u62FF\u7740\u706B\u94B3\u8BF4\uFF1A\u706B\u94B3\u7559\u540D","\u8D34\u8D34\u75F4\u75F4\u5730\u8BF4\uFF1A\u697C\u4E3B\u597D\u4EBA\u4E00\u751F\u5E73\u5B89","\u5C0F\u5EA6\u718A\u620F\u8C11\u9053\uFF1A\u633D\u5C0A","\u5C0F\u5EA6\u718A\u644A\u5F00\u624B\u8BF4\uFF1A\u7136\u5E76\u5375","\u5E03\u9C81\u6324\u7740\u8D34\u8D34\u8BF4\uFF1A\u6324\u6324"]},smileTextTip:{qw_x:["\u6CA1\u56FE\u4F60\u8BF4\u4E2Axx","\u4E0D\u660E\u89C9\u5389","\u778E\u4E86\u72D7\u773C","\u5751\u7239","\u611F\u89C9\u4E0D\u4F1A\u518D\u7231\u4E86","\u8EBA\u7740\u4E5F\u4E2D\u67AA","\u767D\u5BCC\u7F8E","\u4E0D\u670D\u6765\u8FA9","\u5BF9\u4E0D\u8D77"],qw_cat:["\u76F4\u5230\u6211\u819D\u76D6\u4E2D\u4E86\u4E00\u7BAD","\u6211\u64E6","\u4F60\u61C2\u7684","\u8FD9\u771F\u662F\u6781\u597D\u7684","\u7ED9\u529B\uFF01","\u4F60\u59B9","\u611F\u89C9\u4E0D\u4F1A\u518D\u7231\u4E86","\u697C\u4E0B\u600E\u4E48\u770B\uFF1F","\u5475\u5475","\u4E13\u4E1A\u9876\u5E16\u53EA\u97002\u6BDB","\u706B\u94B3\u7559\u540D","\u697C\u4E3B\u597D\u4EBA\u4E00\u751F\u5E73\u5B89","\u633D\u5C0A","\u7136\u5E76\u5375","\u6324\u6324"]},smileNum:{qw_x:9,qw_cat:15},smilePrev:{qw_x:"qw_x_00",qw_cat:"qw_cat_00"},smileSmallPath:{qw_x:"qw_x",qw_cat:"qw_cat_small"},smileQueen:["qw_cat","qw_x"],smileBrowse:{qw_x:"qw_x_browse",qw_cat:"qw_cat_browse"},smileTemplate:{qw_x:"qw_x_template",qw_cat:"qw_cat_template"},_dialogShow:!1,_layerShow:!1,isValueChange:!0,_isPosting:!1,_width:215,_height:195,version:"?_=20151011",initial:function(e){var t={type:"editor",smileClass:"t_smile_bg",scrollBar:"",scrollCss:{padding:"0px"},scrollBarHide:function(){},scrollBarShow:function(){},container:"",dataPostor:{}},i=this;this.option=$.extend(!0,t,e),this.manager(),this.postorService=this.use("common/component/PostorService"),this.wrapper=$(".wrap2"),this.bindPostor(),this._imageW=this.use("common/component/image_water"),this._imageW.bind("onComplete",function(e,t){var s=t.response,o=s.info.pic_id_encode,n=(s.info.fullpic_width,s.info.fullpic_height,s.info.pic_water,"https://imgsa.baidu.com/forum/pic/item/"+o+".jpg");i.postorHandler(n,i._textValue,"configSmile",i._width,i._height),i._progessBar(100,140),i._isPosting=!1}),this._imageW.bind("onError",function(e,t){i._isPosting=!1;var s={image:'<img style="border:none;" src="//tb2.bdstatic.com/tb/img/errorFace.gif">',subMessage:"\u53D1\u8D34\u5931\u8D25",message:t.errorMessage,dialogSet:{width:410,height:95,title:"\u53D1\u8868\u8D34\u5B50"}};i._showErrorTip(s,function(){return!0})}),this._imageW.bind("onProgressListen",function(e,t){i.loading.show(),i.dBtn.hide(),setTimeout(function(){i._progessBar(t.percent,140)},200)})},_progessBar:function(e,t){var i=e*t/100,s=this;s.loading.find(".s_progress_bar").width(i)},bindPostor:function(){var e=this;this.postorService.bind("onCheckEroor",function(){e.trigger("onsuccess"),e.destroyLayer()}),this.postorService.bind("onError",function(){e.trigger("onsuccess"),e.destroyLayer(),e.dBtn.show(),e.loading.hide()})},manager:function(){window.InterestSmileyManager?window.InterestSmileyManager.push(this):(window.InterestSmileyManager=[],window.InterestSmileyManager.push(this))},generic:function(){this.render("qw_cat"),this.eventInit()},render:function(e){var t=this.option,i=this,s=t.container,o=i._gSmile(e);i.scrollPanel=i.use("common/component/ScrollPanel",{container:s,padding:i.option.scrollCss.padding,height:260,scrollBarHide:i.option.scrollBarHide,scrollBarShow:i.option.scrollBarShow,content:o})},_gSmile:function(e){var t=this.option,i=this,s="";if("all"==e)for(var o=i.smileQueen,n=0,a=o.length;a>n;n++)for(var r=o[n],l=i.smileNum[r],d=i.smilePrev[r],h=t.smileClass,c=1;l>=c;c++){var g=i.path+"qw_review/"+i.smileyName(d,c,"png");s+='<div class="s_image '+h+'" data-type="'+r+'" title="'+i.smileTip[r][c-1]+'"    data-num="'+c+'"><img src="'+g+'" /></div>'}else for(var r=e,l=i.smileNum[r],d=i.smilePrev[r],h=t.smileClass,c=1;l>=c;c++){var g=i.path+"qw_review/"+i.smileyName(d,c,"png");s+='<div class="s_image '+h+'" data-type="'+r+'" title="'+i.smileTip[r][c-1]+'"     data-num="'+c+'"><img src="'+g+'" /></div>'}return s},smileyName:function(e,t,i){var s="";return s=e,10>t&&(s+="0"),s=s+t+"."+i},shake:function(e,t,i,s){function o(){n>=0?(a.css({padding:0}),n%2==0?a.css({paddingLeft:r.easeInOut(0,s,n,i)}):a.css({paddingRight:r.easeInOut(0,s,n,i)}),n--,r.Timer=setTimeout(o,t)):clearTimeout(r.Timer)}var n=e,a=this.wrapper;this.Timer=setTimeout(o,t);var r=this},easeInOut:function(e,t,i,s){var o=i/s*2;return(1>o?Math.pow(o,3):(o-=2)*Math.pow(o,2)+2)*t/2+e},destroyLayer:function(){var e=this;e.layer&&1==e._layerShow&&(clearTimeout(e.Timer),$(".wrap2").css("padding",0),e.layer.stop(),e.layer.hide(),e._layerShow=!1),e.dialog&&e._dialogShow&&(e.dialog.hide(),e._dialogShow=!1),e.imageText&&(e.imageText.hide(),e.imageText.html(""))},eventInit:function(){var e=this.option,t=this.option.container,i=this;t.delegate(".s_image","click",function(){var t=$(this),s=t.data("type"),o=t.data("num"),n=i.smilePrev[s],a=i.path+i.smileBrowse[s]+"/"+i.smileyName(n,o,"gif");i.trigger("click");for(var r=($(document).height(),$(window)),l=r.height()/2-300,d=r.width()/2-500,h="fixed",c=d+270,g=window.InterestSmileyManager,m=0,p=g.length;p>m;m++)g[m].destroyLayer();$.browser.msie&&$.browser.version<7&&(l=$(window).scrollTop(),h="absolute"),i.imageText&&i.imageText.hide();var u=$.getzIndex();i.layer?(i.layer.tbattr("src",a+i.version),i.layer.css({width:1e3,height:1e3,top:l,zIndex:u,left:d,position:h,opacity:.1}),i.layer.tbattr("data-type",s),i.layer.tbattr("data-num",o),i.layer.tbattr("data-isTemplate","no"),i.layer.show(),i._layerShow=!0):(i.layer=$('<img src="'+a+i.version+'" data-type="'+s+'" data-isTemplate="no" data-num="'+o+'" style="width:1000px;height:1000px;top:'+l+"px;z-index:"+u+";opacity:0.1;left:"+d+"px;position:"+h+';" >'),$("body").append(i.layer),i._layerShow=!0),i.layer.animate({width:430,height:390,opacity:1,left:c},500,function(){$.browser.msie&&$.browser.version<7||($.browser.msie?i.shake(20,30,12,3):"sougou"==$.getBrowser().name?i.shake(20,25,16,4):i.shake(20,25,12,3)),i.renderDialog(l,c)}),$.stats.sendRequest("st_mod=editor&fr=tb0_forum&st_type=interestS&st_value="+e.type)})},_fTip:{isBlock:"\u60A8\u5DF2\u7ECF\u88AB\u5C01\u7981\uFF0C\u4E0D\u80FD\u53D1\u8D34",balv:' <a href="//tieba.baidu.com/f/like/level?kw=d8" >4\u7EA7\u5934\u8854</a><br />\u4EE5\u4E0A\u4F1A\u5458\u53D1\u8D34\u3002',old:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53CA\u6CE8\u518C\u6EE1\u4E00\u5B9A\u65F6\u95F4\u7684\u8001\u7528\u6237\u53D1\u8D34",bawu:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u9650\u5427\u52A1\u56E2\u961F\u53D1\u8D34",law:"\u62B1\u6B49\uFF0C\u6839\u636E\u76F8\u5173\u6CD5\u5F8B\u6CD5\u89C4\u548C\u653F\u7B56\uFF0C\u672C\u5427\u76EE\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34",balv_undefined:"\u62B1\u6B49\uFF0C\u672C\u5427\u76EE\u524D\u4EC5\u5141\u8BB8\u4E00\u5B9A\u7EA7\u522B\u4EE5\u4E0A\u4F1A\u5458\u53D1\u5E16"},cannotPost:function(e){var t=this;switch(t.trigger("onsuccess"),t.destroyLayer(),e){case"login":return _.Module.use("common/widget/LoginDialog",["","editor"]),void 0;case"noUn":return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D"," "),void 0}var i="\u60A8\u4E0D\u80FD\u8FDB\u884C\u53D1\u8D34\u64CD\u4F5C";""!=e&&(i=this._fTip[e]);var s={image:'<img style="border:none;" src="//tb2.bdstatic.com/tb/img/errorFace.gif">',subMessage:"\u53D1\u8D34\u5931\u8D25",message:i,dialogSet:{width:410,height:95,title:"\u53D1\u8868\u8D34\u5B50"}};t._showErrorTip(s,function(){return!0})},_showErrorTip:function(e,t){var i='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: "\u5B8B\u4F53";"><table style="width:90%"><tbody><tr><td width="60">'+e.image+'</td><td valign="middle" style="font-size:20px;line-height:22px;font-family: "\u9ED1\u4F53";">'+e.subMessage+"</td></tr></tbody></table>"+e.message+"</div>",s=$.dialog.alert(i,e.dialogSet);s.bind("onclose",t)},postorHandler:function(e,t,i,s,o){var n=this.postorService,a=this,r=(this.option.dataPostor,a._getData(e,i,t,s,o));n.postHandler({data:r,type:"reply",success:a.successCallback,context:a,error:a.errorCallback,captchaCloseCallback:function(){a.destroyLayer()}})},_getData:function(e,t,i,s,o){var n=this.option.dataPostor,a=this.postorService,r=$.extend(!0,{},n.data);r.content=UE.utils.html2ubb(a.genericRich({type:t,src:e,width:s,height:o,text:$.tb.escapeHTML(i)})),r.anonymous=0;var l=document.getElementById("sign_id"),d=document.getElementById("useSignName");return d&&d.checked&&l&&(r.sign_id=l.value),r},successCallback:function(e,t){t.trigger("onsuccess"),t.destroyLayer(),t.showSuccessTip(),t.refreshWebsite()},refreshWebsite:function(){setTimeout(function(){location.reload()},1e3)},errorCallback:function(){},showSuccessTip:function(){var e=($(document).height(),$(window)),t=e.scrollTop()+e.height()/2-50,i=e.width()/2-100,s=$.getzIndex(),o=$('<div style="position:absolute;z-index:'+s+'"><div class="editor_banned_tip_info"><span class="postor_success"></span><span style="">\u53D1\u8868\u6210\u529F!</span></div><div>');o.css({top:t,left:i}),o.appendTo($("body")),setTimeout(function(){o.fadeOut(300,function(){o.remove()})},1500)},addBubble:function(e){var t=this;if(!t.bubble){var i={content:"\u529F\u80FD\u5373\u5C06\u4E0A\u7EBF\uFF0C<br>\u656C\u8BF7\u671F\u5F85~",arrow_dir:"down",bubble_css:{top:0,left:50,width:100},arrow_pos:{left:45},attr:"  ",wrap:e,closeBtn:!1,level:1,arrowReq:!0},s=new UiBubbleTipBase(i);s.j_bubble.find(".j_content").css({backgroundColor:"white",border:"1px solid #848482",textAlign:"center"}),s.j_bubble.find(".ui_triangle_outter").css({color:"#848482"}),s.j_bubble.find(".ui_triangle_inner").css({color:"white"}),t.bubble=s}},_submit:function(){var e=this.postorService,t=this;if(!t._isPosting){t._isPosting=!0;var i=this.option.dataPostor,s=e.isCanPost(i.canPostor);if(s.canPost){var o=t.layer,n=o.tbattr("data-type"),a=o.tbattr("data-num"),r=t.textInput.val().trim();t._textValue=r;var l=t.smilePrev[n],d=t._imgWaterPath+t.smileTemplate[n]+"/"+t.smileyName(l,a,"gif");if(""==r||r==t.smileTextTip[n][a-1]){var h="http://tb2.bdstatic.com/tb/cms/commonsub/editor/images/"+t.smileSmallPath[n]+"/"+t.smileyName(l,a,"gif");t.postorHandler(h,r,"smiley",t._width,t._height),t._isPosting=!1}else t._imageWater(d,r,t.textStyle[n][a-1]),$.stats.sendRequest("st_mod=editor&fr=tb0_forum&st_type=interestS&st_value=zidingyi")}else{var n=s.type;t.cannotPost(n),t._isPosting=!1}}},_imageWater:function(e,t,i){var s=this,o=s.filterStyle(t,i),n={imageUrl:e+s.version,text:{content:t,x:i.x,y:i.y,width:i.width},font:{size:o.size,lineHeight:o.lineHeight,color:i.color,family:"\u5FAE\u8F6F\u96C5\u9ED1"}};return s._imageW?(s._imageW.merge(n),void 0):void 0},textStyle:{qw_x:[{x:180,y:158,width:148,height:126,lineHeight:32,color:"#ffffff",size:14},{x:60,y:155,width:170,height:95,lineHeight:24,color:"#557E90",size:14},{x:212,y:166,width:130,height:86,lineHeight:20,color:"#ffffff",size:14},{x:246,y:127,width:90,height:125,lineHeight:19,color:"#ffffff",size:14},{x:45,y:155,width:180,height:80,lineHeight:20,color:"#557E90",size:14},{x:45,y:164,width:178,height:70,lineHeight:18,color:"#ffffff",size:14},{x:222,y:102,width:130,height:107,lineHeight:21,color:"#557E90",size:14},{x:85,y:145,width:150,height:100,lineHeight:25,color:"#ffffff",size:14},{x:51,y:122,width:160,height:90,lineHeight:25,color:"#557E90",size:14}],qw_cat:[{x:201,y:65,width:181,height:153,lineHeight:32,color:"#670102",size:24},{x:230,y:62,width:150,height:164,lineHeight:30,color:"#670102",size:24},{x:205,y:63,width:176,height:153,lineHeight:30,color:"#670102",size:24},{x:221,y:74,width:164,height:145,lineHeight:30,color:"#670102",size:24},{x:244,y:51,width:137,height:169,lineHeight:26,color:"#670102",size:24},{x:213,y:77,width:163,height:154,lineHeight:28,color:"#670102",size:24},{x:213,y:77,width:170,height:146,lineHeight:33,color:"#670102",size:24},{x:230,y:70,width:158,height:115,lineHeight:28,color:"#670102",size:24},{x:203,y:66,width:187,height:130,lineHeight:31,color:"#670102",size:24},{x:243,y:70,width:138,height:160,lineHeight:30,color:"#670102",size:24},{x:249,y:65,width:134,height:157,lineHeight:26,color:"#670102",size:24},{x:197,y:82,width:182,height:140,lineHeight:28,color:"#670102",size:24},{x:216,y:69,width:166,height:126,lineHeight:33,color:"#670102",size:24},{x:228,y:87,width:161,height:124,lineHeight:28,color:"#670102",size:24},{x:186,y:60,width:195,height:86,lineHeight:31,color:"#670102",size:24}]},filterStyle:function(e,t){var i=e.length,s=(t.lineHeight,t.size,t.width,{lineHeight:t.lineHeight,size:t.size});if(i>0){var o=t.height*t.width,n=o/i;s.lineHeight=Math.ceil(Math.pow(n,.5)),s.size=Math.ceil(1.5*s.lineHeight/2.5)}return s.lineHeight>t.height&&(s.lineHeight=t.height),s.lineHeight<t.lineHeight&&(s.lineHeight=t.lineHeight),s.size<t.size&&(s.size=t.size),s},showSmileTemplate:function(e,t,i){var s=this,o=s.layer,n=o.tbattr("data-type"),a=o.tbattr("data-num"),r=s.smilePrev[n],l=o.tbattr("data-isTemplate"),d=s.path+s.smileTemplate[n]+"/"+s.smileyName(r,a,"gif"),h=s.textStyle[n][a-1],c=function(e){var t=s.textInput.val();return s.imageText?(s.imageText.html($.tb.escapeHTML(t)),s.imageText.css(e),s.imageText.show(),void 0):(s.imageText=$('<div class="s_image_text"></div>'),s.imageText.html($.tb.escapeHTML(t)),s.imageText.css(e),$("body").append(s.imageText),s.imageText.show(),void 0)},g="fixed";$.browser.msie&&$.browser.version<7&&(g="absolute");var m=s.filterStyle(s.textInput.val(),h),p={position:g,zIndex:i,width:h.width,lineHeight:m.lineHeight+"px",left:h.x+t,fontSize:m.size,color:h.color,fontFamily:"\u5FAE\u8F6F\u96C5\u9ED1",top:h.y+e};"yes"==l?c(p):(o.tbattr("src",d+s.version),o.tbattr("data-isTemplate","yes"),c(p))},renderDialog:function(e,t){var i=this,s=i.layer,o=s.tbattr("data-type"),n=s.tbattr("data-num"),a=i.smileTextTip[o][n-1];return i.sTop=e,i.sL=t,i.imageText&&i.imageText.hide(),i.dialog?(i.dialog.setPosition(t+30,e+390),i.dialog.element.css({zIndex:$.getzIndex()}),i.loading.find(".s_progress_bar").width(0),i.dBtn.show(),i.loading.hide(),i.zIndex=$.getzIndex(),i.isValueChange=!1,i.textInput.val(a),i.dialog.show(),i._dialogShow=!0,void 0):(i.zIndex=$.getzIndex(),i.textInput=$('<input value="'+a+'" class="s_text_input"/>'),i.replyBtn=$('<a href="#" style="float:left;" class=" ui_btn interest_smiley_dialog_btn interest_smiley_dialog_submit" alog-alias="qwsmile"><span><em>\u63D0\u4EA4</em></span></a>'),i.cancelBtn=$('<a class="ui_btn interest_smiley_dialog_btn interest_smiley_dialog_cancel">\u53D6\u6D88</a>'),i.dBtn=$('<div style="position:relative;">').append(i.textInput).append(i.replyBtn).append(i.cancelBtn),i.loading=$('<div class="s_loading_wrap"><div class="s_progress_w"><span class="s_progress_bar"></span></div><div class="s_loading_tip">\u5BA2\u5B98\u7A0D\u7B49\u4E0B\uFF0C\u6211\u4EEC\u6B63\u5728\u52AA\u529B\u4E3A\u60A8\u751F\u6210\u56FE\u7247\u4E2D<div></div>'),i.dContent=$("<div></div>").append(i.dBtn).append(i.loading),i.replyBtn.click(function(e){i._submit(),e.preventDefault(),e.stopPropagation(),$.stats.sendRequest("st_mod=editor&fr=tb0_forum&st_type=interestS&st_value=send")}),i.textInput.focus(function(){var e=$(this);setTimeout(function(){i._isSelect=!0,e.select()},10)}),i.textInput.bind("mousedown",function(){i._isSelect=!1}),$.subInput(i.textInput,30),i.textInput.keydown(function(e){var t=e||window.event;if(13==t.keyCode)return i._submit(),!1;var s=$.tb.getByteLength(i.textInput.val());return i._isSelect&&s>39&&i.textInput.val(""),i._isSelect=!1,i.showSmileTemplate(i.sTop,i.sL,i.zIndex),!0}),i.textInput.bind("input",function(){return i.isValueChange&&i.showSmileTemplate(i.sTop,i.sL,i.zIndex),i.isValueChange=!0,!0}),i.textInput.bind("propertychange",function(){return i.isValueChange&&i.showSmileTemplate(i.sTop,i.sL,i.zIndex),i.isValueChange=!0,!0}),i.cancelBtn.click(function(){i.trigger("onCancel"),i.destroyLayer()}),i.dialog=new $.dialog({html:i.dContent,modal:!1,escable:!1,showTitle:!1,top:e+390,left:t+30,closeable:!0,fixed:!0,autoCenter:!1,width:370,height:26,draggable:!1,closeable:!1}),i.dialog.element.removeClass("dialogJshadow"),i.dialog.element.addClass("interest_smiley_dialog"),i.dialog.element.find(".dialogJcontent").css({padding:"20px"}),i._dialogShow=!0,void 0)}}});_.Module.define({path:"comforum/widget/Comtrial",sub:{initial:function(a){this.dataObj=a,this._initAD(),this._initPbFlashAd()},_initAD:function(){var a=this,e=a.dataObj,t=802;if($("#search_fengchao")[0]&&$("#search_fengchao_left")[0]&&"search"==e.page&&0==e.hide_searchad){window.arrBaiduAds=window.arrBaiduAds||{};var i="http://a.baidu.com/ecom?di=802,779&tm=baiduASPT802S,baiduASPT779S&tn=SE_ecomt01_b7az25cz,SE_ecomt01_b7az25cz&word="+e.query_encode+"&eid="+t;$.JsLoadManager.use([i],function(){$("#search_fengchao_left").html(arrBaiduAds[802])})}$.JsLoadManager.use(["https://cpro.baidustatic.com/js/m.js"],function(){var e=a.dataObj,t=PageData.forum?PageData.forum.forum_id:0;window.BAIDU_DAN_config={zIndex:1},$("#search_union_mod")[0]&&"search"==e.page&&0==e.hide_searchad&&(a._loadWm({width:250,height:250,tpl:"pb",page:"pb",id:696315,forumId:t,selector:"#search_union_mod",query:e.query}),$("#search_union_mod").show())}),$("#search_bottomad")[0]&&"search"==e.page&&0==e.hide_searchad&&($("#search_bottomad").html($.tb.format($("#comtrial_search_bottomad").html(),null)),$("#search_bottomad").show())},_loadWm:function(a){if(null!=a&&a){var e=a.src||"//tieba.baidu.com/tb/zt/adsense/baichuan_search_right/?",t=a.id,i=a.forumId,o=a.tpl||"pb",r=a.page||"pb",d=a.query||"";e+="tpl="+o+"&page="+r+"&id="+t+"&forumId="+i+"&query="+encodeURIComponent(d);var n=a.selector,h=a.width,c=a.height,s=$('<iframe src="'+e+'" style="width:'+h+"px;height:"+c+'px" scrolling="no" frameborder="0"></iframe>');$(n).html(s)}},_initPbFlashAd:function(){var a=PageUnit.load("tope_pbbanner_swf");a&&new $.swf(a,{id:"chart",container:"#banner_pb_customize",width:960,height:90,params:{wmode:"transparent"}})}}});_.Module.define({path:"comforum/widget/SkinClick",sub:{initial:function(){this._calcAdWidth(),this._bindEvents()},_calcAdWidth:function(){var i=$(".com_skinad_left,.com_skinad_right"),n=$(window).width(),t=1380>n?(n-980)/2:200;i.css("width",t)},_bindEvents:function(){var i=this;$(window).on("resize",i._calcAdWidth),$(".com_skinad_left,.com_skinad_right").on("click",function(){$.stats.hive("skin_ad")})}}});_.Module.define({path:"comforum/widget/GamePopWindow",sub:{nextDay:new Date((new Date).getTime()+864e5-1e3*(60*(new Date).getHours()*60+60*(new Date).getMinutes()+(new Date).getSeconds())),nextTenMinutes:new Date((new Date).getTime()+6e5),nextHalfHour:new Date((new Date).getTime()+18e5),tmp:['<div id="game_pop_window">','<div class="pop_head">','<a class="pop_head_close" href="#" onclick="return false;"></a>',"</div>",'<div class="pop_body">','<div class="game_info">','<a class="game_image" href="#{game_link}" target="_blank">','<img src="#{game_image}" />',"</a>",'<p class="game_name">','<a href="#{game_link}" target="_blank">#{game_name}</a>',"</p>",'<div class="game_hot clearfix">#{game_hot}</div>',"</div>",'<div class="game_reco">','<div class="game_icon"></div>','<p class="game_reco_info">#{game_reco_info}</p>',"</div>",'<a class="game_btn" href="#{game_link}" target="_blank"></a>','<p class="game_desc clearfix">',"<span>#{game_desc_text}</span>",'<a href="#{game_desc_link}" target="_blank">\u8BE6\u60C5\u4ECB\u7ECD</a>',"</p>","</div>","</div>"].join(""),initial:function(){this.hanldeBaiduId(),this.hanldeUserId();var e=this.initPopFromStorageOrLimitShow();e?this.checkLimitShow()&&this.loadBaiduYouxiScript():this.initPopFromAjax()},hanldeBaiduId:function(){var e=$.tb.Storage.get("game_pop_baidu_id"),t=$.cookie("BAIDUID");e!=t&&($.tb.Storage.remove("game_pop_window_data_storage"),$.tb.Storage.remove("game_pop_window_limit_show"),$.tb.Storage.set("game_pop_baidu_id",t,this.nextDay))},hanldeUserId:function(){var e=parseInt($.tb.Storage.get("game_pop_user_id"))||0,t=parseInt($.getPageData("user.user_id"))||0;e!=t&&($.tb.Storage.remove("game_pop_window_data_storage"),$.tb.Storage.remove("game_pop_window_limit_show"),$.tb.Storage.set("game_pop_user_id",t,this.nextDay))},initPopFromStorageOrLimitShow:function(){var e=this.loadPopWindowDataFromStorage();return e?(this.initWindow(e),!0):this.checkLimitShow()?!0:!1},initPopFromAjax:function(){var e=this;$.getJSON("/gamepopup/getPopup?timestamp="+(new Date).getTime()).done(function(t){var a=t.data;return!a||$.isEmptyObject(a)?(e.setLimitShow(),void e.loadBaiduYouxiScript()):(a={game_name:a.name,game_image:a.icon,game_link:a.link,game_desc:a.desc,game_desc_link:a.desc_link,game_hot:a.hot,pop_type:2,start_time:a.start_time,end_time:a.end_time,damn_friends:a.damn_friends,task_name:a.task_name||"",taks_id:a.id||0},e.initWindow(a),void e.storePopWindowData())})},loadBaiduYouxiScript:function(){return},initWindow:function(e){return e||$.isEmptyObject(e)?(this.data=e,this.game_name=this.data.game_name,this.task_name=this.data.task_name,this.task_id=this.data.taks_id||0,this.popWindow=null,this.buildTmp(this.data),this.bindEvents(this.data),void this.runStrategy(this.data)):!1},checkToShow:function(e){var t=parseInt((new Date).getTime()/1e3);return e.start_time&&e.end_time&&e.start_time<t&&e.end_time>t},checkLimitShow:function(){var e=$.tb.Storage.get("game_pop_window_limit_show");return e?!0:!1},setLimitShow:function(e){e=e||this.nextHalfHour,$.tb.Storage.set("game_pop_window_limit_show",1,e)},storePopWindowData:function(){$.tb.Storage.set("game_pop_window_data_storage",$.json.encode(this.data),this.nextDay)},clearPopWindowData:function(){$.tb.Storage.remove("game_pop_window_data_storage")},notPopWindowUntilNextDay:function(){this.clearPopWindowData(),this.setLimitShow(this.nextDay),$.tb.Storage.set("game_pop_window_not_load_baiduyouxi",1,this.nextDay)},loadPopWindowDataFromStorage:function(){var e=$.tb.Storage.get("game_pop_window_data_storage");try{e=$.json.parseJSON(e)}catch(t){return!1}return e},sendPopupAction:function(e){var t="/gamepopup/setPopup",a={task_id:this.data.id||-1,game_name:this.data.game_name,action:e};$.post(t,a)},bindEvents:function(e){{var t=this;1==e.pop_type?"\u5427\u63A8\u8350\u5F39\u7A97":"\u7528\u6237\u63A8\u8350\u5F39\u7A97","frs"==PageData.product?"frs\u9875_":"pb\u9875_"}$("#game_pop_window").on("click",".pop_head_close",function(){t.sendPopupAction("close"),t.notPopWindowUntilNextDay(),t.postTrack("\u5173\u95ED\u5F39\u7A97"),t.hidePop(),t.clearStrategy()}).on("click",".game_name a",function(){t.sendPopupAction("play"),t.notPopWindowUntilNextDay(),t.postTrack("\u8FDB\u5165\u6E38\u620F","\u6E38\u620F\u540D\u79F0"),t.hidePop(),t.clearStrategy()}).on("click",".game_image",function(){t.sendPopupAction("play"),t.notPopWindowUntilNextDay(),t.postTrack("\u8FDB\u5165\u6E38\u620F","\u6E38\u620F\u56FE\u6807"),t.hidePop(),t.clearStrategy()}).on("click",".game_btn",function(){t.sendPopupAction("play"),t.notPopWindowUntilNextDay(),t.postTrack("\u8FDB\u5165\u6E38\u620F","\u6E38\u620F\u6309\u94AE"),t.hidePop(),t.clearStrategy()}).on("click",".game_desc a",function(){t.sendPopupAction("view"),t.postTrack("\u8BE6\u60C5\u4ECB\u7ECD","\u6E38\u620F\u6309\u94AE")}).on("click",".forum_title",function(){t.postTrack("\u63A8\u8350\u5427\u70B9\u51FB",$(this).getData().forum_name)}).on("click",".user_link",function(){t.postTrack("\u63A8\u8350\u7528\u6237\u70B9\u51FB",$(this).getData().user_name)})},postTrack:function(e,t,a){var i="frs"==PageData.product?"frs\u9875_":"pb\u9875_",o=1==this.data.pop_type?"\u5427\u63A8\u8350\u5F39\u7A97":"\u7528\u6237\u63A8\u8350\u5F39\u7A97";"undefined"==typeof a&&(a="click");var n={obj_type:"\u6E38\u620F",obj_subtype:o,obj_game:this.game_name,obj_uid:$.cookie("BAIDUID"),obj_url:this.task_name,obj_task_id:this.task_id};t&&(n.obj_name=t),$.stats.track(i+"\u5F39\u7A97_"+e,"\u4E2A\u6027\u5316\u5F39\u7A97\u5B9E\u9A8C","",a,n)},buildTmp:function(e){var t="",a={game_name:$.tb.subByte(e.game_name,16),game_image:e.game_image,game_link:e.game_link,game_hot:this.buildGameHot(e),game_reco_info:this.buildGameRecoInfo(e),game_desc_text:$.tb.subByte(e.game_desc,44),game_desc_link:e.game_desc_link};t=$.tb.format(this.tmp,a),this.popWindow=$(t).appendTo("body")},runStrategy:function(e){var t=$.cookie("game_pop_window");if(t=3,!t||0>t||t>3)this.resetStrategy(),this.stepStrategy();else if(3==t)this.showPop(e),this.resetStrategy();else{if(0==t)return;this.stepStrategy()}},resetStrategy:function(){$.cookie("game_pop_window",1,{expires:this.nextDay})},stepStrategy:function(){var e=$.cookie("game_pop_window");$.cookie("game_pop_window",++e,{expires:this.nextDay})},clearStrategy:function(){$.cookie("game_pop_window",0,{expires:this.nextDay})},showPop:function(e){var t=this,a=(1==e.pop_type?"\u5427\u63A8\u8350\u5F39\u7A97":"\u7528\u6237\u63A8\u8350\u5F39\u7A97","frs"==PageData.product?"frs\u9875_":"pb\u9875_",setTimeout(function(){t.popWindow.show().css("bottom","-280px").animate({bottom:0},500),clearTimeout(a),a=null},2e3)),i=setTimeout(function(){t.hidePop(),clearTimeout(i),i=null},15e3);t.postTrack("\u5C55\u73B0","","view")},hidePop:function(){this.popWindow.animate({bottom:"-280px"},500,function(){$(this).hide()})},buildGameHot:function(e){var t=0,a="",i=parseInt(e.game_hot)||0,o=i>9?9:i;for(t;o>t;++t)t%2!=1&&(a+='<span class="full"></span>');for(t%2==0&&(a+='<span class="half"></span>'),t;10>t;++t)t%2!=1&&(a+='<span class="empty"></span>');return a+='<span class="score">'+e.game_hot+"</span>"},buildGameRecoInfo:function(e){var t,a="";if(1==e.pop_type){var i=$.tb.dataField({forum_name:e.forum_name});a+='<a class="forum_title" href="/f?kw='+e.forum_name+'&ie=utf8" '+i+' target="_blank" >'+$.tb.subByte(e.forum_name,12)+"\u5427</a>\u91CC\u5DF2\u7ECF\u6709<span>"+e.user_num+"</span>\u4F4D\u8D34\u5427\u5C0F\u4F19\u4F34\u5728\u73A9\u8FD9\u6B3E\u6E38\u620F\uFF0C\u9A6C\u4E0A\u52A0\u5165\u5230\u4ED6\u4EEC\u7684\u884C\u5217\uFF01"}else if(2==e.pop_type)if(e.damn_friends)a+=e.damn_friends;else if("\u571F\u8C6A\u8DB3\u7403"==e.game_name)a+="\u5DF4\u897F\u4E16\u754C\u676F\u6FC0\u60C5\u5F00\u6218\uFF0C\u8D34\u5427\u4E3A\u4F60\u5F00\u542F\u4E13\u4EAB\u7684\u4E16\u754C\u676F\uFF01";else if("2014\u5DF4\u897F\u4E16\u754C\u676F"==e.game_name)a+="\u6851\u5DF4\u8363\u8000\uFF0C\u8C01\u80FD\u95EE\u9F0E\u4E16\u754C\u5DC5\u5CF0\uFF1F\u8D34\u5427\u9080\u4F60\u4E00\u8D77\u5F81\u6218\uFF01";else{for(t=0;t<e.user_info.length&&!(t>3);++t){var o=$.tb.dataField({user_name:e.user_info[t]});a+='<a class="user_link" href="/home/main/?ie=utf8&un='+e.user_info[t]+'"'+o+' target="_blank" >'+$.tb.subByte(e.user_info[t],12)+"</a>\u3001"}a=a.slice(0,a.length-1),a+="\u7B49\u591A\u4F4D\u8D34\u5427\u5C0F\u4F19\u4F34\u5728\u73A9\u8FD9\u6B3E\u6E38\u620F\uFF0C\u9A6C\u4E0A\u8DDF\u4ED6\u4EEC\u4E00\u8D77\u73A9\uFF01"}return a}}});